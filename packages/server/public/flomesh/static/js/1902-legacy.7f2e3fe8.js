"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[1902],{30541:function(t,e,n){var a=n(82109),i=n(47908),r=n(26244),o=n(83658),l=n(85117),u=n(7207),d=1!==[].unshift(0),s=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();a({target:"Array",proto:!0,arity:1,forced:d||s},{unshift:function(t){var e=i(this),n=r(e),a=arguments.length;if(a){u(n+a);for(var d=n;d--;){var s=d+a;d in e?e[s]=e[d]:l(e,s)}for(var c=0;c<a;c++)e[c]=arguments[c]}return o(e,n+a)}})},71900:function(t,e,n){n.d(e,{Z:function(){return l}});var a=n(66252),i=n(3577),r={class:"head-info"};var o={name:"HeadInfo",props:["title","content"]};var l=(0,n(83744).Z)(o,[["render",function(t,e,n,o,l,u){return(0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("span",null,(0,i.zw)(n.title),1),(0,a._)("p",null,[(0,a.Uk)((0,i.zw)(n.content),1),(0,a.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},11902:function(t,e,n){n.r(e),n.d(e,{default:function(){return E}});n(68309),n(82526),n(41817),n(69826),n(41539);var a=n(66252),i=n(3577),r=n(87932),o=function(t){return(0,a.dD)("data-v-059ed20a"),t=t(),(0,a.Cn)(),t},l=o((function(){return(0,a._)("div",null,null,-1)})),u=["onClick"],d={class:"flex"},s={class:"flex-item"},c={class:"font-16"},p=["onClick"],f=["onClick"],h=o((function(){return(0,a._)("img",{src:r,style:{width:"300px"}},null,-1)}));var m=n(88478),g=n(95082),v=(n(54747),n(40561),n(30541),n(92222),n(57658),n(99684)),w=n(62611),y=n(5009),_=n(2692),$=n(54367),k=n(46981),z=n(61103),b=n(71900),O=n(96486),W=n.n(O),C=n(33907),T=n(85263),D=n(76754),x={name:"Organizations",components:{HeadInfo:b.Z,PageLayout:z.Z,PlusCircleTwoTone:v.Z,PartitionOutlined:w.Z,SettingOutlined:y.Z,MoreOutlined:_.Z,CloseOutlined:$.Z,EditOutlined:k.Z,FormItem:D.Z},i18n:n(89234),data:function(){return{users:[],orgs:[],orgTree:[],PartitionOutlined:w.Z,isEdit:!1,selectProjects:[],selectUsers:[],roles:[],expandedKeys:[],visible:!1,payload:{id:"",name:"",parent:null,description:""},bindTarget:{},editorIsCreate:!0,workload:[],projects:[],loading:!0,activities:[],config:{},teams:[],simpleImage:T.Z.PRESENTED_IMAGE_SIMPLE}},computed:(0,g.Z)((0,g.Z)({},(0,C.rn)("rules",["rules"])),(0,C.Se)("account",["user"])),mounted:function(){var t=this;this.loaddata(),this.$gql.query("projects{data{id,attributes{name,organization{data{id,attributes{name}}}}}}").then((function(e){t.projects=e.data})),this.$gql.query("usersPermissionsUsers{data{id,attributes{username,phone,email,type}}}").then((function(e){t.users=e.data}))},methods:{onDragEnter:function(t){},onDrop:function(t){var e,n=t.node.key,a=t.node.id,i=t.dragNode.key,r=t.dragNode.id,o=t.node.pos.split("-"),l=t.dropPosition-1*o[o.length-1],u=function t(e,n,a){e.forEach((function(i,r){return i.key===n?a(i,r,e):i.children?t(i.children,n,a):void 0}))},d=(0,m.Z)(this.orgTree);if(u(d,i,(function(t,n,a){a.splice(n,1),e=t})),t.dropToGap)if((t.node.children||[]).length>0&&t.node.expanded&&1===l)u(d,n,(function(t){t.children=t.children||[],t.children.unshift(e)}));else{var s=[],c=0;u(d,n,(function(t,e,n){s=n,c=e})),-1===l?s.splice(c,0,e):s.splice(c+1,0,e)}else u(d,n,(function(t){t.children=t.children||[],t.children.unshift(e)}));var p=null;t.dropToGap||(p=a),this.$gql.mutation("updateOrganization(id:".concat(r,",data:{parent: ").concat(p,"}){data{id}}")).then((function(){})),this.orgTree=d},onContextMenuClick:function(t,e){"setting"==e?this.setting(null,null,t):"manage"==e&&this.manage(null,null,t)},add:function(){this.isEdit=!1,this.payload={id:"",name:"",parent:null,description:""},this.showModal()},showModal:function(){this.visible=!0},valid:function(){var t=this;this.$refs.form.validateFields().then((function(){t.handleOk()})).catch((function(){}))},handleOk:function(){var t=this,e=W().cloneDeep(this.payload),n={name:e.name,description:e.description,parent:e.parent};if(this.isEdit){var a=e.id;this.$gql.mutation("updateOrganization(id:".concat(a,", data: $data){data{id}}"),{data:n},{data:"OrganizationInput!"}).then((function(){t.visible=!1,t.$message.success(t.$t("Modified successfully"),3),t.loaddata(!0)}))}else this.$gql.mutation("createOrganization(data: $data){data{id}}",{data:n},{data:"OrganizationInput!"}).then((function(){t.visible=!1,t.$message.success(t.$t("Created successfully"),3),t.loaddata(!0)}))},removeOrg:function(t,e,n){var a=this;this.$gql.mutation("deleteOrganization(id:".concat(n.id,"){data{id}}")).then((function(){a.$message.success(a.$t("Deleted successfully"),3),a.loaddata(!0)}))},manage:function(t,e,n){this.$router.push({path:"/system/organizations/detail/"+n.id})},setting:function(t,e,n){this.payload=n,this.payload.parent&&(this.payload.parent=""+this.payload.parent.id),this.isEdit=!0,this.showModal()},search:function(t,e){t&&(this.pageNo=t,this.pageSize=e),this.loaddata()},setTreeKey:function(t,e){var n=this;t&&t.forEach((function(t){t.key="".concat(e,"-").concat(t.id),t.children&&n.setTreeKey(t.children,e+1)}))},loaddata:function(t){var e=this;t||(this.loading=!0),this.$gql.query("organizations{data{id,attributes{name,parent{data{id,attributes{name}}},children{data{id,attributes{name}}}}}}").then((function(t){e.orgs=t.data})),this.$gql.query("getOrganizationsTree").then((function(t){e.orgTree=t,e.setTreeKey(e.orgTree,0),e.loading=!1}))}}};var E=(0,n(83744).Z)(x,[["render",function(t,e,n,r,o,m){var g=(0,a.up)("PlusCircleTwoTone"),v=(0,a.up)("HeadInfo"),w=(0,a.up)("PartitionOutlined"),y=(0,a.up)("a-divider"),_=(0,a.up)("EditOutlined"),$=(0,a.up)("a-menu-item"),k=(0,a.up)("SettingOutlined"),z=(0,a.up)("CloseOutlined"),b=(0,a.up)("a-popconfirm"),O=(0,a.up)("a-menu"),W=(0,a.up)("MoreOutlined"),C=(0,a.up)("a-dropdown"),T=(0,a.up)("a-tree"),D=(0,a.up)("a-result"),x=(0,a.up)("a-card"),E=(0,a.up)("a-input"),Z=(0,a.up)("FormItem"),P=(0,a.up)("a-descriptions-item"),U=(0,a.up)("a-textarea"),I=(0,a.up)("a-select-option"),q=(0,a.up)("a-select"),j=(0,a.up)("a-descriptions"),M=(0,a.up)("a-form"),S=(0,a.up)("a-modal"),N=(0,a.up)("PageLayout"),K=(0,a.Q2)("permission");return(0,a.wg)(),(0,a.j4)(N,{avatar:o.PartitionOutlined},{headerContent:(0,a.w5)((function(){return[l]})),extra:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.j4)(v,{class:"split-right",title:t.$t("Create organization")},{body:(0,a.w5)((function(){return[(0,a._)("div",null,[(0,a.Wm)(g,{onClick:m.add,class:"font-primary icon-menu rotate-icon"},null,8,["onClick"])])]})),_:1},8,["title"])),[[K,["organization:create"]]])]})),default:(0,a.w5)((function(){return[(0,a.Wm)(x,{title:t.$t("Organization Tree"),loading:o.loading},{extra:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("Drag to change level")),1)]})),default:(0,a.w5)((function(){return[o.orgTree?((0,a.wg)(),(0,a.j4)(T,{key:0,"block-node":"",class:"full",draggable:"",onDragenter:m.onDragEnter,onDrop:m.onDrop,"default-expand-all":!0,"tree-data":o.orgTree},{title:(0,a.w5)((function(e){var n,r,o;return[(0,a._)("div",{class:"min-width-200",onClick:function(t){return m.manage(null,null,e)}},[(0,a._)("div",d,[(0,a._)("div",s,[(0,a._)("div",null,[(0,a.Wm)(w,{class:"mr-10 primary"}),(0,a._)("b",c,(0,i.zw)(e.name),1),(0,a.Wm)(y,{type:"vertical"}),(0,a.Wm)(C,{placements:"topLeft"},{overlay:(0,a.w5)((function(){return[(0,a.Wm)(O,null,{default:(0,a.w5)((function(){return[(0,a.Wm)($,{key:"setting"},{default:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(t){return m.setting(null,null,e)}},[(0,a.Wm)(_),(0,a.Uk)(" "+(0,i.zw)(t.$t("edit")),1)],8,p)),[[K,["organization:update"]]])]})),_:2},1024),(0,a.Wm)($,{key:"manage"},{default:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(t){return m.manage(null,null,e)}},[(0,a.Wm)(k),(0,a.Uk)(" "+(0,i.zw)(t.$t("Administration")),1)],8,f)),[[K,["organization:update"]]])]})),_:2},1024),(0,a.Wm)($,null,{default:(0,a.w5)((function(){return[(0,a.Wm)(b,{placement:"topLeft","ok-text":t.$t("Yes"),"cancel-text":t.$t("No"),onConfirm:function(t){return m.removeOrg(null,null,e)}},{title:(0,a.w5)((function(){return[(0,a._)("p",null,(0,i.zw)(t.$t("Tip")),1),(0,a._)("p",null,(0,i.zw)(t.$t("Are you sure to remove this?")),1)]})),default:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",null,[(0,a.Wm)(z),(0,a.Uk)(" "+(0,i.zw)(t.$t("Remove")),1)])),[[K,["organization:delete"]]])]})),_:2},1032,["ok-text","cancel-text","onConfirm"])]})),_:2},1024)]})),_:2},1024)]})),default:(0,a.w5)((function(){return[(0,a._)("a",null,[(0,a.Wm)(W,{class:"icon-menu relative",style:{top:"2px"}})])]})),_:2},1024)]),(0,a._)("div",null,[(0,a.Uk)((0,i.zw)(t.$t("Project"))+" : "+(0,i.zw)(null===(n=e.projects)||void 0===n?void 0:n.length)+" ",1),(0,a.Wm)(y,{type:"vertical"}),(0,a.Uk)(" "+(0,i.zw)(t.$t("User"))+" : "+(0,i.zw)(null===(r=e.users)||void 0===r?void 0:r.length)+" ",1),(0,a.Wm)(y,{type:"vertical"}),(0,a.Uk)(" "+(0,i.zw)(t.$t("Service"))+" : "+(0,i.zw)(null===(o=e.services)||void 0===o?void 0:o.length),1)])])])],8,u)]})),_:1},8,["onDragenter","onDrop","tree-data"])):((0,a.wg)(),(0,a.j4)(D,{key:1,title:t.$t("No data")},{icon:(0,a.w5)((function(){return[h]})),_:1},8,["title"]))]})),_:1},8,["title","loading"]),(0,a.Wm)(S,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=function(t){return o.visible=t}),title:t.$t("Organization"),onOk:m.valid,width:"50%","ok-text":o.isEdit?t.$t("Save"):t.$t("create")},{default:(0,a.w5)((function(){return[(0,a.Wm)(M,{model:o.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,a.w5)((function(){return[(0,a.Wm)(j,{bordered:""},{default:(0,a.w5)((function(){return[(0,a.Wm)(P,{label:t.$t("as"),span:3},{default:(0,a.w5)((function(){return[(0,a.Wm)(Z,{name:"name",rules:t.rules.uniqueName("organizations",{id:o.payload.id})},{default:(0,a.w5)((function(){return[(0,a.Wm)(E,{placeholder:t.$t("unset"),value:o.payload.name,"onUpdate:value":e[0]||(e[0]=function(t){return o.payload.name=t})},{prefix:(0,a.w5)((function(){return[(0,a.Wm)(w,{type:"user"})]})),_:1},8,["placeholder","value"])]})),_:1},8,["rules"])]})),_:1},8,["label"]),(0,a.Wm)(P,{label:t.$t("Description"),span:3},{default:(0,a.w5)((function(){return[(0,a.Wm)(U,{value:o.payload.description,"onUpdate:value":e[1]||(e[1]=function(t){return o.payload.description=t}),placeholder:t.$t("unset"),"allow-clear":"",rows:4},null,8,["value","placeholder"])]})),_:1},8,["label"]),(0,a.Wm)(P,{label:t.$t("Parent Organization")},{default:(0,a.w5)((function(){return[(0,a.Wm)(q,{placeholder:t.$t("unset"),value:o.payload.parent,"onUpdate:value":e[2]||(e[2]=function(t){return o.payload.parent=t}),class:"width-180",ref:"select"},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.orgs,(function(t,e){return(0,a.wg)(),(0,a.j4)(I,{disabled:o.payload.id==t.id||o.payload.children&&o.payload.children.find((function(e){return e.id==t.id})),value:t.id,key:e},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.name),1)]})),_:2},1032,["disabled","value"])})),128))]})),_:1},8,["placeholder","value"])]})),_:1},8,["label"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["visible","title","onOk","ok-text"])]})),_:1},8,["avatar"])}],["__scopeId","data-v-059ed20a"]])}}]);