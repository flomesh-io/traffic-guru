"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[7102],{1299:function(t,e,a){a.d(e,{Z:function(){return r}});var l=a(66252),i=a(3577);const s={key:0,class:"title"};var n={name:"DetailList",props:{title:{type:String,required:!1,default:""},col:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"large"},layout:{type:String,required:!1,default:"horizontal"}}};var r=(0,a(83744).Z)(n,[["render",function(t,e,a,n,r,d){const o=(0,l.up)("a-row");return(0,l.wg)(),(0,l.iD)("div",{class:(0,i.C_)(["detail-list","small"===a.size?"small":"large","vertical"===a.layout?"vertical":"horizontal"]),style:(0,i.j5)("flex-"+a.col)},[a.title?((0,l.wg)(),(0,l.iD)("div",s,(0,i.zw)(a.title),1)):(0,l.kq)("",!0),(0,l.Wm)(o,null,{default:(0,l.w5)((()=>[(0,l.WI)(t.$slots,"default")])),_:3})],6)}]])},13589:function(t,e,a){a.d(e,{Z:function(){return d}});var l=a(66252),i=a(3577);const s={class:"detail-content"};const n={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}};var r={name:"DetailListItem",i18n:a(39945),props:{name:{type:String,required:!1,default:""},rules:{type:Array,required:!1,default(){return[]}},term:{type:String,required:!1,default:""},termTop:{type:Boolean}},data(){return{col:2,responsive:n}},computed:{getRules(){return this.rules.map((t=>(t.message=this.$t(t.message),t))),this.rules}},created(){this.$parent&&this.$parent.$parent&&this.$parent.$parent.col>0&&(this.col=this.$parent.$parent.col)},methods:{}};var d=(0,a(83744).Z)(r,[["render",function(t,e,a,n,r,d){const o=(0,l.up)("a-form-item"),h=(0,l.up)("a-col");return(0,l.wg)(),(0,l.j4)(h,(0,l.dG)({class:"detail-list-content flex"},r.responsive[r.col]),{default:(0,l.w5)((()=>[(0,l._)("div",{class:(0,i.C_)(a.termTop?"term top":"term")},(0,i.zw)(a.term),3),(0,l._)("div",s,[a.rules?((0,l.wg)(),(0,l.j4)(o,{key:0,name:a.name,rules:d.getRules},{default:(0,l.w5)((()=>[(0,l.WI)(t.$slots,"default")])),_:3},8,["name","rules"])):(0,l.WI)(t.$slots,"default",{key:1})])])),_:3},16)}]])},47102:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var l=a(66252),i=a(3577);const s={key:0},n={key:1,class:"gray"};a(57658);var r=a(61103),d=a(1299),o=a(33907),h=a(13589);const u=[{dataIndex:"name",title:"Name"},{dataIndex:"type",title:"Type"}],c=[{dataIndex:"name",title:"Name"},{dataIndex:"type",title:"Type"}];var m={name:"CheckpointDetail",i18n:a(89234),components:{DetailListItem:h.Z,DetailList:d.Z,PageLayout:r.Z},data(){return{detail:{healthcheck:{id:""},fleet:{id:""},content:{targets:[]},name:"",location:""},targetsVal:[],healthcheck:[],key:"",pageSize:10,pageNo:1,total:0,list:[],checkpoints:[],leftColumns:u,rightColumns:c}},computed:{...(0,o.rn)({rules:t=>t.rules.rules,isMobile:t=>t.setting.isMobile}),dataLeftColumns(){return this.leftColumns.map((t=>(t.title=this.$t(t.title),t)))},dataRightColumns(){return this.leftColumns.map((t=>(t.title=this.$t(t.title),t)))},start(){return(this.pageNo-1)*this.pageSize}},created(){this.pid=this.$route.params.id||"",this.uniSearch(),this.$gql.query("healthchecks{data{id,attributes{name,content}}}").then((t=>{this.healthcheck=t.data})),this.$gql.query('fleets(filters:{type:{eq:"checkpoint"}}){data{id,attributes{name}}}').then((t=>{this.checkpoints=t.data})),""!=this.pid?(this.loading=!0,this.$gql.query(`dialTesting(id: ${this.pid}){data{id,attributes{\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\thealthcheck{data{id}},\n\t\t\t\t\t\tfleet{data{id}},\n\t\t\t\t\t\tservices{data{id}},\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t}}}`).then((t=>{let e=t.data;this.detail=e,this.detail.healthcheck=e.healthcheck,this.detail.fleet=e.fleet;let a=[];e.content.targets&&e.content.targets.forEach((t=>{a.push(`${t.id},${t.type},${t.name}`)})),this.targetsVal=a,this.loading=!1}))):(this.detail={healthcheck:{id:""},fleet:{id:""},checkpoints:[],content:{targets:[]},name:"",location:""},this.loading=!1),this.pid},methods:{onTabChange(t){},valid(){return""==this.detail.name?(this.$message.error(this.$t("The name cannot be empty"),3),!1):0!=this.targetsVal.length||(this.$message.error(this.$t("The targets cannot be empty"),3),!1)},validate(){this.$refs.layout.$refs.form.validateFields().then((()=>{this.save()})).catch((()=>{}))},save(){if(!this.valid())return;let t=[];for(const e of this.targetsVal){let a=e.split(",");t.push({id:a[0],type:a[1],name:a[2]})}this.detail.content.targets=t;let e=t.filter((t=>"service"==t.type));e=e.map((t=>Number(t.id)));let a={name:this.detail.name,healthcheck:this.detail.healthcheck.id,fleet:this.detail.fleet.id,content:this.detail.content,services:e};""!=this.pid?this.$gql.mutation(`updateDialTesting(id:${this.pid}, data: $data){data{id}}`,{data:a},{data:"DialTestingInput!"}).then((()=>{this.$message.success(this.$t("Save successfully"),3),this.$closePage(this.$route)})):this.$gql.mutation("createDialTesting(data: $data){data{id}}",{data:a},{data:"DialTestingInput!"}).then((t=>{this.pid=t.data.id,this.$message.success(this.$t("Created successfully"),3),this.$closePage(this.$route)}))},handleChange(){},hide(){this.visible=!1,this.validate()},onChange(t){this.targetsVal=t},getRowSelection(t,e,a,l){return{getCheckboxProps:e=>({disabled:t||e.disabled}),onSelectAll(t,e){const l=e.filter((t=>!t.disabled)).map((({key:t})=>t));a(l,t)},onSelect(t,e){l(t.key,e)},selectedRowKeys:e}},search(t,e){"left"==t&&(this.key=e,this.uniSearch())},pagging(t){this.pageNo=t},uniSearch(t,e){t&&(this.pageNo=t,this.pageSize=e),this.loading=!0;const a={type:["upstream"],name:this.key};this.$gql.query(`uniSearch(filters: $filters, pagination:{start: 0, limit: ${this.$DFT_LIMIT}})`,{filters:a}).then((t=>{this.list=t.data,this.list.forEach((t=>{t.key=`${t.target_id},${t.type},${t.name}`})),this.total=t.pagination.total,this.loading=!1}))}}};var p=(0,a(83744).Z)(m,[["render",function(t,e,a,r,d,o){const h=(0,l.up)("a-input"),u=(0,l.up)("DetailListItem"),c=(0,l.up)("a-select-option"),m=(0,l.up)("a-select"),p=(0,l.up)("DetailList"),g=(0,l.up)("a-button"),f=(0,l.up)("a-table"),$=(0,l.up)("a-transfer"),y=(0,l.up)("a-card"),w=(0,l.up)("a-col"),k=(0,l.up)("a-row"),v=(0,l.up)("PageLayout");return(0,l.wg)(),(0,l.j4)(v,{title:d.detail.name?d.detail.name:t.$t("Dial Test"),"form-state":d.detail,ref:"layout"},{headerContent:(0,l.w5)((()=>[(0,l.Wm)(p,{size:"small",col:1},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{term:t.$t("as"),rules:t.rules.uniqueName("dialTestings",{id:t.pid}),name:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{placeholder:t.$t("unset"),value:d.detail.name,"onUpdate:value":e[0]||(e[0]=t=>d.detail.name=t),class:"width-200"},null,8,["placeholder","value"])])),_:1},8,["term","rules"]),(0,l.Wm)(u,{term:t.$t("Healthcheck"),rules:t.rules.required,name:["healthcheck","id"]},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{placeholder:t.$t("unallocated"),class:"width-200",value:d.detail.healthcheck.id,"onUpdate:value":e[1]||(e[1]=t=>d.detail.healthcheck.id=t),onChange:e[2]||(e[2]=t=>o.handleChange())},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.healthcheck,((t,e)=>((0,l.wg)(),(0,l.j4)(c,{key:e,value:t.id},{default:(0,l.w5)((()=>[t.name?((0,l.wg)(),(0,l.iD)("span",s,(0,i.zw)(t.name),1)):(0,l.kq)("",!0),t.name?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("i",n,(0,i.zw)(t.name),1))])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term","rules"]),(0,l.Wm)(u,{term:t.$t("Checkpoints"),rules:t.rules.required,name:["fleet","id"]},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{placeholder:t.$t("unallocated"),class:"width-200",value:d.detail.fleet.id,"onUpdate:value":e[3]||(e[3]=t=>d.detail.fleet.id=t),onChange:e[4]||(e[4]=t=>o.handleChange())},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.checkpoints,((t,e)=>((0,l.wg)(),(0,l.j4)(c,{key:e,value:t.id},{default:(0,l.w5)((()=>[(0,l._)("span",null,(0,i.zw)(t.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term","rules"])])),_:1})])),action:(0,l.w5)((()=>[(0,l.Wm)(g,{type:"primary",onClick:o.validate},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(""!=t.pid?t.$t("save"):t.$t("create")),1)])),_:1},8,["onClick"])])),default:(0,l.w5)((()=>[(0,l.Wm)(k,{class:"row-mg"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{title:t.$t("Checkpoint Target")},{default:(0,l.w5)((()=>[(0,l.Wm)($,{titles:[" "+t.$t("Checkpoint Target")," "+t.$t("Added")],"data-source":d.list,"target-keys":d.targetsVal,"onUpdate:target-keys":e[5]||(e[5]=t=>d.targetsVal=t),"show-search":!0,"filter-option":(t,e)=>-1!==e.name.indexOf(t),"show-select-all":!1,onSearch:o.search,onChange:o.onChange},{children:(0,l.w5)((({direction:e,filteredItems:a,selectedKeys:s,disabled:n,onItemSelectAll:r,onItemSelect:h})=>[(0,l.Wm)(f,{"row-selection":o.getRowSelection(n,s,r,h),columns:"left"===e?o.dataLeftColumns:o.dataRightColumns,"data-source":a,size:"small",pagination:"left"===e&&{onChange:o.pagging,current:d.pageNo,pageSize:d.pageSize,showTotal:(e,a)=>`${t.$t("Total")} ${e}`,total:d.total},style:(0,i.j5)({pointerEvents:n?"none":null}),"custom-row":({key:t,disabled:e})=>({onClick:()=>{e||n||h(t,!s.includes(t))}})},null,8,["row-selection","columns","data-source","pagination","style","custom-row"])])),_:1},8,["titles","data-source","target-keys","filter-option","onSearch","onChange"])])),_:1},8,["title"])])),_:1})])),_:1})])),_:1},8,["title","form-state"])}]])}}]);