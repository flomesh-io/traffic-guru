"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[3005],{85117:function(t,e,n){var i=n(66330),a=TypeError;t.exports=function(t,e){if(!delete t[e])throw a("Cannot delete property "+i(e)+" of "+i(t))}},30541:function(t,e,n){var i=n(82109),a=n(47908),l=n(26244),s=n(83658),r=n(85117),d=n(7207),o=1!==[].unshift(0),u=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:o||u},{unshift:function(t){var e=a(this),n=l(e),i=arguments.length;if(i){d(n+i);for(var o=n;o--;){var u=o+i;o in e?e[u]=e[o]:r(e,u)}for(var c=0;c<i;c++)e[c]=arguments[c]}return s(e,n+i)}})},71900:function(t,e,n){n.d(e,{Z:function(){return r}});var i=n(66252),a=n(3577);const l={class:"head-info"};var s={name:"HeadInfo",props:["title","content"]};var r=(0,n(83744).Z)(s,[["render",function(t,e,n,s,r,d){return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("span",null,(0,a.zw)(n.title),1),(0,i._)("p",null,[(0,i.Uk)((0,a.zw)(n.content),1),(0,i.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},83005:function(t,e,n){n.r(e),n.d(e,{default:function(){return $}});var i=n(66252),a=n(3577);const l=(t=>((0,i.dD)("data-v-cf31ed4c"),t=t(),(0,i.Cn)(),t))((()=>(0,i._)("div",null,null,-1))),s={class:"min-width-200"},r={class:"font-16"},d={key:0},o={class:"min-width-200"},u={key:0};n(30541),n(57658);var c=n(21826),h=n(62611),p=n(30631),m=n(10973),f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},y=n(33058);function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){b(t,e,n[e])}))}return t}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v=function(t,e){var n=g({},t,e.attrs);return(0,i.Wm)(y.Z,g({},n,{icon:f}),null)};v.displayName="SaveOutlined",v.inheritAttrs=!1;var w=v,k=n(61103),S=n(71900),O=n(33907),E=n(85263),_={name:"RouterSetting",components:{HeadInfo:S.Z,PageLayout:k.Z,SyncOutlined:c.Z,PartitionOutlined:h.Z,EyeOutlined:p.Z,EyeInvisibleOutlined:m.Z,SaveOutlined:w},i18n:n(89234),data(){return{users:[],menus:[],checkedKeys:[],menuTree:[],PartitionOutlined:h.Z,isEdit:!1,selectProjects:[],selectUsers:[],roles:[],expandedKeys:[],visible:!1,payload:{id:"",name:"",parent:null,description:""},hasRouterSettingMenu:!1,routerSettingMenu:{showEnv:!0,showZone:!0},bindTarget:{},workload:[],projects:[],loading:!0,activities:[],config:{},teams:[],simpleImage:E.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,O.Se)("account",["user"])},mounted(){this.loaddata()},methods:{onDragEnter(){},displayNameChange(t,e){this.menuTree.forEach((n=>{n.fullPath==t.fullPath&&(n.displayName=e),n.children&&n.children.forEach((n=>{n.fullPath==t.fullPath&&(n.displayName=e)}))}))},onDrop(t){const e=t.node.key,n=t.dragNode.key,i=t.node.pos.split("-"),a=t.dropPosition-1*i[i.length-1],l=(t,e,n)=>{t.forEach(((i,a)=>i.key===e?n(i,a,t):i.children?l(i.children,e,n):void 0))},s=[...this.menuTree];let r;if(l(s,n,((t,e,n)=>{n.splice(e,1),r=t})),t.dropToGap)if((t.node.children||[]).length>0&&t.node.expanded&&1===a)l(s,e,(t=>{t.children=t.children||[],t.children.unshift(r)}));else{let t=[],n=0;l(s,e,((e,i,a)=>{t=a,n=i})),-1===a?t.splice(n,0,r):t.splice(n+1,0,r)}else l(s,e,(t=>{t.children=t.children||[],t.children.unshift(r)}))},add(){this.isEdit=!1,this.handleOk()},edit(){this.isEdit=!0,this.handleOk()},handleOk(){this.loading=!0;let t=[];if(this.isEdit)t=this.resetRouterOptions(this.menuTree);else{let e=".pro";n(75688)(`./config${e}`).default.initRoutes.forEach((e=>{"/"==e.path&&(t=this.buildRouterOptions(e.children,"",1))}))}this.$gql.mutation("batchCreateRouterSetting(data: $data)",{data:t},{data:"JSON"}).then((()=>{this.visible=!1,this.menuTree=[],this.isEdit?this.$message.success(this.$t("Save successfully"),3):this.$message.success(this.$t("Created successfully"),3),this.loaddata()})),this.saveRouterSettingMenu()},saveRouterSettingMenu(){let t=JSON.parse(JSON.stringify(this.routerSettingMenu));this.hasRouterSettingMenu?(delete t.id,this.$gql.mutation(`updateSystemSetting(id:${this.routerSettingMenu.id}, data: $data){data{id}}`,{data:{type:"RouterSetting",content:t}},{data:"SystemSettingInput!"}).then((()=>{}))):this.$gql.mutation("createSystemSetting(data: $data){data{id}}",{data:{type:"RouterSetting",content:t}},{data:"SystemSettingInput!"}).then((()=>{}))},setTreeKey(t){return t?(t.forEach((t=>{t.key=`${t.level}-${t.id}`,t.enabled=!t.disabled,t.displayName=t.displayName?t.displayName:"",delete t.disabled,t.children&&t.enabled&&t.children.forEach((e=>{e.disabled&&(t.enabled=!1)})),t.enabled&&this.checkedKeys.push(t.key),t.children&&(t.children=this.setTreeKey(t.children))})),t):[]},loaddata(){this.menuTree=[],this.checkedKeys=[],this.loading=!0,this.$gql.query('routerSettings(sort: "sort:asc", pagination: {limit: 9999 }, filters: { level: { eq: 1 } }){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdisplayName,\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tfullPath,\n\t\t\t\t\t\tdisabled,\n\t\t\t\t\t\tauthority,\n\t\t\t\t\t\tinvisible,\n\t\t\t\t\t\tsort,\n\t\t\t\t\t\tlevel,\n\t\t\t\t\t\tparent{data{id,attributes{name,displayName,path,fullPath,disabled,authority,invisible,sort,level}}},\n\t\t\t\t\t\tchildren(pagination: {limit: 9999}){data{id,attributes{name,displayName,path,fullPath,disabled,authority,invisible,sort,level}}}\n\t\t\t\t\t}}}').then((t=>{this.menuTree=this.setTreeKey(JSON.parse(JSON.stringify(t.data))),this.loading=!1,t=[]})),this.$gql.query('systemSettings(filters:{type:{eq:"RouterSetting"}}){data{id,attributes{mode,content}}}').then((t=>{let e=t.data;this.hasRouterSettingMenu=e&&e.length>0,this.hasRouterSettingMenu?this.routerSettingMenu={...e[0].content,id:e[0].id}:this.routerSettingMenu={showEnv:!0,showZone:!0}}))},resetRouterOptions(t){let e=[],n=this.checkedKeys;return t&&t.forEach(((t,i)=>{let a="router-setting"!=t.path&&!n.find((e=>e==t.key));t.children&&a&&t.children.forEach((t=>{t.enabled&&(a=!1)})),e.push({name:t.name,displayName:t.displayName,path:t.path,sort:i,authority:t.authority||"*",fullPath:t.fullPath,invisible:!!t.invisible,disabled:a,level:t.level,children:this.resetRouterOptions(t.children)})})),e},buildRouterOptions(t,e,n){let i=[];const a=["/flb/dashboard","/flb/4lb/list","/flb/4lb/detail/:id","/flb/4lb/create","/flb/address/detail/:id","/flb/address/create","/flb/address/list","/flb/lbevent/list"];return t&&t.forEach(((t,l)=>{let s=t.meta?t.meta:{},r=`${e}/${t.path}`,d=!!s.disabled;"/flb"==e&&-1==a.indexOf(r)&&(d=!0),i.push({name:t.name,displayName:"",path:t.path,sort:l,authority:s.authority&&s.authority.permission?s.authority.permission:"string"==typeof s.authority?s.authority:"",fullPath:r,invisible:!!s.invisible,disabled:d,level:n,children:this.buildRouterOptions(t.children,r,n+1)})})),i}}};var $=(0,n(83744).Z)(_,[["render",function(t,e,n,c,h,p){const m=(0,i.up)("SyncOutlined"),f=(0,i.up)("HeadInfo"),y=(0,i.up)("SaveOutlined"),g=(0,i.up)("a-typography-paragraph"),b=(0,i.up)("a-tree"),v=(0,i.up)("a-card"),w=(0,i.up)("a-col"),k=(0,i.up)("EyeOutlined"),S=(0,i.up)("EyeInvisibleOutlined"),O=(0,i.up)("a-switch"),E=(0,i.up)("a-descriptions-item"),_=(0,i.up)("a-descriptions"),$=(0,i.up)("a-row"),P=((0,i.up)("PartitionOutlined"),(0,i.up)("PageLayout")),N=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(P,{avatar:h.PartitionOutlined},{headerContent:(0,i.w5)((()=>[l])),extra:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(f,{class:"split-right",title:t.$t("Initialization Menu")},{body:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(m,{onClick:p.add,class:"font-primary icon-menu rotate-icon"},null,8,["onClick"])])])),_:1},8,["title"])),[[N,["admin"]]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(f,{class:"split-right",title:t.$t("Save")},{body:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(y,{onClick:p.edit,class:"font-primary icon-menu"},null,8,["onClick"])])])),_:1},8,["title"])),[[N,["admin"]]])])),default:(0,i.w5)((()=>[(0,i.Wm)($,{class:"row-mg"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"col-pd",xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{title:t.$t("Menu Tree"),loading:h.loading},{extra:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.$t("Drag to change level")),1)])),default:(0,i.w5)((()=>[(0,i.Wm)(b,{"show-line":!0,class:"full",draggable:!0,checkedKeys:h.checkedKeys,"onUpdate:checkedKeys":e[0]||(e[0]=t=>h.checkedKeys=t),checkable:"",onDragenter:p.onDragEnter,onDrop:p.onDrop,"default-expand-all":!1,"tree-data":h.menuTree},{title:(0,i.w5)((e=>[(0,i._)("div",s,[(0,i._)("b",r,[e.displayName?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("span",d,(0,a.zw)(t.$t(e.name)),1)),(0,i.Wm)(g,{class:"inline-block",content:e.displayName,"onUpdate:content":t=>e.displayName=t,editable:{onChange:p.displayNameChange(e,e.displayName)}},null,8,["content","onUpdate:content","editable"])])]),(0,i._)("div",o,[(0,i.Uk)((0,a.zw)(t.$t("Full Path"))+" : "+(0,a.zw)(e.fullPath)+" ",1),e.authority?((0,i.wg)(),(0,i.iD)("span",u,[(0,i.Uk)(" | "+(0,a.zw)(t.$t("Authority"))+": ",1),(0,i.Wm)(g,{class:"inline-block",content:e.authority,"onUpdate:content":t=>e.authority=t,editable:""},null,8,["content","onUpdate:content"])])):(0,i.kq)("",!0)])])),_:1},8,["checkedKeys","onDragenter","onDrop","tree-data"])])),_:1},8,["title","loading"])])),_:1}),(0,i.Wm)(w,{class:"col-pd",xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{class:"nopd",title:t.$t("Other Settings"),loading:h.loading},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{bordered:"",style:{"min-height":"650px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(E,{label:t.$t("Zone"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(O,{checked:h.routerSettingMenu.showZone,"onUpdate:checked":e[1]||(e[1]=t=>h.routerSettingMenu.showZone=t)},{checkedChildren:(0,i.w5)((()=>[(0,i.Wm)(k)])),unCheckedChildren:(0,i.w5)((()=>[(0,i.Wm)(S)])),_:1},8,["checked"])])),_:1},8,["label"]),(0,i.Wm)(E,{label:t.$t("ENV"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(O,{checked:h.routerSettingMenu.showEnv,"onUpdate:checked":e[2]||(e[2]=t=>h.routerSettingMenu.showEnv=t)},{checkedChildren:(0,i.w5)((()=>[(0,i.Wm)(k)])),unCheckedChildren:(0,i.w5)((()=>[(0,i.Wm)(S)])),_:1},8,["checked"])])),_:1},8,["label"])])),_:1})])),_:1},8,["title","loading"])])),_:1})])),_:1}),(0,i.kq)("",!0)])),_:1},8,["avatar"])}],["__scopeId","data-v-cf31ed4c"]])}}]);