"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[9682],{9294:function(t,e,a){a.d(e,{Z:function(){return o}});var n=a(66252);a(74916),a(15306);var i=a(29764);(0,a(25552).H)({id:"javascript",extensions:[".js",".es6",".jsx",".mjs"],firstLine:"^#!.*\\bnode",filenames:["jakefile"],aliases:["JavaScript","javascript","js"],mimetypes:["text/javascript"],loader:function(){return a.e(6015).then(a.bind(a,6015))}});var l={name:"JsEditor",components:{monacoeditor:i.Z},props:["value","height","isReadonly","id","theme"],data:function(){return{code:"",cmOptions:{lineNumbers:!0,mode:"javascript",readOnly:!1,lint:!0}}},watch:{value:function(t,e){t!==e&&this.setValue()}},mounted:function(){this.setValue()},methods:{change:function(t){"string"==typeof t&&(this.$emit("update:value",t),this.$emit("change",t))},setValue:function(){null!=this.value.replace&&(this.code=this.value)}}};var o=(0,a(83744).Z)(l,[["render",function(t,e,a,i,l,o){var s=(0,n.up)("monacoeditor");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(s,{id:a.id||"JsEditor",content:l.code,"onUpdate:content":e[0]||(e[0]=function(t){return l.code=t}),option:l.cmOptions,onChange:o.change,height:a.height,theme:a.theme,"is-readonly":a.isReadonly},null,8,["id","content","option","onChange","height","theme","is-readonly"])])}]])},48397:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});a(68309),a(47941);var n=a(66252),i=a(3577),l=a(49963),o={key:0},s={class:"font-primary",href:"javascript:void(0)"},r={key:1},u={class:"font-primary",href:"javascript:void(0)"},d={key:2};var c=a(95082),m=(a(74916),a(64765),a(41539),a(69600),a(21936)),f=a(9294),p=a(61103),h=a(1299),w=a(13589),g=a(33907),b=a(15199),k=a(84722),v=a(44218),y=a(96486),$=a.n(y),C={name:"EgressDetail",i18n:a(89234),components:{JsEditor:f.Z,IPList:b.Z,JsonEditor:m.Z,DetailListItem:w.Z,DetailList:h.Z,PageLayout:p.Z,PlusOutlined:v.Z},data:function(){return{labelVisible:!1,labelValue:"",annotationVisible:!1,creationTimestamp:"-",annotationValue:"",pjsConfig:"",detail:{metadata:{name:"",protocol:"Socks",labels:{},annotations:{}},typeMeta:{},selector:{}},loading:!0,port:"",pid:"",namespace:"",whiteAddress:[],blackAddress:[],isMounted:!1,metrics:[]}},computed:(0,c.Z)({},(0,g.rn)({rules:function(t){return t.rules.rules},isMobile:function(t){return t.setting.isMobile}})),created:function(){this.pid=this.$route.params.id||"",this.namespace=this.$route.params.namespace||localStorage.getItem("NAMESPACE"),this.getDefaultPjsConfig()},mounted:function(){this.isMounted=!0,""!=this.pid?this.search():(this.detail={metadata:{name:"",namespace:this.namespace,protocol:"Socks",labels:{},annotations:{}},typeMeta:{},selector:{}},this.loading=!1)},methods:{handleClose:function(t,e){delete t[e]},pjsChange:function(t){this.pjsConfig=t},getDefaultPjsConfig:function(){var t=this;fetch("pipy-4lb.js").then((function(t){return t.text()})).then((function(e){t.pjsConfig=e})).catch((function(t){}))},labelShowInput:function(){var t=this;this.labelVisible=!0,this.$nextTick().then((function(){t.$refs.labelRef.focus()}))},labelInputConfirm:function(){if(""!=this.labelValue){var t=this.labelValue.split(":");t.length<2?this.$message.error({content:this.$t("Please enter the format of [key]:[value]")}):(this.detail.metadata.labels=this.detail.metadata.labels||{},this.detail.metadata.labels[t.shift()]=t.join(":"),this.labelValue="",this.labelVisible=!1)}else this.labelVisible=!1},annotationShowInput:function(){var t=this;this.annotationVisible=!0,this.$nextTick().then((function(){t.$refs.annotationRef.focus()}))},annotationInputConfirm:function(){if(""!=this.annotationValue){var t=this.annotationValue.split(":");t.length<2?this.$message.error({content:this.$t("Please enter the format of [key]:[value]")}):(this.detail.metadata.annotations=this.detail.metadata.annotations||{},this.detail.metadata.annotations[t.shift()]=t.join(":"),this.annotationValue="",this.annotationVisible=!1)}else this.annotationVisible=!1},search:function(){var t=this;this.loading=!0,this.$gql.query("getEgress(id: ".concat(this.pid,"){data{id,attributes{content,createdAt}}}")).then((function(e){var a=e.data;t.loading=!1,t.creationTimestamp=new Date(a.createdAt).toLocaleString(),t.detail=a.content,"Socks"==t.detail.metadata.protocol&&(t.port=t.detail.socks.port,t.whiteAddress=(0,k.Oy)(t.detail.socks.whiteAddress),t.blackAddress=(0,k.Oy)(t.detail.socks.blackAddress))}))},valid:function(){return""==this.detail.metadata.name?(this.$message.error(this.$t("The name cannot be empty"),3),!1):"Socks"==this.detail.metadata.protocol&&""==this.port?(this.$message.error(this.$t("Port is required"),3),!1):"Socks"==this.detail.metadata.protocol&&isNaN(this.port)?(this.$message.error(this.$t("The port can only enter numbers"),3),!1):this.$refs.whiteip.valid()&&this.$refs.blackip.valid()},save:function(){var t=this;if(this.valid()){var e=$().cloneDeep(this.detail);"Socks"==this.detail.metadata.protocol&&(e.socks={port:this.port,whiteAddress:(0,k.H)(this.whiteAddress),blackAddress:(0,k.H)(this.blackAddress)}),""!=this.pid?this.$gql.mutation("updateEgressSync(id:".concat(this.pid,", data: $data){data{id}}"),{data:{name:this.detail.metadata.name,content:e}},{data:"EgressInput!"}).then((function(){t.$message.success(t.$t("Save successfully"),3),t.$closePage(t.$route)})):this.$gql.mutation("createEgressSync(data: $data){data{id}}",{data:{name:this.detail.metadata.name,content:e}},{data:"EgressInput!"}).then((function(e){t.pid=e.data.id,t.$message.success(t.$t("Created successfully"),3),t.$closePage(t.$route)}))}},validate:function(){var t=this;this.$refs.layout.$refs.form.validateFields().then((function(){t.save()})).catch((function(){}))}}};var _=(0,a(83744).Z)(C,[["render",function(t,e,a,c,m,f){var p=(0,n.up)("DetailListItem"),h=(0,n.up)("a-input"),w=(0,n.up)("a-select-option"),g=(0,n.up)("a-select"),b=(0,n.up)("DetailList"),k=(0,n.up)("a-tag"),v=(0,n.up)("PlusOutlined"),y=(0,n.up)("a-tooltip"),$=(0,n.up)("JsonEditor"),C=(0,n.up)("a-popover"),_=(0,n.up)("a-button"),j=(0,n.up)("IPList"),W=(0,n.up)("a-col"),V=(0,n.up)("a-row"),P=(0,n.up)("a-card"),I=(0,n.up)("a-tab-pane"),S=(0,n.up)("JsEditor"),U=(0,n.up)("a-tabs"),T=(0,n.up)("PageLayout"),A=(0,n.Q2)("permission");return(0,n.wg)(),(0,n.j4)(T,{title:t.$t("Egress"),"form-state":m.detail.metadata,ref:"layout"},{headerContent:(0,n.w5)((function(){return[(0,n.Wm)(b,{size:"small",col:1},{default:(0,n.w5)((function(){return[""!=m.pid?((0,n.wg)(),(0,n.j4)(p,{key:0,term:t.$t("UID")},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(m.detail.metadata.uid),1)]})),_:1},8,["term"])):(0,n.kq)("",!0),(0,n.Wm)(p,{term:t.$t("as"),rules:t.rules.name,name:"name"},{default:(0,n.w5)((function(){return[(0,n.Wm)(h,{placeholder:t.$t("unset"),value:m.detail.metadata.name,"onUpdate:value":e[0]||(e[0]=function(t){return m.detail.metadata.name=t}),class:"bold width-300"},null,8,["placeholder","value"])]})),_:1},8,["term","rules"]),(0,n.Wm)(p,{term:t.$t("Namespace")},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(m.detail.metadata.namespace),1)]})),_:1},8,["term"]),(0,n.Wm)(p,{term:t.$t("protocol")},{default:(0,n.w5)((function(){return[(0,n.Wm)(g,{value:m.detail.metadata.protocol,"onUpdate:value":e[1]||(e[1]=function(t){return m.detail.metadata.protocol=t}),class:"width-200"},{default:(0,n.w5)((function(){return[(0,n.Wm)(w,{value:"HTTP"},{default:(0,n.w5)((function(){return[(0,n.Uk)(" HTTP ")]})),_:1}),(0,n.Wm)(w,{value:"Socks"},{default:(0,n.w5)((function(){return[(0,n.Uk)(" Socks ")]})),_:1}),(0,n.Wm)(w,{value:"TCP"},{default:(0,n.w5)((function(){return[(0,n.Uk)(" TCP ")]})),_:1})]})),_:1},8,["value"])]})),_:1},8,["term"]),m.pid?((0,n.wg)(),(0,n.j4)(p,{key:1,term:t.$t("Creation Timestamp")},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(m.creationTimestamp),1)]})),_:1},8,["term"])):(0,n.kq)("",!0)]})),_:1}),m.pid?((0,n.wg)(),(0,n.j4)(b,{key:0,size:"small",col:1},{default:(0,n.w5)((function(){return[(0,n.Wm)(p,{term:t.$t("Labels")},{default:(0,n.w5)((function(){return[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(Object.keys(m.detail.metadata.labels||[]),(function(t,e){return(0,n.wg)(),(0,n.j4)(k,{key:e,onClose:function(e){return f.handleClose(m.detail.metadata.labels,t)},closable:!0},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(t)+":"+(0,i.zw)(m.detail.metadata.labels[t]),1)]})),_:2},1032,["onClose"])})),128)),(0,n.wy)((0,n.Wm)(h,{ref:"labelRef",type:"text",size:"small",class:"width-100",placeholder:"[KEY:VALUE]",value:m.labelValue,"onUpdate:value":e[2]||(e[2]=function(t){return m.labelValue=t}),onBlur:f.labelInputConfirm,onKeyup:(0,l.D2)(f.labelInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"]),[[l.F8,m.labelVisible]]),m.labelVisible?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(k,{key:0,onClick:f.labelShowInput,class:"dashed-tag"},{default:(0,n.w5)((function(){return[(0,n.Wm)(v),(0,n.Uk)(" { {$t('add') }} ")]})),_:1},8,["onClick"]))]})),_:1},8,["term"]),(0,n.Wm)(p,{term:t.$t("Annotations")},{default:(0,n.w5)((function(){return[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(Object.keys(m.detail.metadata.annotations||[]),(function(t,e){return(0,n.wg)(),(0,n.j4)(k,{key:e,closable:!0,onClose:function(e){return f.handleClose(m.detail.metadata.annotations,t)},class:"mb-5"},{default:(0,n.w5)((function(){return["objectset.rio.cattle.io/applied"==t?((0,n.wg)(),(0,n.iD)("span",o,[(0,n.Wm)(y,{placement:"topLeft",title:m.detail.metadata.annotations[t]},{default:(0,n.w5)((function(){return[(0,n._)("a",s,(0,i.zw)(t),1)]})),_:2},1032,["title"])])):"kubectl.kubernetes.io/last-applied-configuration"==t?((0,n.wg)(),(0,n.iD)("span",r,[(0,n.Wm)(C,{trigger:"click",title:t},{content:(0,n.w5)((function(){return[(0,n.Wm)($,{"is-json":!0,value:m.detail.metadata.annotations[t]},null,8,["value"])]})),default:(0,n.w5)((function(){return[(0,n._)("a",u,(0,i.zw)(t),1)]})),_:2},1032,["title"])])):((0,n.wg)(),(0,n.iD)("span",d,(0,i.zw)(t)+":"+(0,i.zw)(m.detail.metadata.annotations[t]),1))]})),_:2},1032,["onClose"])})),128)),(0,n.wy)((0,n.Wm)(h,{ref:"annotationRef",type:"text",size:"small",class:"width-100",placeholder:"[KEY:VALUE]",value:m.annotationValue,"onUpdate:value":e[3]||(e[3]=function(t){return m.annotationValue=t}),onBlur:f.annotationInputConfirm,onKeyup:(0,l.D2)(f.annotationInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"]),[[l.F8,m.annotationVisible]]),m.annotationVisible?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(k,{key:0,onClick:f.annotationShowInput,class:"dashed-tag"},{default:(0,n.w5)((function(){return[(0,n.Wm)(v),(0,n.Uk)(" "+(0,i.zw)(t.$t("add")),1)]})),_:1},8,["onClick"]))]})),_:1},8,["term"])]})),_:1})):(0,n.kq)("",!0)]})),action:(0,n.w5)((function(){return[""!=m.pid?(0,n.wy)(((0,n.wg)(),(0,n.j4)(_,{key:0,type:"primary",onClick:f.validate},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(t.$t("save")),1)]})),_:1},8,["onClick"])),[[A,["egress:update"]]]):(0,n.wy)(((0,n.wg)(),(0,n.j4)(_,{key:1,type:"primary",onClick:f.validate},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(t.$t("create")),1)]})),_:1},8,["onClick"])),[[A,["egress:create"]]])]})),default:(0,n.w5)((function(){return[(0,n.Wm)(V,{class:"row-mg"},{default:(0,n.w5)((function(){return[(0,n.Wm)(W,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,n.w5)((function(){return[(0,n.Wm)(U,{type:"card"},{default:(0,n.w5)((function(){return[(0,n.Wm)(I,{key:"1",tab:t.$t("Overview")},{default:(0,n.w5)((function(){return["Socks"==m.detail.metadata.protocol?((0,n.wg)(),(0,n.j4)(P,{key:0,class:"card mb-20",bordered:!1,loading:m.loading,title:t.$t("Socks")},{default:(0,n.w5)((function(){return[(0,n.Wm)(b,{size:"small",col:1},{default:(0,n.w5)((function(){return[(0,n.Wm)(p,{term:t.$t("port")},{default:(0,n.w5)((function(){return[(0,n.Wm)(h,{placeholder:t.$t("unset"),value:m.port,"onUpdate:value":e[4]||(e[4]=function(t){return m.port=t}),class:"wdith-300"},null,8,["placeholder","value"])]})),_:1},8,["term"])]})),_:1}),(0,n.Wm)(V,{class:"row-mg"},{default:(0,n.w5)((function(){return[(0,n.Wm)(W,{class:"col-pd",xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,n.w5)((function(){return[(0,n.Wm)(j,{"fixed-type":4,title:t.$t("IP White List"),list:m.whiteAddress,ref:"whiteip"},null,8,["title","list"])]})),_:1}),(0,n.Wm)(W,{class:"col-pd",xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,n.w5)((function(){return[(0,n.Wm)(j,{"fixed-type":4,title:t.$t("IP Black List"),list:m.blackAddress,ref:"blackip"},null,8,["title","list"])]})),_:1})]})),_:1})]})),_:1},8,["loading","title"])):(0,n.kq)("",!0),"HTTP"==m.detail.metadata.protocol?((0,n.wg)(),(0,n.j4)(P,{key:1,class:"card mb-20",bordered:!1,loading:m.loading,title:t.$t("HTTP")},null,8,["loading","title"])):(0,n.kq)("",!0),"TCP"==m.detail.metadata.protocol?((0,n.wg)(),(0,n.j4)(P,{key:2,class:"card mb-20",bordered:!1,loading:m.loading,title:t.$t("TCP")},null,8,["loading","title"])):(0,n.kq)("",!0)]})),_:1},8,["tab"]),(0,n.Wm)(I,{key:"3",tab:t.$t("Strategy")},{default:(0,n.w5)((function(){return[(0,n.Wm)(P,{class:"card mb-24",bordered:!1},{title:(0,n.w5)((function(){return[(0,n.Wm)(_,{onClick:f.getDefaultPjsConfig},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,i.zw)(t.$t("reset")),1)]})),_:1},8,["onClick"])]})),default:(0,n.w5)((function(){return[(0,n.Wm)(S,{value:m.pjsConfig,onInput:f.pjsChange},null,8,["value","onInput"])]})),_:1})]})),_:1},8,["tab"])]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["title","form-state"])}]])}}]);