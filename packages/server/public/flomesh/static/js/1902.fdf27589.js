"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[1902],{85117:function(e,t,a){var i=a(66330),n=TypeError;e.exports=function(e,t){if(!delete e[t])throw n("Cannot delete property "+i(t)+" of "+i(e))}},30541:function(e,t,a){var i=a(82109),n=a(47908),l=a(26244),o=a(83658),r=a(85117),d=a(7207),s=1!==[].unshift(0),u=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();i({target:"Array",proto:!0,arity:1,forced:s||u},{unshift:function(e){var t=n(this),a=l(t),i=arguments.length;if(i){d(a+i);for(var s=a;s--;){var u=s+i;s in t?t[u]=t[s]:r(t,u)}for(var p=0;p<i;p++)t[p]=arguments[p]}return o(t,a+i)}})},71900:function(e,t,a){a.d(t,{Z:function(){return r}});var i=a(66252),n=a(3577);const l={class:"head-info"};var o={name:"HeadInfo",props:["title","content"]};var r=(0,a(83744).Z)(o,[["render",function(e,t,a,o,r,d){return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("span",null,(0,n.zw)(a.title),1),(0,i._)("p",null,[(0,i.Uk)((0,n.zw)(a.content),1),(0,i.WI)(e.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},11902:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var i=a(66252),n=a(3577),l=a(87932);const o=e=>((0,i.dD)("data-v-059ed20a"),e=e(),(0,i.Cn)(),e),r=o((()=>(0,i._)("div",null,null,-1))),d=["onClick"],s={class:"flex"},u={class:"flex-item"},p={class:"font-16"},c=["onClick"],h=["onClick"],m=o((()=>(0,i._)("img",{src:l,style:{width:"300px"}},null,-1)));a(30541),a(57658);var g=a(99684),f=a(62611),w=a(5009),v=a(2692),y=a(54367),$=a(46981),_=a(61103),k=a(71900),z=a(96486),b=a.n(z),O=a(33907),W=a(85263),C=a(79332),T={name:"Organizations",components:{HeadInfo:k.Z,PageLayout:_.Z,PlusCircleTwoTone:g.Z,PartitionOutlined:f.Z,SettingOutlined:w.Z,MoreOutlined:v.Z,CloseOutlined:y.Z,EditOutlined:$.Z,FormItem:C.Z},i18n:a(89234),data(){return{users:[],orgs:[],orgTree:[],PartitionOutlined:f.Z,isEdit:!1,selectProjects:[],selectUsers:[],roles:[],expandedKeys:[],visible:!1,payload:{id:"",name:"",parent:null,description:""},bindTarget:{},editorIsCreate:!0,workload:[],projects:[],loading:!0,activities:[],config:{},teams:[],simpleImage:W.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,O.rn)("rules",["rules"]),...(0,O.Se)("account",["user"])},mounted(){this.loaddata(),this.$gql.query("projects{data{id,attributes{name,organization{data{id,attributes{name}}}}}}").then((e=>{this.projects=e.data})),this.$gql.query("usersPermissionsUsers{data{id,attributes{username,phone,email,type}}}").then((e=>{this.users=e.data}))},methods:{onDragEnter(e){},onDrop(e){const t=e.node.key,a=e.node.id,i=e.dragNode.key,n=e.dragNode.id,l=e.node.pos.split("-"),o=e.dropPosition-1*l[l.length-1],r=(e,t,a)=>{e.forEach(((i,n)=>i.key===t?a(i,n,e):i.children?r(i.children,t,a):void 0))},d=[...this.orgTree];let s;if(r(d,i,((e,t,a)=>{a.splice(t,1),s=e})),e.dropToGap)if((e.node.children||[]).length>0&&e.node.expanded&&1===o)r(d,t,(e=>{e.children=e.children||[],e.children.unshift(s)}));else{let e=[],a=0;r(d,t,((t,i,n)=>{e=n,a=i})),-1===o?e.splice(a,0,s):e.splice(a+1,0,s)}else r(d,t,(e=>{e.children=e.children||[],e.children.unshift(s)}));let u=null;e.dropToGap||(u=a),this.$gql.mutation(`updateOrganization(id:${n},data:{parent: ${u}}){data{id}}`).then((()=>{})),this.orgTree=d},onContextMenuClick(e,t){"setting"==t?this.setting(null,null,e):"manage"==t&&this.manage(null,null,e)},add(){this.isEdit=!1,this.payload={id:"",name:"",parent:null,description:""},this.showModal()},showModal(){this.visible=!0},valid(){this.$refs.form.validateFields().then((()=>{this.handleOk()})).catch((()=>{}))},handleOk(){let e=b().cloneDeep(this.payload);const t={name:e.name,description:e.description,parent:e.parent};if(this.isEdit){const a=e.id;this.$gql.mutation(`updateOrganization(id:${a}, data: $data){data{id}}`,{data:t},{data:"OrganizationInput!"}).then((()=>{this.visible=!1,this.$message.success(this.$t("Modified successfully"),3),this.loaddata(!0)}))}else this.$gql.mutation("createOrganization(data: $data){data{id}}",{data:t},{data:"OrganizationInput!"}).then((()=>{this.visible=!1,this.$message.success(this.$t("Created successfully"),3),this.loaddata(!0)}))},removeOrg(e,t,a){this.$gql.mutation(`deleteOrganization(id:${a.id}){data{id}}`).then((()=>{this.$message.success(this.$t("Deleted successfully"),3),this.loaddata(!0)}))},manage(e,t,a){this.$router.push({path:"/system/organizations/detail/"+a.id})},setting(e,t,a){this.payload=a,this.payload.parent&&(this.payload.parent=""+this.payload.parent.id),this.isEdit=!0,this.showModal()},search(e,t){e&&(this.pageNo=e,this.pageSize=t),this.loaddata()},setTreeKey(e,t){e&&e.forEach((e=>{e.key=`${t}-${e.id}`,e.children&&this.setTreeKey(e.children,t+1)}))},loaddata(e){e||(this.loading=!0),this.$gql.query("organizations{data{id,attributes{name,parent{data{id,attributes{name}}},children{data{id,attributes{name}}}}}}").then((e=>{this.orgs=e.data})),this.$gql.query("getOrganizationsTree").then((e=>{this.orgTree=e,this.setTreeKey(this.orgTree,0),this.loading=!1}))}}};var x=(0,a(83744).Z)(T,[["render",function(e,t,a,l,o,g){const f=(0,i.up)("PlusCircleTwoTone"),w=(0,i.up)("HeadInfo"),v=(0,i.up)("PartitionOutlined"),y=(0,i.up)("a-divider"),$=(0,i.up)("EditOutlined"),_=(0,i.up)("a-menu-item"),k=(0,i.up)("SettingOutlined"),z=(0,i.up)("CloseOutlined"),b=(0,i.up)("a-popconfirm"),O=(0,i.up)("a-menu"),W=(0,i.up)("MoreOutlined"),C=(0,i.up)("a-dropdown"),T=(0,i.up)("a-tree"),x=(0,i.up)("a-result"),D=(0,i.up)("a-card"),E=(0,i.up)("a-input"),P=(0,i.up)("FormItem"),U=(0,i.up)("a-descriptions-item"),I=(0,i.up)("a-textarea"),Z=(0,i.up)("a-select-option"),q=(0,i.up)("a-select"),j=(0,i.up)("a-descriptions"),M=(0,i.up)("a-form"),S=(0,i.up)("a-modal"),N=(0,i.up)("PageLayout"),K=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(N,{avatar:o.PartitionOutlined},{headerContent:(0,i.w5)((()=>[r])),extra:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{class:"split-right",title:e.$t("Create organization")},{body:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(f,{onClick:g.add,class:"font-primary icon-menu rotate-icon"},null,8,["onClick"])])])),_:1},8,["title"])),[[K,["organization:create"]]])])),default:(0,i.w5)((()=>[(0,i.Wm)(D,{title:e.$t("Organization Tree"),loading:o.loading},{extra:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.$t("Drag to change level")),1)])),default:(0,i.w5)((()=>[o.orgTree?((0,i.wg)(),(0,i.j4)(T,{key:0,"block-node":"",class:"full",draggable:"",onDragenter:g.onDragEnter,onDrop:g.onDrop,"default-expand-all":!0,"tree-data":o.orgTree},{title:(0,i.w5)((t=>[(0,i._)("div",{class:"min-width-200",onClick:e=>g.manage(null,null,t)},[(0,i._)("div",s,[(0,i._)("div",u,[(0,i._)("div",null,[(0,i.Wm)(v,{class:"mr-10 primary"}),(0,i._)("b",p,(0,n.zw)(t.name),1),(0,i.Wm)(y,{type:"vertical"}),(0,i.Wm)(C,{placements:"topLeft"},{overlay:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{key:"setting"},{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("a",{onClick:e=>g.setting(null,null,t)},[(0,i.Wm)($),(0,i.Uk)(" "+(0,n.zw)(e.$t("edit")),1)],8,c)),[[K,["organization:update"]]])])),_:2},1024),(0,i.Wm)(_,{key:"manage"},{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("a",{onClick:e=>g.manage(null,null,t)},[(0,i.Wm)(k),(0,i.Uk)(" "+(0,n.zw)(e.$t("Administration")),1)],8,h)),[[K,["organization:update"]]])])),_:2},1024),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,{placement:"topLeft","ok-text":e.$t("Yes"),"cancel-text":e.$t("No"),onConfirm:e=>g.removeOrg(null,null,t)},{title:(0,i.w5)((()=>[(0,i._)("p",null,(0,n.zw)(e.$t("Tip")),1),(0,i._)("p",null,(0,n.zw)(e.$t("Are you sure to remove this?")),1)])),default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("a",null,[(0,i.Wm)(z),(0,i.Uk)(" "+(0,n.zw)(e.$t("Remove")),1)])),[[K,["organization:delete"]]])])),_:2},1032,["ok-text","cancel-text","onConfirm"])])),_:2},1024)])),_:2},1024)])),default:(0,i.w5)((()=>[(0,i._)("a",null,[(0,i.Wm)(W,{class:"icon-menu relative",style:{top:"2px"}})])])),_:2},1024)]),(0,i._)("div",null,[(0,i.Uk)((0,n.zw)(e.$t("Project"))+" : "+(0,n.zw)(t.projects?.length)+" ",1),(0,i.Wm)(y,{type:"vertical"}),(0,i.Uk)(" "+(0,n.zw)(e.$t("User"))+" : "+(0,n.zw)(t.users?.length)+" ",1),(0,i.Wm)(y,{type:"vertical"}),(0,i.Uk)(" "+(0,n.zw)(e.$t("Service"))+" : "+(0,n.zw)(t.services?.length),1)])])])],8,d)])),_:1},8,["onDragenter","onDrop","tree-data"])):((0,i.wg)(),(0,i.j4)(x,{key:1,title:e.$t("No data")},{icon:(0,i.w5)((()=>[m])),_:1},8,["title"]))])),_:1},8,["title","loading"]),(0,i.Wm)(S,{visible:o.visible,"onUpdate:visible":t[3]||(t[3]=e=>o.visible=e),title:e.$t("Organization"),onOk:g.valid,width:"50%","ok-text":o.isEdit?e.$t("Save"):e.$t("create")},{default:(0,i.w5)((()=>[(0,i.Wm)(M,{model:o.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{label:e.$t("as"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(P,{name:"name",rules:e.rules.uniqueName("organizations",{id:o.payload.id})},{default:(0,i.w5)((()=>[(0,i.Wm)(E,{placeholder:e.$t("unset"),value:o.payload.name,"onUpdate:value":t[0]||(t[0]=e=>o.payload.name=e)},{prefix:(0,i.w5)((()=>[(0,i.Wm)(v,{type:"user"})])),_:1},8,["placeholder","value"])])),_:1},8,["rules"])])),_:1},8,["label"]),(0,i.Wm)(U,{label:e.$t("Description"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{value:o.payload.description,"onUpdate:value":t[1]||(t[1]=e=>o.payload.description=e),placeholder:e.$t("unset"),"allow-clear":"",rows:4},null,8,["value","placeholder"])])),_:1},8,["label"]),(0,i.Wm)(U,{label:e.$t("Parent Organization")},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{placeholder:e.$t("unset"),value:o.payload.parent,"onUpdate:value":t[2]||(t[2]=e=>o.payload.parent=e),class:"width-180",ref:"select"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.orgs,((e,t)=>((0,i.wg)(),(0,i.j4)(Z,{disabled:o.payload.id==e.id||o.payload.children&&o.payload.children.find((t=>t.id==e.id)),value:e.id,key:t},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.name),1)])),_:2},1032,["disabled","value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["label"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","onOk","ok-text"])])),_:1},8,["avatar"])}],["__scopeId","data-v-059ed20a"]])}}]);