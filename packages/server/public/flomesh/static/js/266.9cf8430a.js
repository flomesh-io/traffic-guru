"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[266],{38718:function(t,e,a){a.d(e,{Z:function(){return g}});var i=a(66252),l=a(3577),n=a(87932);const d=(t=>((0,i.dD)("data-v-357cff26"),t=t(),(0,i.Cn)(),t))((()=>(0,i._)("img",{src:n,style:{width:"300px"}},null,-1))),s=["src"],o={key:1};var r=a(75255),u=a(54367),c=a(50976),h=a(1006),p=a(9294),m={name:"PluginConfig",i18n:a(89234),components:{AutoForm:c.Z,CheckOutlined:r.Z,CloseOutlined:u.Z,JsEditor:p.Z},props:["type","addText","plugins","disabled"],data(){return{DEFAULT_BASE_URL:h.DEFAULT_BASE_URL,tabList:[{key:"Config",tab:"Config"},{key:"Script",tab:"Script"}],loading:!0}},computed:{},watch:{plugins:{handler(){this.plugins&&this.plugins.forEach((t=>{t.content.tabVal||(t.content.tabVal="Config")}))},immediate:!0,deep:!0}},mounted(){},created(){this.loading=!1},methods:{onTabChange(t,e){this.plugins[e].content.tabVal=t},remove(t){this.plugins.splice(t,1)},add(){this.$emit("add",{})}}};var g=(0,a(83744).Z)(m,[["render",function(t,e,a,n,r,u){const c=(0,i.up)("a-button"),h=(0,i.up)("a-result"),p=(0,i.up)("CheckOutlined"),m=(0,i.up)("a-switch"),g=(0,i.up)("CloseOutlined"),b=(0,i.up)("AutoForm"),f=(0,i.up)("JsEditor"),w=(0,i.up)("a-card"),y=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.iD)(i.HY,null,[0==a.plugins.length?((0,i.wg)(),(0,i.j4)(h,{key:0,title:t.$t("No data")},{icon:(0,i.w5)((()=>[d])),extra:(0,i.w5)((()=>[a.addText&&"service"==a.type?(0,i.wy)(((0,i.wg)(),(0,i.j4)(c,{key:0,disabled:a.disabled,type:"primary",onClick:u.add},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.$t(a.addText)),1)])),_:1},8,["disabled","onClick"])),[[y,["service:update"]]]):a.addText?((0,i.wg)(),(0,i.j4)(c,{key:1,disabled:a.disabled,type:"primary",onClick:u.add},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.$t(a.addText)),1)])),_:1},8,["disabled","onClick"])):(0,i.kq)("",!0)])),_:1},8,["title"])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.plugins,((e,n)=>((0,i.wg)(),(0,i.j4)(w,{key:n,class:(0,l.C_)(["card mb-24","Script"==e.content.tabVal?"nopd":""]),"tab-list":r.tabList,"active-tab-key":e.content.tabVal,onTabChange:t=>u.onTabChange(t,n),bordered:!1,loading:r.loading},{customTab:(0,i.w5)((e=>[(0,i.Uk)((0,l.zw)(t.$t(e.key)),1)])),title:(0,i.w5)((()=>[e.icon?((0,i.wg)(),(0,i.iD)("img",{key:0,src:r.DEFAULT_BASE_URL+e.icon.url,alt:"avatar",class:"card-img"},null,8,s)):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,l.zw)(e.name)+" ",1),e.content.displayName&&e.name!=e.content.displayName?((0,i.wg)(),(0,i.iD)("span",o," ( "+(0,l.zw)(e.content.displayName)+" ) ",1)):(0,i.kq)("",!0)])),extra:(0,i.w5)((()=>[(0,i.Wm)(m,{checked:e.enable,"onUpdate:checked":t=>e.enable=t,disabled:a.disabled},{checkedChildren:(0,i.w5)((()=>[(0,i.Wm)(p)])),unCheckedChildren:(0,i.w5)((()=>[])),_:2},1032,["checked","onUpdate:checked","disabled"]),(0,i.Wm)(g,{class:(0,l.C_)([a.disabled?"disabled":"","gray"]),onClick:t=>u.remove(n)},null,8,["class","onClick"])])),default:(0,i.w5)((()=>["Config"==e.content.tabVal?((0,i.wg)(),(0,i.iD)("div",{key:0,class:(0,l.C_)(a.disabled?"disabled":"")},[(0,i.Wm)(b,{fields:[e.content.fields],col:3},null,8,["fields"])],2)):((0,i.wg)(),(0,i.j4)(f,{key:1,"is-readonly":a.disabled,id:"pluginScript"+n,value:e.content.script,"onUpdate:value":t=>e.content.script=t},null,8,["is-readonly","id","value","onUpdate:value"]))])),_:2},1032,["class","tab-list","active-tab-key","onTabChange","loading"])))),128))],64)}],["__scopeId","data-v-357cff26"]])},50128:function(t,e,a){a.d(e,{Z:function(){return r}});var i=a(66252),l=a(3577);const n={class:"mini-chart"},d=["id"];a(57658);var s=a(85263),o={name:"MiniBar",props:["dv","id","axis","height","colors","stack","ver","unit"],data(){return{id2:Math.ceil(1e3*Math.random()),isMounted:!1,simpleImage:s.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,a(33907).rn)("setting",["lang"])},watch:{lang(t){this.$i18n.locale=t},dv(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)},ver(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)}},mounted(){this.isMounted=!0,this.$i18n.locale=this.lang,this.renderChart()},methods:{getLegend(){let t={};return this.dv.forEach((e=>{t[e.type]=e.type})),Object.keys(t)},getXAxis(){let t={};return this.dv.forEach((e=>{t[e.date]=e.date})),Object.keys(t).sort()},getSeriesValue(){let t={};return this.dv.forEach((e=>{t[e.date]||(t[e.date]={}),e.itemStyle?t[e.date][e.type]={value:e.value,itemStyle:e.itemStyle}:t[e.date][e.type]=e.value})),t},getSeries(t,e){let a=this.getSeriesValue(),i=[];return t.forEach((t=>{let l=[];e.forEach((e=>{l.push(a[e][t]||0)}));let n={name:t,type:"bar",smooth:!0,areaStyle:{},emphasis:{focus:"series"},data:l};this.stack&&(n.stack=this.stack),i.push(n)})),i},renderChart(){let t=this.getLegend(),e=this.getXAxis(),a=this.getSeries(t,e),i=document.getElementById(this.id+this.id2);i&&this.$echarts.dispose(i);let l=this.$echarts.init(i);l.showLoading();let n={color:this.colors?this.colors:["rgba(0, 137, 237,0.7)","rgba(255, 157, 77,0.7)","rgba(90, 216, 166,0.7)","rgba(227, 137, 163,0.7)","rgba(146, 112, 202,0.7)"],tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:t,show:!1},toolbox:{},grid:{top:"0px",right:"10px",left:"30px",bottom:"0px"},xAxis:[{axisLabel:{backgroundColor:"rgba(240,240,240,0.7)",padding:[2,3,2,3],textStyle:{color:"#6a7985"},inside:!0,borderRadius:2,minInterval:20},data:e,axisTick:{show:!1},axisLine:{show:!1},z:10}],yAxis:[{show:!!this.axis,type:"value",axisLabel:this.axis?{formatter:t=>""+t+(this.unit?this.unit:"")}:{showMinLabel:!1,showMaxLabel:!1,inside:!0,margin:-30,backgroundColor:"rgba(240,240,240,0.7)",padding:[2,3,2,3],textStyle:{color:"#6a7985"},formatter:t=>""+t+(this.unit?this.unit:"")}}],series:a};l.setOption(n,{lazyUpdate:!0}),l.hideLoading()}}};var r=(0,a(83744).Z)(o,[["render",function(t,e,a,s,o,r){const u=(0,i.up)("a-empty");return(0,i.wg)(),(0,i.iD)("div",n,[a.dv&&0!=a.dv.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(u,{key:0,image:o.simpleImage,description:""},null,8,["image"])),(0,i._)("div",{ref:a.id,class:"chart-content full",id:a.id+o.id2,style:(0,l.j5)({height:a.height?a.height+"px":"100px"})},null,12,d)])}],["__scopeId","data-v-64c489b5"]])},49568:function(t,e,a){a.d(e,{Z:function(){return u}});var i=a(66252),l=a(3577);const n={class:"mini-chart"},d={class:"absolute full mt-10"},s=["id"];a(57658);var o=a(85263),r={name:"MiniSector",props:["dv","noEmpty","id","height","padding","colors","ver"],data(){return{id2:Math.ceil(1e3*Math.random()),isMounted:!1,simpleImage:o.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,a(33907).rn)("setting",["lang"])},watch:{lang(t){this.$i18n.locale=t},dv(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)},ver(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)}},mounted(){this.isMounted=!0,this.$i18n.locale=this.lang,setTimeout((()=>{this.renderChart()}),100)},methods:{getSeries(){let t=[];return t.push({type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"40",fontWeight:"bold"}},labelLine:{show:!1},data:this.dv}),t},renderChart(){let t=this.getSeries(),e=document.getElementById(this.id+this.id2);e&&this.$echarts.dispose(e);let a=this.$echarts.init(e);a.showLoading();let i={color:this.colors?this.colors:["rgba(0, 137, 237,0.7)","rgba(255, 157, 77,0.7)","rgba(90, 216, 166,0.7)","rgba(227, 137, 163,0.7)","rgba(146, 112, 202,0.7)"],tooltip:{trigger:"item"},legend:{show:!0,orient:"vertical",right:"right",formatter:function(t){return t.length>10?t.substr(0,10)+"...":t}},toolbox:{},grid:{left:this.padding?this.padding[3]:0,right:this.padding?this.padding[1]:0,bottom:this.padding?this.padding[2]:0,top:this.padding?this.padding[0]:0,containLabel:!0},series:t};a.setOption(i,{lazyUpdate:!0}),a.hideLoading()}}};var u=(0,a(83744).Z)(r,[["render",function(t,e,a,o,r,u){const c=(0,i.up)("a-empty");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",d,[a.dv&&0!=a.dv.length||a.noEmpty?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(c,{key:0,image:r.simpleImage,description:""},null,8,["image"]))]),(0,i._)("div",{ref:a.id,class:"chart-content full",id:a.id+r.id2,style:(0,l.j5)({height:a.height?a.height+"px":"200px"})},null,12,s)])}],["__scopeId","data-v-51a6e4be"]])},9294:function(t,e,a){a.d(e,{Z:function(){return d}});var i=a(66252);var l=a(29764);(0,a(25552).H)({id:"javascript",extensions:[".js",".es6",".jsx",".mjs"],firstLine:"^#!.*\\bnode",filenames:["jakefile"],aliases:["JavaScript","javascript","js"],mimetypes:["text/javascript"],loader:function(){return a.e(6015).then(a.bind(a,6015))}});var n={name:"JsEditor",components:{monacoeditor:l.Z},props:["value","height","isReadonly","id","theme"],data(){return{code:"",cmOptions:{lineNumbers:!0,mode:"javascript",readOnly:!1,lint:!0}}},watch:{value(t,e){t!==e&&this.setValue()}},mounted(){this.setValue()},methods:{change(t){"string"==typeof t&&(this.$emit("update:value",t),this.$emit("change",t))},setValue(){null!=this.value.replace&&(this.code=this.value)}}};var d=(0,a(83744).Z)(n,[["render",function(t,e,a,l,n,d){const s=(0,i.up)("monacoeditor");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(s,{id:a.id||"JsEditor",content:n.code,"onUpdate:content":e[0]||(e[0]=t=>n.code=t),option:n.cmOptions,onChange:d.change,height:a.height,theme:a.theme,"is-readonly":a.isReadonly},null,8,["id","content","option","onChange","height","theme","is-readonly"])])}]])},71900:function(t,e,a){a.d(e,{Z:function(){return s}});var i=a(66252),l=a(3577);const n={class:"head-info"};var d={name:"HeadInfo",props:["title","content"]};var s=(0,a(83744).Z)(d,[["render",function(t,e,a,d,s,o){return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("span",null,(0,l.zw)(a.title),1),(0,i._)("p",null,[(0,i.Uk)((0,l.zw)(a.content),1),(0,i.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},48025:function(t,e,a){a.d(e,{Z:function(){return L}});var i=a(66252),l=a(3577);const n={key:0},d={key:0},s={key:0};a(57658);var o=a(96486),r=a.n(o),u=a(38718),c=a(79954),h=a(84471),p=a(76550),m=a(26917),g=a(61103),b=a(1299),f=a(13589),w=a(62184),y=a(33907),v=a(50976),k=a(49702),$=a(72167),C=a(84722),_={name:"Lb4Detail",i18n:a(89234),components:{DetailListItem:f.Z,DetailList:b.Z,PageLayout:g.Z,AutoForm:v.Z,LogViewer:k.Z,PluginConfig:u.Z,IPRange:p.Z,PluginList:c.Z,HealthcheckResult:w.default},props:["embed","name","rid"],data(){return{type:"4 Load Balancer",initMapping:[{label:"Targets",fields:[[{label:"Target Hosts",value:""}]]},{label:"Load Balancing",fields:[[{label:"Algorithm",value:"rr"}]]},{label:"Config",fields:[[{name:"sticky",type:"boolean",unit:"",label:"Sticky",value:!1},{name:"maxFails",type:"number",unit:"",label:"Max Fails",value:""},{name:"maxConnections",type:"number",unit:"",label:"Max Connections",value:""},{name:"readTimeout",type:"text",unit:"",label:"Read timeout",value:"60s"},{name:"writeTimeout",type:"text",unit:"",label:"Write Timeout",value:"60s"},{name:"idleTimeout",type:"text",unit:"",label:"IDLE Timeout",value:"60s"}]]}],visible:!1,pipys:[],detail:{content:{mapping:[],bps_limit:null,tps_limit:null,port:"80",tlsport:"443",plugins:[],sourceIpPool:{a:0,b:0,c:0,d:0,suffix:0},enableTLS:!1,uniqueIp:!1,rfc8998:!1,minTLSVersion:"",dhparam:"",ciphers:"",clientCert:""},certificate:null,organization:{id:null},pipy4lb:{id:null},addressPool:{id:null},name:""},loading:!0,logloading:!0,logs:[],log:"{}",pid:"",filter:"",params:{pageNo:1,pageSize:10,total:0},profiles:[],pools:[],tps:[],tpsCnt:0,activeTabKey:"2",visibleAP:!1,protocols:[{id:"tcp",name:"TCP"},{id:"udp",name:"UDP"}],certificates:[],clientCertificates:[],orgs:[]}},computed:{...(0,y.rn)({rules:t=>t.rules.rules,isMobile:t=>t.setting.isMobile})},created(){this.pid=this.rid||"",this.$gql.query("myOrganizations{data{id,attributes{name}}}").then((t=>{this.orgs=t.data})),""!=this.pid?(this.loading=!0,this.$gql.query(`l4Lb(id: ${this.pid}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tglobalId,\n\t\t\t\t\t\torganization{data{id,attributes{name}}},\n\t\t\t\t\t\tpipy4lb{data{id,attributes{name}}},\n\t\t\t\t\t\taddressPool{data{id,attributes{name, organization{data{id, attributes{name}}}}}},\n\t\t\t\t\t\tprofile{data{id,attributes{name}}},\n\t\t\t\t\t\tcertificate{data{id,attributes{name}}},\n\t\t\t\t\t\tclientCertificate{data{id,attributes{name}}},\n\t\t\t\t\t\tcontent, \n\t\t\t\t\t\taddress{data{id,attributes{ip}}}\n\t\t\t\t\t}}}`).then((t=>{let e=t.data;e.content.mapping=(0,C.kL)(this.initMapping,e.content.mapping),this.loading=!1,this.detail=e,this.detail.organization=this.detail.organization?this.detail.organization:{id:null},this.detail.certificate?.id&&(this.detail.certificate=this.detail.certificate.id),this.detail.clientCertificate?.id&&(this.detail.clientCertificate=this.detail.clientCertificate.id),this.detail.content.sourceIpPool?.ip?this.detail.content.sourceIpPool=(0,C.wp)(this.detail.content.sourceIpPool,3):this.detail.content.sourceIpPool={a:0,b:0,c:0,d:0,suffix:0},this.getData(),this.getAddressPools()}))):(this.detail={addressPool:{id:null},pipy4lb:{id:null},organization:{id:null},address:{ip:null},certificate:null,clientCertificate:null,content:{mapping:this.initMapping,bps_limit:null,tps_limit:null,port:"80",tlsport:"443",plugins:[],enableTLS:!1,sourceIpPool:{a:0,b:0,c:0,d:0,suffix:0},uniqueIp:!1},name:""},this.loading=!1),this.$gql.query('myFleets(filters: {type: {eq:"pipy4lb"}}){data{id,attributes{name}}}').then((t=>{this.pipys=t.data})),this.$gql.query("profiles{data{id,attributes{name}}}").then((t=>{this.profiles=t.data})),this.getCertificates(),""!=this.pid&&(0,m.ap)(this.pid).then((0,h.hw)(((t,e)=>{let a=(0,m.tl)(t);this.tpsCnt=e.data,this.tps=[],a.forEach((t=>{let e={type:"4lb"};e.value=t[0],e.date=(0,$.Z)(new Date(t[1]),"yyyy-MM-dd HH:mm"),this.tps.push(e)}))}))).catch((t=>{}))},methods:{onTabChange(t){},getAddressPools(){this.detail?.organization?.id?this.$gql.query(`addressPools(filters: {organization:{id:{eq:${this.detail?.organization?.id}}}}){data{id,attributes{name, organization{data{id, attributes{name}}}}}}`).then((t=>{this.pools=t.data})):this.pools=[]},getCertificates(){this.$gql.query(`certificates(filters: $filters, pagination: { start: 0, limit: ${this.$DFT_LIMIT}}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}`,{filters:{type:{in:["api","rfc8998"]}}},{filters:"CertificateFiltersInput",pagination:"PaginationArg"}).then((t=>{this.certificates=t.data})),this.$gql.query(`certificates(filters: $filters, pagination: { start: 0, limit: ${this.$DFT_LIMIT}}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}`,{filters:{type:{eq:"client"}}},{filters:"CertificateFiltersInput",pagination:"PaginationArg"}).then((t=>{this.clientCertificates=t.data}))},validate(t){this.$refs.layout.$refs.form.validateFields().then((()=>{this.save(t)})).catch((()=>{}))},valid(){return""!=this.detail.name||""!=this.name||(this.$message.error(this.$t("The name cannot be empty"),3),!1)},save(t){if(!this.valid())return;let e=r().cloneDeep(this.detail);e.content.mapping=r().cloneDeep(this.detail.content.mapping),e.content.is_gateway=!!this.embed,e.pipy4lb=e.pipy4lb.id,e.addressPool=e.addressPool.id,e.content.sourceIpPool&&(e.content.sourceIpPool=(0,C.bR)(e.content.sourceIpPool,3)),t&&(e.registry=t,e.name=this.name+" 4LB"),e.content.targets||(e.content.targets="[]"),e.content.aggregation_length||(e.content.aggregation_length=0),e.content.checker||(e.content.checker=""),delete e.id,delete e.address,e.content.plugins&&e.content.plugins.forEach((t=>{t.content.fields.forEach((t=>{"number"==t.type&&(t.value=Number(t.value))}))})),e.organization?.id&&(e.organization=e.organization?.id),""!=this.pid?(delete e.profile,this.$gql.mutation(`updateL4Lb(id:${this.pid}, data: $data){data{id}}`,{data:e},{data:"L4LbInput!"}).then((()=>{this.embed?this.$emit("saved",t):(this.$message.success(this.$t("Save successfully"),3),this.$closePage(this.$route))}))):this.$gql.mutation("createL4Lb(data: $data){data{id,attributes{name}}}",{data:e},{data:"L4LbInput!"}).then((e=>{this.embed?this.$emit("saved",t):(this.pid=e.data.id,this.$message.success(this.$t("Created successfully"),3),this.$closePage(this.$route))}))},handleChange(){},changeAddressPool(t){this.detail.organization=this.pools.find((e=>e.id==t)).organization},hide(){this.visible=!1},getData(t,e){t&&(this.params.pageNo=t,this.params.pageSize=e),this.logloading=!0,this.data=[],this.filter=`iid = '${this.pid}'`,(0,m.hT)(this.params.pageNo,this.params.pageSize,this.filter,"timestamp","desc").then((0,h.hw)(((t,e)=>{this.logloading=!1,this.params.total=1*t.data,this.logs=(0,m.OI)(e)}))).catch((t=>{}))},selectPlugin(t){this.detail.content.plugins.push({...t,enable:!0}),this.visibleAP=!1,this.$message.success(this.$t("Added successfully"),3)},showPluginBox(){this.visibleAP=!0}}};var L=(0,a(83744).Z)(_,[["render",function(t,e,a,o,r,u){const c=(0,i.up)("a-input"),h=(0,i.up)("DetailListItem"),p=(0,i.up)("a-select-option"),m=(0,i.up)("a-select"),g=(0,i.up)("a-switch"),b=(0,i.up)("IPRange"),f=(0,i.up)("DetailList"),w=(0,i.up)("a-button"),y=(0,i.up)("AutoForm"),v=(0,i.up)("a-card"),k=(0,i.up)("a-tab-pane"),$=(0,i.up)("PluginConfig"),C=(0,i.up)("a-col"),_=(0,i.up)("a-row"),L=(0,i.up)("HealthcheckResult"),x=(0,i.up)("LogViewer"),S=(0,i.up)("a-tabs"),I=(0,i.up)("PluginList"),P=(0,i.up)("a-modal"),D=(0,i.up)("PageLayout"),T=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(D,{"hide-breadcrumb":a.embed,title:a.embed?" ":r.detail.name?r.detail.name:t.$t("new")+" 4LB","form-state":r.detail,ref:"layout"},(0,i.Nv)({headerContent:(0,i.w5)((()=>[(0,i.Wm)(f,{size:"small",col:2},{default:(0,i.w5)((()=>[a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(h,{key:0,term:t.$t("as"),name:"name",rules:t.rules.uniqueName("l4Lbs",{id:r.pid})},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{placeholder:t.$t("unset"),value:r.detail.name,"onUpdate:value":e[0]||(e[0]=t=>r.detail.name=t),class:"width-200"},null,8,["placeholder","value"])])),_:1},8,["term","rules"])),a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(h,{key:1,term:t.$t("port"),name:["content","port"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{type:"number",placeholder:t.$t("unset"),value:r.detail.content.port,"onUpdate:value":e[1]||(e[1]=t=>r.detail.content.port=t),class:"width-100",disabled:""!=r.pid},null,8,["placeholder","value","disabled"])])),_:1},8,["term","rules"])),(0,i.Wm)(h,{term:t.$t("Organization"),name:["organization","id"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{placeholder:t.$t("unset"),value:r.detail.organization.id,"onUpdate:value":e[2]||(e[2]=t=>r.detail.organization.id=t),class:"width-180",ref:"select",disabled:""!=r.pid,onChange:e[3]||(e[3]=t=>{u.getAddressPools(),r.detail.addressPool.id=null})},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.orgs,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{value:t.id,key:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value","disabled"])])),_:1},8,["term","rules"]),(0,i.Wm)(h,{term:t.$t("Unique IP")},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"ml-10",checked:r.detail.content.uniqueIp,"onUpdate:checked":e[4]||(e[4]=t=>r.detail.content.uniqueIp=t),disabled:""!=r.pid},null,8,["checked","disabled"])])),_:1},8,["term"]),(0,i.Wm)(h,{term:t.$t("addressPool"),name:["addressPool","id"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{placeholder:t.$t("unallocated"),class:"width-200",value:r.detail.addressPool.id,"onUpdate:value":e[5]||(e[5]=t=>r.detail.addressPool.id=t),onChange:e[6]||(e[6]=t=>u.changeAddressPool(t)),disabled:""!=r.pid},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.pools,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{key:e,value:t.id},{default:(0,i.w5)((()=>[t.id?((0,i.wg)(),(0,i.iD)("span",n,(0,l.zw)(t.name),1)):(0,i.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value","disabled"])])),_:1},8,["term","rules"]),(0,i.Wm)(h,{term:t.$t("Protocol"),name:["content","protocol"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{placeholder:t.$t("unallocated"),class:"width-200",value:r.detail.content.protocol,"onUpdate:value":e[7]||(e[7]=t=>r.detail.content.protocol=t)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.protocols,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{key:e,value:t.id},{default:(0,i.w5)((()=>[t.id?((0,i.wg)(),(0,i.iD)("span",d,(0,l.zw)(t.name),1)):(0,i.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term","rules"]),(0,i.Wm)(h,{term:t.$t("cluster"),name:["pipy4lb","id"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{disabled:""!=r.pid,placeholder:t.$t("unallocated"),class:"width-200",value:r.detail.pipy4lb.id,"onUpdate:value":e[8]||(e[8]=t=>r.detail.pipy4lb.id=t),onChange:e[9]||(e[9]=t=>u.handleChange())},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.pipys,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{key:e,value:t.id},{default:(0,i.w5)((()=>[t.id?((0,i.wg)(),(0,i.iD)("span",s,(0,l.zw)(t.name),1)):(0,i.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:1},8,["disabled","placeholder","value"])])),_:1},8,["term","rules"]),(0,i.Wm)(h,{term:t.$t("Source Ip Pool")},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{ip:r.detail.content.sourceIpPool,editable:!0,type:3},null,8,["ip"])])),_:1},8,["term"]),(0,i.Wm)(h,{term:t.$t("Enabled TLS")},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"ml-10",checked:r.detail.content.enableTLS,"onUpdate:checked":e[10]||(e[10]=t=>r.detail.content.enableTLS=t)},null,8,["checked"])])),_:1},8,["term"]),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:2,term:t.$t("TLS Port"),name:["content","tlsport"],rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{type:"number",placeholder:t.$t("unset"),value:r.detail.content.tlsport,"onUpdate:value":e[11]||(e[11]=t=>r.detail.content.tlsport=t),class:"width-100"},null,8,["placeholder","value"])])),_:1},8,["term","rules"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:3,term:t.$t("TLS Certificate"),name:t.certificate,rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{placeholder:t.$t("unset"),class:"width-200",value:r.detail.certificate,"onUpdate:value":e[12]||(e[12]=t=>r.detail.certificate=t),"allow-clear":""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.certificates,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{value:t.id,key:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.name+"("+t.type+")"),1)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term","name","rules"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:4,term:t.$t("RFC8998")},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"ml-10",checked:r.detail.content.rfc8998,"onUpdate:checked":e[13]||(e[13]=t=>r.detail.content.rfc8998=t),onChange:e[14]||(e[14]=t=>r.detail.content.minTLSVersion="")},null,8,["checked"])])),_:1},8,["term"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:5,term:t.$t("Min Version")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{placeholder:t.$t("unset"),value:r.detail.content.minTLSVersion,"onUpdate:value":e[15]||(e[15]=t=>r.detail.content.minTLSVersion=t),class:"width-120",disabled:r.detail.content.rfc8998},null,8,["placeholder","value","disabled"])])),_:1},8,["term"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:6,term:t.$t("DH Param")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{placeholder:t.$t("unset"),value:r.detail.content.dhparam,"onUpdate:value":e[16]||(e[16]=t=>r.detail.content.dhparam=t),class:"width-120"},null,8,["placeholder","value"])])),_:1},8,["term"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:7,term:t.$t("Ciphers")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{placeholder:t.$t("unset"),value:r.detail.content.ciphers,"onUpdate:value":e[17]||(e[17]=t=>r.detail.content.ciphers=t),class:"width-300"},null,8,["placeholder","value"])])),_:1},8,["term"])):(0,i.kq)("",!0),!a.embed&&r.detail.content.enableTLS?((0,i.wg)(),(0,i.j4)(h,{key:8,term:t.$t("Client Cert"),name:t.certificate,rules:t.rules.required},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{placeholder:t.$t("unset"),class:"width-200",value:r.detail.clientCertificate,"onUpdate:value":e[18]||(e[18]=t=>r.detail.clientCertificate=t),"allow-clear":""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.clientCertificates,((t,e)=>((0,i.wg)(),(0,i.j4)(p,{value:t.id,key:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.name+"("+t.type+")"),1)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term","name","rules"])):(0,i.kq)("",!0),(0,i.kq)("",!0),r.detail.address&&r.detail.address.ip?((0,i.wg)(),(0,i.j4)(h,{key:10,term:t.$t("IP")},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(r.detail.address.ip),1)])),_:1},8,["term"])):(0,i.kq)("",!0),r.pid?((0,i.wg)(),(0,i.j4)(h,{key:11,term:t.$t("Global Id")},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(r.detail.globalId),1)])),_:1},8,["term"])):(0,i.kq)("",!0)])),_:1})])),default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"row-mg"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{type:"card"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{key:"1",tab:t.$t("config")},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.detail.content.mapping,((e,a)=>((0,i.wg)(),(0,i.j4)(v,{key:a,class:"card mb-24",title:t.$t(e.label),bordered:!1,loading:r.loading},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{fields:e.fields},null,8,["fields"])])),_:2},1032,["title","loading"])))),128))])),_:1},8,["tab"]),(0,i.Wm)(k,{key:"2",tab:t.$t("Policy")},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"row-mg"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)($,{plugins:r.detail.content.plugins,"onUpdate:plugins":e[23]||(e[23]=t=>r.detail.content.plugins=t),onAdd:u.showPluginBox,"add-text":t.$t("Add Plugin")},null,8,["plugins","onAdd","add-text"])])),_:1})])),_:1})])),_:1},8,["tab"]),(0,i.Wm)(k,{key:"3",tab:t.$t("healthcheck")},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"row-mg"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(L,{pid:r.pid,mode:"l4Lb"},null,8,["pid"])])),_:1})])),_:1})])),_:1},8,["tab"]),""!=r.pid?((0,i.wg)(),(0,i.j4)(k,{key:"11",tab:t.$t("log")},{default:(0,i.w5)((()=>[(0,i.Wm)(x,{uid:r.pid,type:"4lb","hide-chart":!0},null,8,["uid"])])),_:1},8,["tab"])):(0,i.kq)("",!0)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(P,{footer:null,width:800,visible:r.visibleAP,"onUpdate:visible":e[24]||(e[24]=t=>r.visibleAP=t),title:t.$t("Add Plugin"),onOk:t.handleOk},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{apply:"4lb",onSelectPlugin:u.selectPlugin,"hide-head":!0},null,8,["onSelectPlugin"])])),_:1},8,["visible","title","onOk"])])),_:2},[""==r.pid||a.embed?void 0:{name:"extra",fn:(0,i.w5)((()=>[])),key:"0"},a.embed?void 0:{name:"action",fn:(0,i.w5)((()=>[""!=r.pid?(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{key:0,type:"primary",onClick:e[21]||(e[21]=t=>u.validate())},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.$t("save")),1)])),_:1})),[[T,["l4-lb:update"]]]):(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{key:1,type:"primary",onClick:e[22]||(e[22]=t=>u.validate())},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.$t("create")),1)])),_:1})),[[T,["l4-lb:create"]]])])),key:"1"}]),1032,["hide-breadcrumb","title","form-state"])}]])},62184:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var i=a(66252),l=a(3577);const n=(t=>((0,i.dD)("data-v-0bd6d015"),t=t(),(0,i.Cn)(),t))((()=>(0,i._)("em",null," ~ ",-1))),d={key:1},s={key:2},o=["onClick"],r={key:3};a(57658);var u=a(21936),c=a(16822);const h=[{key:" ",dataIndex:"t",width:30},{key:"Type",dataIndex:"type"},{key:"as",dataIndex:"as"},{key:"time",sorter:!0,dataIndex:"updatedAt"},{key:"content",dataIndex:"content"}],p=[{key:" ",dataIndex:"t",width:30},{key:"time",sorter:!0,dataIndex:"updatedAt"},{key:"content",dataIndex:"content"}];var m={name:"EventList",components:{JsonEditor:u.Z,Status:c.Z},props:["pid","mode"],i18n:a(89234),data(){return{date:"",endDate:"",visible:!1,pageSize:10,pageNo:1,total:0,loading:!0,advanced:!0,sorter:"updatedAt",sortOrder:"end$desc",type:"l4Lb",typeOptions:[{tab:"4LB",key:"l4Lb"},{tab:"Upstream",key:"upstream"}],columns:h,embedColumns:p,list:[]}},computed:{dataColumns(){return(this.mode?this.embedColumns:this.columns).map((t=>(t.title=this.$t(t.key),t.sorter&&this.sorter==t.dataIndex&&(t.sortOrder=this.sortOrder),t)))},start(){return(this.pageNo-1)*this.pageSize}},created(){this.mode&&(this.type=this.mode),this.search()},methods:{onTabChange(t){this.type=t,this.search()},sort(t,e,a){this.sorter=a.field,this.sortOrder=a.order,this.search()},onClose(){this.visible=!1},goTarget(t,e){"l4Lb"==e&&this.$router.push({path:"/flb/4lb/detail/"+t})},detail(t){this.visible=!0,this.log=JSON.stringify(t||{})},detailInterface(t){this.visible=!0,this.log=t},search(t,e){t&&(this.pageNo=t,this.pageSize=e);let a={start:this.start,limit:this.pageSize};this.loading=!0;let i={type:{eq:this.type},isCluster:{eq:!1}};this.endDate&&(i.updatedAt={lte:this.endDate}),this.date&&(i.createdAt={gte:this.date}),this.pid&&("l4Lb"==this.type?i.l4Lb={id:{eq:this.pid}}:"upstream"==this.type&&(i.checkpoint={id:{eq:this.pid}}));let l="updatedAt:desc";this.sorter&&this.sortOrder&&(l=this.sortOrder.replace(/\$/g,""),l=l.replace(/end/g,""),l=`${this.sorter}:${l}`),this.$gql.query(`healthcheckResults(filters: $filters, pagination: $pagination, sort: "${l}"){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tupdatedAt,\n              content,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\tl4Lb{data{id,attributes{name}}},\n\t\t\t\t\t\t\tcheckpoint{data{id,attributes{name}}},\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}`,{filters:i,pagination:a},{filters:"HealthcheckResultFiltersInput",pagination:"PaginationArg"}).then((t=>{this.list=t.data,t.data.forEach((t=>{t.t=t.content.unhealthy.length>0?"failed":"success"})),this.total=t.pagination.total,this.loading=!1}))}}};var g=(0,a(83744).Z)(m,[["render",function(t,e,a,u,c,h){const p=(0,i.up)("a-date-picker"),m=(0,i.up)("Status"),g=(0,i.up)("a-tag"),b=(0,i.up)("a-table"),f=(0,i.up)("a-card"),w=(0,i.up)("JsonEditor"),y=(0,i.up)("a-drawer");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(f,{class:"nopd",title:a.mode?t.$t("healthcheck"):null,"tab-list":a.mode?null:c.typeOptions,"active-tab-key":c.type,loading:c.loading,onTabChange:e[8]||(e[8]=t=>h.onTabChange(t))},(0,i.Nv)({customTab:(0,i.w5)((e=>[(0,i._)("span",null,(0,l.zw)(t.$t(e.tab))+" "+(0,l.zw)(t.$t("healthcheck")),1)])),default:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(b,{columns:h.dataColumns,"data-source":c.list,pagination:{showSizeChanger:!0,showQuickJumper:!1,onShowSizeChange:h.search,onChange:h.search,current:c.pageNo,pageSize:c.pageSize,showTotal:(e,a)=>`${t.$t("Total")} ${e}`,total:c.total},onChange:h.sort},{bodyCell:(0,i.w5)((({column:e,record:a})=>["t"===e.dataIndex?((0,i.wg)(),(0,i.j4)(m,{key:0,d:{status:a.t}},null,8,["d"])):"as"===e.dataIndex?((0,i.wg)(),(0,i.iD)("div",d,["l4Lb"==a.type?((0,i.wg)(),(0,i.j4)(g,{key:0,onClick:t=>h.goTarget(a.l4Lb.id,a.type)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(a.l4Lb?.name),1)])),_:2},1032,["onClick"])):"upstream"==a.type?((0,i.wg)(),(0,i.j4)(g,{key:1,onClick:t=>h.goTarget(a.l4Lb.id,a.type)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(a.checkpoint?.name?a.checkpoint?.name:"checkpoint"),1)])),_:2},1032,["onClick"])):(0,i.kq)("",!0)])):"content"===e.dataIndex?((0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("a",{onClick:t=>h.detail(a.content)},(0,l.zw)(t.$t("detail")),9,o)])):"createdAt"===e.dataIndex?((0,i.wg)(),(0,i.iD)("div",r,(0,l.zw)(new Date(a.createdAt).toLocaleString()),1)):(0,i.kq)("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])])),_:2},[a.mode?{name:"extra",fn:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(p,{value:c.date,"onUpdate:value":e[0]||(e[0]=t=>c.date=t),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:t.$t("Start Date"),onChange:e[1]||(e[1]=t=>h.search())},null,8,["value","placeholder"]),n,(0,i.Wm)(p,{value:c.endDate,"onUpdate:value":e[2]||(e[2]=t=>c.endDate=t),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:t.$t("End Date"),onChange:e[3]||(e[3]=t=>h.search())},null,8,["value","placeholder"])])])),key:"0"}:{name:"tabBarExtraContent",fn:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(p,{value:c.date,"onUpdate:value":e[4]||(e[4]=t=>c.date=t),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:t.$t("Start Date"),onChange:e[5]||(e[5]=t=>h.search())},null,8,["value","placeholder"]),(0,i._)("em",null," ~ "),(0,i.Wm)(p,{value:c.endDate,"onUpdate:value":e[6]||(e[6]=t=>c.endDate=t),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:t.$t("End Date"),onChange:e[7]||(e[7]=t=>h.search())},null,8,["value","placeholder"])])])),key:"1"}]),1032,["title","tab-list","active-tab-key","loading"]),c.visible?((0,i.wg)(),(0,i.j4)(y,{key:0,"get-container":!1,title:t.$t("content"),placement:"bottom",height:"600",closable:!1,visible:c.visible,onClose:h.onClose},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{"is-readonly":!0,value:t.log},null,8,["value"])])),_:1},8,["title","visible","onClose"])):(0,i.kq)("",!0)])}],["__scopeId","data-v-0bd6d015"]])}}]);