"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[6908],{60300:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(66252),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},s=n(33058);function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(e,t){var n=l({},e,t.attrs);return(0,a.Wm)(s.Z,l({},n,{icon:i}),null)};o.displayName="DatabaseOutlined",o.inheritAttrs=!1;var u=o},34531:function(e,t,n){n.d(t,{Z:function(){return m}});n(74916),n(64765),n(68309);var a=n(66252),i=n(3577),s={key:0,class:"flex pd-10"},l={key:0,class:"flex-item"},r={class:"flex-item"},o={class:"pl-10"},u=["xlink:href"],c={class:"card-selector-title"};n(41539),n(54747),n(21249),n(57327),n(69826);var d=n(85263),p=n(75255),f=n(60459),h={name:"CardSelector",components:{CheckOutlined:p.Z,EnvSelector:f.Z},props:["loading","envFilter","search","options","icon","placement","disabled","value","getTag","svg","col","width","multiple"],emits:["envChange","select"],data:function(){return{simpleImage:d.Z.PRESENTED_IMAGE_SIMPLE,visible:!1,key:""}},i18n:n(89234),computed:{multipleSelectNum:function(){var e=0;return this.options.forEach((function(t){t.checked&&e++})),e},filterOptions:function(){var e=this;if(this.key){var t=this.options.filter((function(t){return(t.name||t.username||"").indexOf(e.key)>=0}));return t.map((function(e){null==e.checked&&(e.checked=!1)})),t}var n=this.options;return n.map((function(e){null==e.checked&&(e.checked=!1)})),n}},watch:{value:{handler:function(){var e=this;this.multiple&&this.options.forEach((function(t){t.checked=!!e.value.find((function(e){return t.id==e.id}))}))},deep:!0}},methods:{envChange:function(e){this.$emit("envChange",e)},multipleSelect:function(){this.visible=!1;var e=this.options.filter((function(e){return e.checked}));this.$emit("select",e),this.$emit("update:value",e)},select:function(e){this.multiple?this.options.forEach((function(t){t.id==e.id&&(t.checked=!t.checked)})):(this.visible=!1,this.$emit("update:value",e.id),this.$emit("select",e))}}};var m=(0,n(83744).Z)(h,[["render",function(e,t,n,d,p,f){var h=(0,a.up)("EnvSelector"),m=(0,a.up)("a-input-search"),v=(0,a.up)("a-button"),g=(0,a.up)("a-empty"),y=(0,a.up)("a-skeleton"),k=(0,a.up)("a-card-grid"),w=(0,a.up)("a-card"),b=(0,a.up)("CheckOutlined"),C=(0,a.up)("a-tag"),$=(0,a.up)("a-popover");return(0,a.wg)(),(0,a.j4)($,{placement:n.placement||"bottom","overlay-class-name":"selector-popover",visible:p.visible,"onUpdate:visible":t[1]||(t[1]=function(e){return p.visible=e}),trigger:"click"},{content:(0,a.w5)((function(){return[n.search?((0,a.wg)(),(0,a.iD)("div",s,[n.envFilter?((0,a.wg)(),(0,a.iD)("div",l,[(0,a.Wm)(h,{"no-all":!0,"is-filter":!0,onEnvChange:f.envChange},null,8,["onEnvChange"])])):(0,a.kq)("",!0),(0,a._)("div",r,[(0,a.Wm)(m,{value:p.key,"onUpdate:value":t[0]||(t[0]=function(e){return p.key=e}),class:"full",placeholder:e.$t("search")},null,8,["value","placeholder"])]),(0,a._)("div",o,[n.multiple?((0,a.wg)(),(0,a.j4)(v,{key:0,type:"primary",onClick:f.multipleSelect,disabled:0==f.multipleSelectNum},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e.$t("Ok")),1)]})),_:1},8,["onClick","disabled"])):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),n.loading||0!=f.filterOptions.length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(g,{key:1,image:p.simpleImage},null,8,["image"])),(0,a._)("div",{class:"overflow-auto scrollbar",style:(0,i.j5)("max-height:"+90*(e.rows||5)+"px")},[n.loading?((0,a.wg)(),(0,a.j4)(w,{key:0,class:"grid-menu",style:(0,i.j5)("width: "+(n.width?n.width:300)+"px")},{default:(0,a.w5)((function(){return[(0,a.Wm)(k,{class:"selector-item",style:{width:"100%",padding:"15px"}},{default:(0,a.w5)((function(){return[(0,a.Wm)(y,{avatar:"",paragraph:{rows:2}})]})),_:1})]})),_:1},8,["style"])):((0,a.wg)(),(0,a.j4)(w,{key:1,class:"grid-menu",style:(0,i.j5)("width: "+(n.width?n.width:300)+"px")},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(f.filterOptions,(function(e,t){return(0,a.wg)(),(0,a.j4)(k,{class:(0,i.C_)(["selector-item",(n.value==e.id?"selected":"")+(n.disabled&&n.disabled(e)?" disabled":"")]),key:t,value:e.id,style:(0,i.j5)(n.col?"width:"+100/n.col+"%":n.options.length>=3?"width: 33%;":2==n.options.length?"width:50%;":"width:100%;"),onClick:function(t){return f.select(e)}},{default:(0,a.w5)((function(){return[e.checked?((0,a.wg)(),(0,a.j4)(b,{key:0,class:"CheckOutlined"})):(0,a.kq)("",!0),(0,a._)("div",{class:(0,i.C_)(n.getTag?"mt-15":"")},[n.icon?((0,a.wg)(),(0,a.j4)((0,a.LL)(n.icon),{key:0,"two-tone-color":"#00adef"})):n.svg?((0,a.wg)(),(0,a.iD)("svg",{key:1,class:(0,i.C_)([n.getTag?"mt-20":"","card-avatar icon"]),"aria-hidden":"true"},[(0,a._)("use",{"xlink:href":n.svg},null,8,u)],2)):(0,a.kq)("",!0),(0,a._)("div",c,(0,i.zw)(e.name||e.username),1)],2),n.getTag&&n.getTag(e)?((0,a.wg)(),(0,a.j4)(C,{key:1,class:"ribbon",color:"#f5f5f5"},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(n.getTag(e)),1)]})),_:2},1024)):(0,a.kq)("",!0)]})),_:2},1032,["class","value","style","onClick"])})),128))]})),_:1},8,["style"]))],4)]})),default:(0,a.w5)((function(){return[(0,a.WI)(e.$slots,"default",{},void 0,!0)]})),_:3},8,["placement","visible"])}],["__scopeId","data-v-30bb0bbf"]])},9294:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(66252);n(74916),n(15306);var i=n(29764);(0,n(25552).H)({id:"javascript",extensions:[".js",".es6",".jsx",".mjs"],firstLine:"^#!.*\\bnode",filenames:["jakefile"],aliases:["JavaScript","javascript","js"],mimetypes:["text/javascript"],loader:function(){return n.e(6015).then(n.bind(n,6015))}});var s={name:"JsEditor",components:{monacoeditor:i.Z},props:["value","height","isReadonly","id","theme"],data:function(){return{code:"",cmOptions:{lineNumbers:!0,mode:"javascript",readOnly:!1,lint:!0}}},watch:{value:function(e,t){e!==t&&this.setValue()}},mounted:function(){this.setValue()},methods:{change:function(e){"string"==typeof e&&(this.$emit("update:value",e),this.$emit("change",e))},setValue:function(){null!=this.value.replace&&(this.code=this.value)}}};var l=(0,n(83744).Z)(s,[["render",function(e,t,n,i,s,l){var r=(0,a.up)("monacoeditor");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(r,{id:n.id||"JsEditor",content:s.code,"onUpdate:content":t[0]||(t[0]=function(e){return s.code=e}),option:s.cmOptions,onChange:l.change,height:n.height,theme:n.theme,"is-readonly":n.isReadonly},null,8,["id","content","option","onChange","height","theme","is-readonly"])])}]])},1299:function(e,t,n){n.d(t,{Z:function(){return r}});var a=n(66252),i=n(3577),s={key:0,class:"title"};n(9653);var l={name:"DetailList",props:{title:{type:String,required:!1,default:""},col:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"large"},layout:{type:String,required:!1,default:"horizontal"}}};var r=(0,n(83744).Z)(l,[["render",function(e,t,n,l,r,o){var u=(0,a.up)("a-row");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["detail-list","small"===n.size?"small":"large","vertical"===n.layout?"vertical":"horizontal"]),style:(0,i.j5)("flex-"+n.col)},[n.title?((0,a.wg)(),(0,a.iD)("div",s,(0,i.zw)(n.title),1)):(0,a.kq)("",!0),(0,a.Wm)(u,null,{default:(0,a.w5)((function(){return[(0,a.WI)(e.$slots,"default")]})),_:3})],6)}]])},13589:function(e,t,n){n.d(t,{Z:function(){return o}});n(68309);var a=n(66252),i=n(3577),s={class:"detail-content"};n(21249);var l={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}},r={name:"DetailListItem",i18n:n(39945),props:{name:{type:String,required:!1,default:""},rules:{type:Array,required:!1,default:function(){return[]}},term:{type:String,required:!1,default:""},termTop:{type:Boolean}},data:function(){return{col:2,responsive:l}},computed:{getRules:function(){var e=this;return this.rules.map((function(t){return t.message=e.$t(t.message),t})),this.rules}},created:function(){this.$parent&&this.$parent.$parent&&this.$parent.$parent.col>0&&(this.col=this.$parent.$parent.col)},methods:{}};var o=(0,n(83744).Z)(r,[["render",function(e,t,n,l,r,o){var u=(0,a.up)("a-form-item"),c=(0,a.up)("a-col");return(0,a.wg)(),(0,a.j4)(c,(0,a.dG)({class:"detail-list-content flex"},r.responsive[r.col]),{default:(0,a.w5)((function(){return[(0,a._)("div",{class:(0,i.C_)(n.termTop?"term top":"term")},(0,i.zw)(n.term),3),(0,a._)("div",s,[n.rules?((0,a.wg)(),(0,a.j4)(u,{key:0,name:n.name,rules:o.getRules},{default:(0,a.w5)((function(){return[(0,a.WI)(e.$slots,"default")]})),_:3},8,["name","rules"])):(0,a.WI)(e.$slots,"default",{key:1})])]})),_:3},16)}]])},46908:function(e,t,n){n.r(t),n.d(t,{default:function(){return ne}});n(68309),n(47941);var a=n(66252),i=n(3577),s=n(49963),l={key:0},r={class:"font-primary",href:"javascript:void(0)"},o={key:1},u={class:"font-primary",href:"javascript:void(0)"},c={key:2},d=["onClick"],p={key:0},f={class:"font-s gray mt-10"},h={key:1},m={key:2},v={key:1},g={key:1},y={key:0},k={key:0,class:"full"},w={class:"pointer relative",style:{top:"-2px"}},b={key:0},C={key:1},$={key:1},_={key:1},j={key:6,class:"editable-row-operations"},I={key:0},x=["onClick"],D={key:1},S=["onClick"],P=["onClick"];var z=n(88478),E=n(95082),q=(n(21249),n(74916),n(64765),n(41539),n(54747),n(57658),n(69600),n(40561),n(92222),n(76754)),T=n(9294),W=n(21936),O=n(61103),U=n(1299),V=n(33907),Z=n(13589),B=n(60459),L=n(34531),N=n(96486),A=n.n(N),H=n(44218),R=n(99684),M=n(46981),F=n(54367),K=n(60300),Y=n(75255),J=[{key:"Host",dataIndex:"host"},{key:"Ports(Name/Port/Protocol)",dataIndex:"ports"},{key:"node",dataIndex:"nodeName"},{key:"Ready",dataIndex:"ready"},{key:"Action",dataIndex:"action"}],G=[{key:"Path Type",dataIndex:"pathType"},{key:"Path",dataIndex:"path"},{key:"Host",dataIndex:"host"},{key:"Service",dataIndex:"serviceName"},{key:"Service Port",dataIndex:"servicePort"},{key:"Action",dataIndex:"action"}],Q=[{key:"Service",dataIndex:"serviceName"},{key:"Service Port",dataIndex:"servicePort"},{key:"Action",dataIndex:"action"}],X=[{key:"Host",dataIndex:"host"},{key:"TLS Secret",dataIndex:"secret"},{key:"Action",dataIndex:"action"}],ee={apiVersion:"networking.k8s.io/v1",kind:"Ingress",spec:{ingressClassName:"pipy"}},te={name:"IngressDetail",i18n:n(89234),components:{JsEditor:T.Z,JsonEditor:W.Z,DetailListItem:Z.Z,DetailList:U.Z,PageLayout:O.Z,PlusOutlined:H.Z,PlusCircleTwoTone:R.Z,EditOutlined:M.Z,CloseOutlined:F.Z,FormItem:q.Z,EnvSelector:B.Z,DatabaseOutlined:K.Z,CardSelector:L.Z,CheckOutlined:Y.Z},data:function(){return{certificates:[],labelVisible:!1,labelValue:"",annotationVisible:!1,creationTimestamp:"-",annotationValue:"",pathTypes:["Prefix","Exact","Mixed"],detail:{name:"",namespace:null,tls:[],rules:[],defaultBackend:[],content:{metadata:{name:"",namespace:"",labels:{},annotations:{}}}},selectorLoading:!0,services:[],loading:!0,pid:"",pjsConfig:"",namespace:"",registry:"",isMounted:!1,metrics:[],columns:J,rulecolumns:G,secretrulecolumns:X,defaultBackendcolumns:Q}},computed:(0,E.Z)((0,E.Z)({},(0,V.rn)({rules:function(e){return e.rules.rules},isMobile:function(e){return e.setting.isMobile}})),{},{dataColumns:function(){var e=this;return this.columns.map((function(t){return t.title=e.$t(t.key),t}))},ruledataColumns:function(){var e=this;return this.rulecolumns.map((function(t){return t.title=e.$t(t.key),t}))},defaultColumns:function(){var e=this;return this.defaultBackendcolumns.map((function(t){return t.title=e.$t(t.key),t}))},secretColumns:function(){var e=this;return this.secretrulecolumns.map((function(t){return t.title=e.$t(t.key),t}))}}),created:function(){this.pid=this.$route.params.id||"",this.namespace=this.$route.params.namespace||localStorage.getItem("NAMESPACE"),this.registry=this.$route.params.registry||localStorage.getItem("SCHEMA_ID"),this.getDefaultPjsConfig()},mounted:function(){this.isMounted=!0,""!=this.pid?this.search():(this.detail={namespace:null,name:"",rules:[],tls:[],defaultBackend:[],content:{metadata:{name:"",namespace:"",labels:{},annotations:{}}}},this.loading=!1)},methods:{build:function(e){var t=null;"create"==e?t=A().cloneDeep(ee):(delete(t=A().cloneDeep(this.detail.content)).tls,delete t.rules),this.detail.tls.length>0&&(t.spec.tls=[]),this.detail.tls.forEach((function(e){var n={secretName:e.secret};e.host&&(n.hosts=e.host.split("\n")),t.spec.tls.push(n)})),this.detail.rules.length>0&&(t.spec.rules=[]),this.detail.rules.forEach((function(e){var n=-1;t.spec.rules.forEach((function(t,a){t.host!=e.host&&(t.host||e.host)||(n=a)}));var a={path:e.path,pathType:e.pathType,backend:{service:{name:e.service.name}}};e.servicePort&&(a.backend.service.port={number:e.servicePort}),-1==n&&(e.host?t.spec.rules.push({host:e.host,http:{paths:[]}}):t.spec.rules.push({http:{paths:[]}}),n=t.spec.rules.length-1),t.spec.rules[n].http.paths.push(a)})),this.detail.defaultBackend.forEach((function(e){t.spec.defaultBackend={service:{name:""}},t.spec.defaultBackend.service.name=e.service.name,e.servicePort&&(t.spec.defaultBackend.service.port={number:e.servicePort})})),t.metadata=this.detail.content.metadata,t.metadata.name=this.detail.name,t.metadata.namespace=this.detail.namespace.name,this.detail.content=t},reset:function(){var e,t=this,n=this.detail.content;(this.detail.defaultBackend=[],n.spec.defaultBackend)&&this.detail.defaultBackend.push({isedit:!1,service:{name:n.spec.defaultBackend.service.name},servicePort:(null===(e=n.spec.defaultBackend.service.port)||void 0===e?void 0:e.number)||""});this.detail.rules=[],n.spec.rules.forEach((function(e){e.http.paths.forEach((function(n){var a;t.detail.rules.push({isedit:!1,host:e.host,service:{name:n.backend.service.name},servicePort:(null===(a=n.backend.service.port)||void 0===a?void 0:a.number)||"",path:n.path,pathType:n.pathType})}))})),this.detail.tls=[],(n.spec.tls||[]).forEach((function(e){t.detail.tls.push({isedit:!1,secret:e.secretName,host:e.hosts?e.hosts.join("\n"):""})}))},handleClose:function(e,t){delete e[t]},labelShowInput:function(){var e=this;this.labelVisible=!0,this.$nextTick().then((function(){e.$refs.labelRef.focus()}))},labelInputConfirm:function(){if(""!=this.labelValue){var e=this.labelValue.split(":");e.length<2?this.$message.error({content:this.$t("Please enter the format of [key]:[value]")}):(this.detail.content.metadata.labels=this.detail.content.metadata.labels||{},this.detail.content.metadata.labels[e.shift()]=e.join(":"),this.labelValue="",this.labelVisible=!1)}else this.labelVisible=!1},annotationShowInput:function(){var e=this;this.annotationVisible=!0,this.$nextTick().then((function(){e.$refs.annotationRef.focus()}))},annotationInputConfirm:function(){if(""!=this.annotationValue){var e=this.annotationValue.split(":");e.length<2?this.$message.error({content:this.$t("Please enter the format of [key]:[value]")}):(this.detail.content.metadata.annotations=this.detail.content.metadata.annotations||{},this.detail.content.metadata.annotations[e.shift()]=e.join(":"),this.annotationValue="",this.annotationVisible=!1)}else this.annotationVisible=!1},addEndpoints:function(){this.detail.endpoints=this.detail.endpoints||[],this.detail.endpoints.push({isedit:!0,host:"",port_val:"",nodeName:"",ready:""})},addRule:function(e){0==e?(this.detail.rules=this.detail.rules||[],this.detail.rules.push({isedit:!0,host:"",service:null,serviceName:"",servicePort:"",path:"",pathType:"Prefix"})):1==e?(this.detail.defaultBackend=this.detail.defaultBackend||[],this.detail.defaultBackend.push({isedit:!0,service:null,serviceName:"",servicePort:""})):2==e&&(this.detail.tls=this.detail.tls||[],this.detail.tls.push({isedit:!0,secret:null,host:""}))},remove:function(e,t){0==e?this.detail.rules.splice(t,1):1==e?this.detail.defaultBackend.splice(t,1):2==e&&this.detail.tls.splice(t,1)},cancel:function(e){e.isedit=!1},edit:function(e){e.isedit=!0},excute:function(){var e=this;this.$message.loading({content:this.$t("Running..."),key:"excute"}),setTimeout((function(){e.$message.success({content:e.$t("Publish success!"),key:"excute",duration:2})}),1e3)},pjsChange:function(e){this.pjsConfig=e},getDefaultPjsConfig:function(){var e=this;fetch("pipy-4lb.js").then((function(e){return e.text()})).then((function(t){e.pjsConfig=t})).catch((function(e){}))},onTabChange:function(e){},getServices:function(){var e=this;this.selectorLoading=!0;var t={namespace:{eq:this.detail.namespace.name},registry:{id:{eq:this.detail.namespace.registry.id}}};this.$gql.query("services(filters: $filters, pagination: {start: 0, limit: ".concat(this.$DFT_LIMIT,"} ){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}"),{filters:t},{filters:"ServiceFiltersInput",pagination:"PaginationArg"}).then((function(t){e.selectorLoading=!1,e.services=t.data,e.services.forEach((function(e){e.name=e.name?e.name:e.metadata.name,e.registry?e.clusterName=e.registry.name:e.fleet?e.clusterName=e.fleet.name:e.clusterName="-"}))}))},saveService:function(e,t){e.service=t},search:function(){var e=this;this.loading=!0,this.$gql.query("getIngress(id: ".concat(this.pid,"){data{id,attributes{\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t}}}")).then((function(t){e.loading=!1,e.creationTimestamp=new Date(t.data.createdAt).toLocaleString(),e.detail=t.data,e.reset(),e.envChange()}))},valid:function(){return""!=this.detail.name||(this.$message.error(this.$t("The name cannot be empty"),3),!1)},save:function(){var e=this;if(this.valid()){this.build(""!=this.pid?"update":"create");var t=A().cloneDeep(this.detail.content);""!=this.pid?this.$gql.mutation("updateIngressSync(id:".concat(this.pid,", data: $data){data{id}}"),{data:{name:this.detail.name,namespace:this.detail.namespace.id,registry:this.registry,content:t}},{data:"IngressInput!"}).then((function(){e.$message.success(e.$t("Save successfully"),3),e.$closePage(e.$route)})):this.$gql.mutation("createIngressSync(data: $data){data{id}}",{data:{name:this.detail.name,content:t,namespace:this.detail.namespace.id,registry:this.registry}},{data:"IngressInput!"}).then((function(t){e.pid=t.data.id,e.$message.success(e.$t("Created successfully"),3),e.$closePage(e.$route)}))}},validate:function(){var e=this;this.$refs.layout.$refs.form.validateFields().then((function(){e.save()})).catch((function(){}))},servicedetail:function(e){this.$router.push({path:"/fsm/service/detail/"+e})},envChange:function(){var e,t,n;null!==(e=this.detail.namespace)&&void 0!==e&&e.id&&this.getCertificates(),null!==(t=this.detail.namespace)&&void 0!==t&&null!==(n=t.registry)&&void 0!==n&&n.id&&this.getServices()},getCertificates:function(){var e=this;this.$gql.query("certificates(filters: $filters, pagination: { start: 0, limit: ".concat(this.$DFT_LIMIT,"}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}"),{filters:{type:{eq:"k8s"},namespace:{id:{eq:this.detail.namespace.id}}}},{filters:"CertificateFiltersInput",pagination:"PaginationArg"}).then((function(t){e.certificates=t.data,e.certificates.forEach((function(e){e.id=e.name})),e.certificates=[{id:null,name:e.$t("unset")}].concat((0,z.Z)(e.certificates))}))}}};var ne=(0,n(83744).Z)(te,[["render",function(e,t,n,z,E,q){var T=(0,a.up)("DetailListItem"),W=(0,a.up)("a-input"),O=(0,a.up)("EnvSelector"),U=(0,a.up)("DetailList"),V=(0,a.up)("a-tag"),Z=(0,a.up)("PlusOutlined"),B=(0,a.up)("a-tooltip"),L=(0,a.up)("JsonEditor"),N=(0,a.up)("a-popover"),A=(0,a.up)("a-button"),H=(0,a.up)("PlusCircleTwoTone"),R=(0,a.up)("a-textarea"),M=(0,a.up)("FormItem"),F=(0,a.up)("a-select-option"),K=(0,a.up)("a-select"),Y=(0,a.up)("CloseOutlined"),J=(0,a.up)("DatabaseOutlined"),G=(0,a.up)("CardSelector"),Q=(0,a.up)("a-input-number"),X=(0,a.up)("CheckOutlined"),ee=(0,a.up)("EditOutlined"),te=(0,a.up)("a-table"),ne=(0,a.up)("a-card"),ae=(0,a.up)("a-col"),ie=(0,a.up)("a-row"),se=(0,a.up)("a-tab-pane"),le=((0,a.up)("JsEditor"),(0,a.up)("a-tabs")),re=(0,a.up)("PageLayout"),oe=(0,a.Q2)("permission");return(0,a.wg)(),(0,a.j4)(re,{title:e.$t("Ingress"),"form-state":E.detail,ref:"layout"},{headerContent:(0,a.w5)((function(){return[(0,a.Wm)(U,{size:"small",col:1,style:{width:"60%"}},{default:(0,a.w5)((function(){var n;return[""!=E.pid?((0,a.wg)(),(0,a.j4)(T,{key:0,term:e.$t("UID")},{default:(0,a.w5)((function(){var e;return[(0,a.Uk)((0,i.zw)(null===(e=E.detail.content.metadata)||void 0===e?void 0:e.uid),1)]})),_:1},8,["term"])):(0,a.kq)("",!0),(0,a.Wm)(T,{term:e.$t("as"),rules:e.rules.uniqueName("ingresses",{id:E.pid,namespace:null===(n=E.detail.namespace)||void 0===n?void 0:n.id}),name:"name"},{default:(0,a.w5)((function(){return[(0,a.Wm)(W,{placeholder:e.$t("unset"),value:E.detail.name,"onUpdate:value":t[0]||(t[0]=function(e){return E.detail.name=e}),class:"bold width-300"},null,8,["placeholder","value"])]})),_:1},8,["term","rules"]),(0,a.Wm)(T,{term:e.$t("Namespace")},{default:(0,a.w5)((function(){return[(0,a.Wm)(O,{"no-all":!0,namespace:E.detail.namespace,"onUpdate:namespace":t[1]||(t[1]=function(e){return E.detail.namespace=e}),"is-filter":!0,onEnvChange:q.envChange},null,8,["namespace","onEnvChange"])]})),_:1},8,["term"]),""!=E.pid?((0,a.wg)(),(0,a.j4)(T,{key:1,term:e.$t("Creation Timestamp")},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(E.creationTimestamp),1)]})),_:1},8,["term"])):(0,a.kq)("",!0)]})),_:1}),(0,a.Wm)(U,{size:"small",col:1},{default:(0,a.w5)((function(){return[(0,a.Wm)(T,{term:e.$t("Labels")},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(E.detail.content.metadata.labels||[]),(function(e,t){return(0,a.wg)(),(0,a.j4)(V,{key:t,onClose:function(t){return q.handleClose(E.detail.content.metadata.labels,e)},closable:!0},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e)+":"+(0,i.zw)(E.detail.content.metadata.labels[e]),1)]})),_:2},1032,["onClose"])})),128)),(0,a.wy)((0,a.Wm)(W,{ref:"labelRef",type:"text",size:"small",class:"width-100",placeholder:"[KEY:VALUE]",value:E.labelValue,"onUpdate:value":t[2]||(t[2]=function(e){return E.labelValue=e}),onBlur:q.labelInputConfirm,onKeyup:(0,s.D2)(q.labelInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"]),[[s.F8,E.labelVisible]]),E.labelVisible?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(V,{key:0,onClick:q.labelShowInput,class:"dashed-tag"},{default:(0,a.w5)((function(){return[(0,a.Wm)(Z),(0,a.Uk)(" "+(0,i.zw)(e.$t("add")),1)]})),_:1},8,["onClick"])),[[oe,["ingress:update"]]])]})),_:1},8,["term"]),(0,a.Wm)(T,{term:e.$t("Annotations")},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(E.detail.content.metadata.annotations||[]),(function(e,t){return(0,a.wg)(),(0,a.j4)(V,{key:t,onClose:function(t){return q.handleClose(E.detail.content.metadata.annotations,e)},closable:!0,class:"mb-5"},{default:(0,a.w5)((function(){return["objectset.rio.cattle.io/applied"==e?((0,a.wg)(),(0,a.iD)("span",l,[(0,a.Wm)(B,{placement:"topLeft",title:E.detail.content.metadata.annotations[e]},{default:(0,a.w5)((function(){return[(0,a._)("a",r,(0,i.zw)(e),1)]})),_:2},1032,["title"])])):"kubectl.kubernetes.io/last-applied-configuration"==e?((0,a.wg)(),(0,a.iD)("span",o,[(0,a.Wm)(N,{trigger:"click",title:e},{content:(0,a.w5)((function(){return[(0,a.Wm)(L,{"is-json":!0,value:E.detail.content.metadata.annotations[e]},null,8,["value"])]})),default:(0,a.w5)((function(){return[(0,a._)("a",u,(0,i.zw)(e),1)]})),_:2},1032,["title"])])):((0,a.wg)(),(0,a.iD)("span",c,(0,i.zw)(e)+":"+(0,i.zw)(E.detail.content.metadata.annotations[e]),1))]})),_:2},1032,["onClose"])})),128)),(0,a.wy)((0,a.Wm)(W,{ref:"annotationRef",type:"text",size:"small",class:"width-100",placeholder:"[KEY:VALUE]",value:E.annotationValue,"onUpdate:value":t[3]||(t[3]=function(e){return E.annotationValue=e}),onBlur:q.annotationInputConfirm,onKeyup:(0,s.D2)(q.annotationInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"]),[[s.F8,E.annotationVisible]]),E.annotationVisible?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(V,{key:0,onClick:q.annotationShowInput,class:"dashed-tag"},{default:(0,a.w5)((function(){return[(0,a.Wm)(Z),(0,a.Uk)(" "+(0,i.zw)(e.$t("add")),1)]})),_:1},8,["onClick"])),[[oe,["ingress:update"]]])]})),_:1},8,["term"])]})),_:1})]})),action:(0,a.w5)((function(){return[""!=E.pid?(0,a.wy)(((0,a.wg)(),(0,a.j4)(A,{key:0,type:"primary",onClick:q.validate},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e.$t("save")),1)]})),_:1},8,["onClick"])),[[oe,["ingress:update"]]]):(0,a.wy)(((0,a.wg)(),(0,a.j4)(A,{key:1,type:"primary",onClick:q.validate},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e.$t("create")),1)]})),_:1},8,["onClick"])),[[oe,["ingress:create"]]])]})),default:(0,a.w5)((function(){return[(0,a.Wm)(le,{type:"card"},{default:(0,a.w5)((function(){return[(0,a.Wm)(se,{key:"1",tab:e.$t("Overview")},{default:(0,a.w5)((function(){return[(0,a.Wm)(ie,{class:"row-mg"},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)([{s:24,t:e.$t("Rules"),c:q.ruledataColumns,d:E.detail.rules},{s:12,t:e.$t("Default Backend"),c:q.defaultColumns,d:E.detail.defaultBackend},{s:12,t:e.$t("Secret"),c:q.secretColumns,d:E.detail.tls}],(function(n,l){return(0,a.wg)(),(0,a.j4)(ae,{key:l,class:"col-pd",xl:n.s,lg:24,md:24,sm:24,xs:24},{default:(0,a.w5)((function(){return[(0,a.Wm)(ne,{class:"card mb-20 nopd",bordered:!1,loading:E.loading,title:n.t},{extra:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(e){return q.addRule(l)},class:(0,i.C_)(E.detail.namespace?"":"disabed-element"),href:"javascript:void(0)"},[(0,a.Wm)(H,{class:"font-20"})],10,d)),[[oe,["ingress:update"]],[s.F8,1!=l||1==l&&0==n.d.length]])]})),default:(0,a.w5)((function(){return[(0,a.Wm)(te,{pagination:!1,columns:n.c,"data-source":n.d,loading:E.loading,class:"bg-white"},{bodyCell:(0,a.w5)((function(n){var s=n.column,r=n.record,o=n.index;return["host"===s.dataIndex?((0,a.wg)(),(0,a.j4)(M,{key:0,name:["tls",o,"host"],cond:2==l,rules:e.rules.required},{default:(0,a.w5)((function(){return[r.isedit&&2==l?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(R,{class:"edit-input",value:r.host,"onUpdate:value":function(e){return r.host=e},placeholder:e.$t("unset"),rows:2},null,8,["value","onUpdate:value","placeholder"]),(0,a._)("div",f,(0,i.zw)(e.$t("List of host")),1)])):r.isedit&&0==l?((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(W,{value:r.host,"onUpdate:value":function(e){return r.host=e},class:"edit-input"},null,8,["value","onUpdate:value"])])):((0,a.wg)(),(0,a.iD)("div",m,(0,i.zw)(r.host||"-"),1))]})),_:2},1032,["name","cond","rules"])):"path"===s.dataIndex?((0,a.wg)(),(0,a.j4)(M,{key:1,name:["rules",o,"path"],rules:e.rules.required},{default:(0,a.w5)((function(){return[r.isedit?((0,a.wg)(),(0,a.j4)(W,{key:0,value:r.path,"onUpdate:value":function(e){return r.path=e},class:"edit-input"},null,8,["value","onUpdate:value"])):((0,a.wg)(),(0,a.iD)("div",v,(0,i.zw)(r.path||"-"),1))]})),_:2},1032,["name","rules"])):"pathType"===s.dataIndex?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[r.isedit?((0,a.wg)(),(0,a.j4)(K,{key:0,class:"width-200",value:r.pathType,"onUpdate:value":function(e){return r.pathType=e}},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(E.pathTypes,(function(e,t){return(0,a.wg)(),(0,a.j4)(F,{value:e,key:t},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["value","onUpdate:value"])):((0,a.wg)(),(0,a.iD)("div",g,(0,i.zw)(r.pathType||"-"),1))],64)):"serviceName"===s.dataIndex?((0,a.wg)(),(0,a.j4)(M,{key:3,name:[["rules",o,"service"],["defaultBackend",o,"service"],null][l],rules:e.rules.objectRequired},{default:(0,a.w5)((function(){var n;return[r.isedit?((0,a.wg)(),(0,a.iD)("div",y,[r.service?((0,a.wg)(),(0,a.iD)("div",k,[e.detailType?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(Y,{key:0,onClick:function(){r.service=null},class:"absolute icon-menu rotate-icon",style:{right:"10px",top:"-5px"}},null,8,["onClick"])),(0,a.Wm)(J,{class:"font-20 mr-10 primary"}),(0,a._)("a",w,[(0,a._)("b",null,(0,i.zw)(r.service.name),1)])])):(0,a.kq)("",!0),(0,a.Wm)(G,{loading:E.selectorLoading,width:400,col:2,"env-filter":!1,search:!0,placement:"right",icon:e.DatabaseOutlined,onSelect:function(e){q.saveService(r,e)},"get-tag":function(e){return e.clusterName+" / "+e.namespace},options:E.services},{default:(0,a.w5)((function(){return[r.service?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("a",b,[(0,a.Wm)(V,{color:"#00adef",key:"submit",type:"primary"},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e.$t("Select k8s service")),1)]})),_:1})]))]})),_:2},1032,["loading","icon","onSelect","get-tag","options"])])):((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("a",{href:"javascript:void(0)",onClick:t[4]||(t[4]=function(t){return q.servicedetail(e.text)})},(0,i.zw)((null===(n=r.service)||void 0===n?void 0:n.name)||"-"),1)]))]})),_:2},1032,["name","rules"])):"servicePort"===s.dataIndex?((0,a.wg)(),(0,a.j4)(M,{key:4,name:[["rules",o,"servicePort"],["defaultBackend",o,"servicePort"],null][l],rules:e.rules.numberRequired},{default:(0,a.w5)((function(){return[r.isedit?((0,a.wg)(),(0,a.j4)(Q,{key:0,value:r.servicePort,"onUpdate:value":function(e){return r.servicePort=e},class:"edit-input"},null,8,["value","onUpdate:value"])):((0,a.wg)(),(0,a.iD)("div",$,(0,i.zw)(r.servicePort||"-"),1))]})),_:2},1032,["name","rules"])):"secret"===s.dataIndex?((0,a.wg)(),(0,a.iD)(a.HY,{key:5},[r.isedit?((0,a.wg)(),(0,a.j4)(K,{key:0,class:"width-100",value:r.secret,"onUpdate:value":function(e){return r.secret=e}},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(E.certificates,(function(e,t){return(0,a.wg)(),(0,a.j4)(F,{value:e.id,key:t},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["value","onUpdate:value"])):((0,a.wg)(),(0,a.iD)("div",_,(0,i.zw)(r.secret||"-"),1))],64)):"action"===s.dataIndex?((0,a.wg)(),(0,a.iD)("div",j,[r.isedit?((0,a.wg)(),(0,a.iD)("span",I,[(0,a._)("a",{onClick:function(e){return q.cancel(r)}},[(0,a.Wm)(X,{class:"icon-menu"})],8,x)])):((0,a.wg)(),(0,a.iD)("span",D,[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(e){return q.edit(r)}},[(0,a.Wm)(ee,{class:"icon-menu"})],8,S)),[[oe,["ingress:update"]]])])),(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(e){return q.remove(l,o)}},[(0,a.Wm)(Y,{class:"icon-menu"})],8,P)),[[oe,["ingress:update"]]])])):(0,a.kq)("",!0)]})),_:2},1032,["columns","data-source","loading"])]})),_:2},1032,["loading","title"])]})),_:2},1032,["xl"])})),128))]})),_:1})]})),_:1},8,["tab"]),(0,a.kq)("",!0),(0,a.kq)("",!0)]})),_:1})]})),_:1},8,["title","form-state"])}]])}}]);