"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[6019],{18531:function(e,t,s){s.r(t),s.d(t,{default:function(){return G}});var a=s(66252),o=s(3577),i=s.p+"static/img/flomesh-short.0517966e.png",r=s.p+"static/img/logo1.166eada4.png";const n=e=>((0,a.dD)("data-v-f5fe9576"),e=e(),(0,a.Cn)(),e),l={class:"login-warpper"},d={class:"top"},m={class:"header"},u=n((()=>(0,a._)("div",{class:"logo-mask"},null,-1))),c=n((()=>(0,a._)("img",{class:"logo-back",src:i},null,-1))),p=n((()=>(0,a._)("img",{alt:"logo",class:"logo",src:r},null,-1))),h={key:"reg"},g={key:"forget"},f={key:"login"};var w=s(49963);const v={key:1};var y=s(53962),F={name:"PageToggleTransition",props:{disabled:{type:Boolean},animate:{type:String,validator(e){return-1!=y.preset.findIndex((t=>t.name==e))},default:"bounce"},direction:{type:String,default:null,validator(e){return["x","y","left","right","up","down","downLeft","upRight","downRight","upLeft","downBig","upBig","downLeft","downRight","topRight","bottomLeft","topLeft","bottomRight","default"].indexOf(e)>-1}},reverse:{type:[Boolean],default:!0}},computed:{enterAnimate(){return this.activeClass(!1)},leaveAnimate(){return this.activeClass(!0)}},methods:{activeClass(e){let t=y.preset.find((e=>this.animate==e.name));if(null==t)return"";let s="";s=null==this.direction?t.directions[0]:t.directions.find((e=>e==this.direction)),s=null==s||"default"===s?"":s,""!=s&&(s=e&&this.reverse?this.reversePosition(s,t.directions):s,s=s[0].toUpperCase()+s.substring(1));let a=e?"Out":"In";return t.name+a+s},reversePosition(e,t){if(0==e.length||"x"==e||"y"==e)return e;let s=t.indexOf(e);return s=s%2==1?s-1:s+1,t[s]}}},S=s(83744);var k=(0,S.Z)(F,[["render",function(e,t,s,o,i,r){return s.disabled?((0,a.wg)(),(0,a.iD)("div",v,[(0,a.WI)(e.$slots,"default")])):((0,a.wg)(),(0,a.j4)(w.uT,{key:0,"enter-active-class":`animated ${r.enterAnimate} page-toggle-enter-active`,"leave-active-class":`animated ${r.leaveAnimate} page-toggle-leave-active`},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default")])),_:3},8,["enter-active-class","leave-active-class"]))}]]);const $={class:"common-layout"},b={class:"content"};var _=s(34238),I=s(33907),P={name:"CommonLayout",components:{PageFooter:_.Z},computed:{...(0,I.rn)("setting",["footerLinks","copyright"])}};var W=(0,S.Z)(P,[["render",function(e,t,s,o,i,r){const n=(0,a.up)("PageFooter");return(0,a.wg)(),(0,a.iD)("div",$,[(0,a._)("div",b,[(0,a.WI)(e.$slots,"default",{},void 0,!0)]),(0,a.Wm)(n,{"link-list":e.footerLinks,copyright:e.copyright},null,8,["link-list","copyright"])])}],["__scopeId","data-v-1af41482"]]);const z={class:"login login-form"},C={class:"login-foot"};s(57658);var R=s(93099),U=s(84471),T=s(8910),L=s(53539),j=s(70262),Z=s(58426),x=s(70473),E=s(68695),A=s(79332),O=s(5216),D={name:"LoginForm",components:{SnsCode:L.Z,MdInput:T.Z,ArrowRightOutlined:Z.Z,FormItem:A.Z},i18n:s(1610),inject:["last","next"],data(){return{loginCode:"pass",snsloading:!1,snsstatus:"free",snsnum:0,hover:!1,logging:!1,error:"",activeKey:"1",password:"",formState:{snscode:"",name:"",password:"",automatic:!0}}},computed:{...(0,I.rn)("rules",["rules"]),...(0,I.Se)("account",["user"]),systemName(){return this.$store.state.setting.systemName}},methods:{...(0,I.OI)("account",["setUser","setPermissions","setRoles"]),getCookies(){if(this.formState.name){let e=j.Z.get(this.formState.name);e&&(this.formState.password=(0,O.decrypt)(e))}},forget(){this.next()},handleFinish(){this.logging=!0;const e=this.formState.name,t=this.formState.password,s=this.formState.snscode;(0,R.x4)(e,t,s,!0).then(this.afterLogin).catch((()=>{this.logging=!1,this.$message.error(this.$t("The password or verification code is incorrect"),3)}))},passwordfocus(){this.$refs.password.getfocus()},snsfocus(){this.$refs.snscode.getfocus()},handleFinishFailed(){},validate(){this.$refs.form.validateFields().then((()=>{this.handleFinish()})).catch((()=>{}))},afterLogin(e){this.logging=!1;const t=e||{};if(!e.errors)if(t.jwt){this.formState.automatic?j.Z.set(this.formState.name,(0,O.encrypt)(this.formState.password)):j.Z.remove(this.formState.name),this.setUser({name:this.formState.name,avatar:"@AVATAR",address:"@CITY",position:"@POSITION",...t.user}),(0,U.EP)({token:t.jwt,expireAt:new Date((new Date).getTime()+72e5)},"basic");const e=s(61006);x.Z.open({message:this.$t("Login successfully"),icon:(0,a.h)("img",{src:e,width:35,height:35,style:"posirion:relative,left:-30px"}),placement:"bottomRight",description:this.formState.name+"，"+this.$t("Welcome back")});let o=null;(0,R.bG)().then((e=>{e.data.role?.id&&((0,R.Yj)({id:e.data.role.id}).then((e=>{o=e,this.setRoles(e),setTimeout((()=>{this.$router.push("/workplace")}),300)})),this.$gql.query(`userOrganizationRoles(pagination:{limit: ${this.$DFT_LIMIT}},filters:{user:{id:{eq:${t.user.id}}}}){data{id,attributes{\n\t\t\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\t\t\tproject{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\torganization{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\trole{data{id,attributes{name}}}\n\t\t\t\t\t\t\t\t}}}`).then((e=>{this.setPermissions(e.data),e.data.forEach((e=>{e.role&&e.role.id&&(0,R.Yj)({id:e.role.id}).then((t=>{let s=[];t.permissions.forEach((t=>{s.push({...t,type:e.type,project:e.project,organization:e.organization})})),o.permissions=o.permissions.concat(s),this.setRoles(o)}))}))})))}));let i=".pro";const r=s(75688)(`./config${i}`).default;(0,E.tO)(r)}else this.error=t.message}}};var q=(0,S.Z)(D,[["render",function(e,t,s,i,r,n){const l=(0,a.up)("a-alert"),d=(0,a.up)("MdInput"),m=(0,a.up)("FormItem"),u=(0,a.up)("SnsCode"),c=(0,a.up)("a-switch"),p=(0,a.up)("ArrowRightOutlined"),h=(0,a.up)("a-button"),g=(0,a.up)("a-form-item"),f=(0,a.up)("a-form");return(0,a.wg)(),(0,a.iD)("div",z,[(0,a.Wm)(f,{model:r.formState,"wrapper-col":{span:24},onFinish:n.handleFinish,onFinishFailed:n.handleFinishFailed,ref:"form"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(l,{type:"error",closable:!0,message:r.error,"show-icon":"",class:"mb-24"},null,8,["message"]),[[w.F8,r.error]]),(0,a.Wm)(m,{class:"mb-20",name:"name",rules:e.rules.name},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{icon:"email",size:"large","auto-complete":"new-password",value:r.formState.name,"onUpdate:value":t[0]||(t[0]=e=>r.formState.name=e),placeholder:e.$t("Please input user or email"),onPressEnter:n.passwordfocus},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("User")),1)])),_:1},8,["value","placeholder","onPressEnter"])])),_:1},8,["rules"]),(0,a.Wm)(m,{class:"mb-20",name:"password",rules:e.rules.password},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{type:"password",icon:"password",ref:"password",onFocus:n.getCookies,"auto-complete":"new-password",size:"large",value:r.formState.password,"onUpdate:value":t[1]||(t[1]=e=>r.formState.password=e),name:"title",onPressEnter:n.snsfocus,placeholder:e.$t("Please input password")},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("Password")),1)])),_:1},8,["onFocus","value","onPressEnter","placeholder"])])),_:1},8,["rules"]),e.user?.name!=r.formState.name?((0,a.wg)(),(0,a.j4)(u,{key:0,class:"mb-20",ref:"snscode",value:r.formState.snscode,"onUpdate:value":t[2]||(t[2]=e=>r.formState.snscode=e),onValidate:n.validate,username:r.formState.name},null,8,["value","onValidate","username"])):(0,a.kq)("",!0),(0,a._)("div",C,[(0,a.Wm)(c,{checked:r.formState.automatic,"onUpdate:checked":t[3]||(t[3]=e=>r.formState.automatic=e),size:"small","default-checked":"",class:"login-switch"},null,8,["checked"]),(0,a.Uk)(" "+(0,o.zw)(e.$t("Trust device"))+" ",1),"pass"!=r.loginCode?((0,a.wg)(),(0,a.iD)("a",{key:0,onClick:t[4]||(t[4]=(...e)=>n.forget&&n.forget(...e)),class:"float-right"},[(0,a.Uk)((0,o.zw)(e.$t("Forget"))+" ",1),(0,a.Wm)(p)])):(0,a.kq)("",!0)]),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{loading:r.logging,class:"login-btn",size:"large",onClick:n.validate,type:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("Login")),1)])),_:1},8,["loading","onClick"])])),_:1})])),_:1},8,["model","onFinish","onFinishFailed"])])}],["__scopeId","data-v-070b7eac"]]),M=s(72424);const N={class:"login reg-form"};var V={name:"RegForm",components:{MdInput:T.Z,ArrowRightOutlined:Z.Z,FormItem:A.Z,SnsCode:L.Z},i18n:s(1610),inject:["next"],props:["nofoot"],data(){return{snsloading:!1,snsstatus:"free",snsnum:0,hover:!1,logging:!1,error:"",activeKey:"1",user:"",password:"",formState:{snscode:"",name:"",email:"",password:"",automatic:!0}}},computed:{...(0,I.rn)("rules",["rules"]),systemName(){return this.$store.state.setting.systemName}},methods:{...(0,I.OI)("account",["setUser","setPermissions","setRoles"]),gologin(){this.next()},handleFinish(){this.logging=!0;const e=this.formState.name,t=this.formState.email,s=this.formState.snscode,a=this.formState.password;(0,R.z2)(e,t,a,s).then(this.afterLogin).catch((e=>{this.logging=!1,e.length&&e[0].message?this.$message.error(this.$t(e[0].message),3):this.$message.error(this.$t("The email already exists"),3)}))},passwordfocus(){this.$refs.password.getfocus()},snsfocus(){this.$refs.snscode.getfocus()},handleFinishFailed(){},validate(){this.$refs.form.validateFields().then((()=>{this.handleFinish()})).catch((()=>{}))},afterLogin(e){this.logging=!1;const t=e;if(!e.errors)if(t.jwt){this.setUser({name:this.formState.name,avatar:"@AVATAR",address:"@CITY",position:"@POSITION"}),(0,U.EP)({token:t.jwt,expireAt:new Date((new Date).getTime()+18e5)},"basic");const e=s(61006);x.Z.open({message:this.$t("Login successfully"),icon:(0,a.h)("img",{src:e,width:35,height:35,style:"posirion:relative,left:-30px"}),placement:"bottomRight",description:this.formState.name+"，"+this.$t("Welcome back")});let o=null;(0,R.bG)().then((e=>{e.data.role?.id&&(0,R.Yj)({id:e.data.role.id}).then((e=>{o=e,this.setRoles(e),setTimeout((()=>{this.$router.push("/workplace")}),300),this.$gql.query(`userOrganizationRoles(pagination:{limit: ${this.$DFT_LIMIT}},filters:{user:{id:{eq:${t.user.id}}}}){data{id,attributes{\n\t\t\t\t\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\t\t\t\t\tproject{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\t\t\torganization{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\t\t\trole{data{id,attributes{name}}}\n\t\t\t\t\t\t\t\t\t\t}}}`).then((e=>{this.setPermissions(e.data),e.data.forEach((e=>{e.role&&e.role.id&&(0,R.Yj)({id:e.role.id}).then((t=>{let s=[];t.permissions.forEach((t=>{s.push({...t,type:e.type,project:e.project,organization:e.organization})})),o.permissions=o.permissions.concat(s),this.setRoles(o)}))}))}))}))}))}else this.error=t.message}}};var Y=(0,S.Z)(V,[["render",function(e,t,s,i,r,n){const l=(0,a.up)("a-alert"),d=(0,a.up)("MdInput"),m=(0,a.up)("FormItem"),u=(0,a.up)("SnsCode"),c=((0,a.up)("ArrowRightOutlined"),(0,a.up)("a-button")),p=(0,a.up)("a-form-item"),h=(0,a.up)("a-form");return(0,a.wg)(),(0,a.iD)("div",N,[(0,a.Wm)(h,{model:r.formState,"wrapper-col":{span:24},onFinish:n.handleFinish,onFinishFailed:n.handleFinishFailed,rules:e.getRules,ref:"form"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(l,{type:"error",closable:!0,message:r.error,"show-icon":"",class:"mb-24"},null,8,["message"]),[[w.F8,r.error]]),(0,a.Wm)(m,{class:"mb-20",name:"name",rules:e.rules.name},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{icon:"user",size:"large",value:r.formState.name,"onUpdate:value":t[0]||(t[0]=e=>r.formState.name=e),placeholder:e.$t("Please input user name"),onPressEnter:n.passwordfocus},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("User")),1)])),_:1},8,["value","placeholder","onPressEnter"])])),_:1},8,["rules"]),(0,a.Wm)(m,{class:"mb-20",name:"email",rules:e.rules.email},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{icon:"email",size:"large",value:r.formState.email,"onUpdate:value":t[1]||(t[1]=e=>r.formState.email=e),placeholder:e.$t("Please input email"),onPressEnter:n.passwordfocus},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("Email")),1)])),_:1},8,["value","placeholder","onPressEnter"])])),_:1},8,["rules"]),(0,a.Wm)(u,{class:"mb-20",ref:"snscode",value:r.formState.snscode,"onUpdate:value":t[2]||(t[2]=e=>r.formState.snscode=e),onValidate:n.validate,username:r.formState.email},null,8,["value","onValidate","username"]),(0,a.Wm)(m,{class:"mb-20",name:"password",rules:e.rules.password},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{type:"password",icon:"password",ref:"password","auto-complete":"new-password",size:"large",value:r.formState.password,"onUpdate:value":t[3]||(t[3]=e=>r.formState.password=e),name:"title",onPressEnter:n.snsfocus,placeholder:e.$t("Please input password")},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("Password")),1)])),_:1},8,["value","onPressEnter","placeholder"])])),_:1},8,["rules"]),(0,a.kq)("",!0),s.nofoot?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(p,{key:1},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{loading:r.logging,class:"login-btn primary",size:"large",onClick:n.validate,type:"dashed",ghost:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.$t("Register initial user")),1)])),_:1},8,["loading","onClick"])])),_:1}))])),_:1},8,["model","onFinish","onFinishFailed","rules"])])}],["__scopeId","data-v-28b1ecdf"]]),B={name:"Login",components:{CommonLayout:W,LoginForm:q,ForgetForm:M.Z,RegForm:Y,PageToggleTransition:k},i18n:s(1610),provide(){return{next:this.next,last:this.last}},data(){return{step:0,direction:0,version:"pro"}},created(){this.isInitialized()},methods:{isInitialized(){this.$gql.query("getInitialized").then((e=>{e||this.last()}))},next(){this.direction=1,this.step+=this.direction},last(){this.direction=-1,this.step+=this.direction}}};var G=(0,S.Z)(B,[["render",function(e,t,s,i,r,n){const w=(0,a.up)("a-tag"),v=(0,a.up)("RegForm"),y=(0,a.up)("ForgetForm"),F=(0,a.up)("LoginForm"),S=(0,a.up)("PageToggleTransition"),k=(0,a.up)("CommonLayout");return(0,a.wg)(),(0,a.j4)(k,null,{default:(0,a.w5)((()=>[(0,a._)("div",l,[(0,a._)("div",d,[(0,a._)("div",m,[u,c,p,(0,a.Wm)(w,{class:"logo-tag",color:"#00adef"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)("free"==r.version?"Community":r.version),1)])),_:1})])]),(0,a.Wm)(S,{direction:r.direction<0?"left":"right",animate:"bounce"},{default:(0,a.w5)((()=>[-1==r.step?((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(v)])):1==r.step?((0,a.wg)(),(0,a.iD)("div",g,[(0,a.Wm)(y)])):((0,a.wg)(),(0,a.iD)("div",f,[(0,a.Wm)(F)]))])),_:1},8,["direction"])])])),_:1})}],["__scopeId","data-v-f5fe9576"]])}}]);