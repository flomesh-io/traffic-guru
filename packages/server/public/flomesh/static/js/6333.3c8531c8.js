"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[6333],{60300:function(t,e,a){a.d(e,{Z:function(){return c}});var i=a(66252),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},r=a(33058);function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?Object(arguments[e]):{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter((function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable})))),i.forEach((function(e){s(t,e,a[e])}))}return t}function s(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var o=function(t,e){var a=l({},t,e.attrs);return(0,i.Wm)(r.Z,l({},a,{icon:n}),null)};o.displayName="DatabaseOutlined",o.inheritAttrs=!1;var c=o},16333:function(t,e,a){a.d(e,{Z:function(){return W}});var i=a(66252),n=a(3577);const r={key:0},l={key:1},s={key:0},o=["onClick"];a(57658);var c=a(96486),d=a.n(c),p=a(2692),u=a(60459);const m={class:"full"},h=["onClick"];var v=a(79332);var y=a(87202),g=a(99684),w={name:"CardGroup",components:{DeleteOutlined:y.Z,PlusCircleTwoTone:g.Z},props:["cards","col","fixed"],emits:["add","remove"],data(){return{}},computed:{},watch:{},created(){},methods:{add(){this.$emit("add",{})},remove(t){this.$emit("remove",t)}}},k=a(83744);var f=(0,k.Z)(w,[["render",function(t,e,a,n,r,l){const s=(0,i.up)("a-divider"),o=(0,i.up)("DeleteOutlined"),c=(0,i.up)("PlusCircleTwoTone"),d=(0,i.up)("a-card"),p=(0,i.up)("a-col"),u=(0,i.up)("a-row");return(0,i.wg)(),(0,i.j4)(u,{class:"row-mg"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.cards,((e,n)=>((0,i.wg)(),(0,i.j4)(p,{key:n,class:"col-pd mb-20",xl:24/(a.col||2),lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{title:(0,i.w5)((()=>[(0,i.WI)(t.$slots,"title",{item:e,index:n})])),extra:(0,i.w5)((()=>[(0,i.WI)(t.$slots,"extra",{item:e,index:n}),!a.fixed&&a.cards.length>1?((0,i.wg)(),(0,i.j4)(s,{key:0,type:"vertical"})):(0,i.kq)("",!0),!a.fixed&&a.cards.length>1?((0,i.wg)(),(0,i.j4)(o,{key:1,onClick:t=>l.remove(n),class:"font-20 font-primary icon-menu primary"},null,8,["onClick"])):(0,i.kq)("",!0),a.fixed||a.cards.length-1!=n?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(s,{key:2,type:"vertical"})),a.fixed||a.cards.length-1!=n?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(c,{key:3,onClick:l.add,class:"font-20 font-primary icon-menu primary rotate-icon"},null,8,["onClick"]))])),_:2},1024),(0,i.WI)(t.$slots,"default",{item:e,index:n})])),_:2},1032,["xl"])))),128))])),_:3})}]]),b=a(33907),x=a(60300),$={name:"ServiceImportCard",components:{FormItem:v.Z,CardGroup:f,DatabaseOutlined:x.Z},props:["d"],i18n:a(89234),computed:{...(0,b.rn)("rules",["rules"])},methods:{detail(t,e){this.$router.push({path:`/fsm/service/detail/${e||"default"}/${t}`})}}};var _=(0,k.Z)($,[["render",function(t,e,a,r,l,s){const o=(0,i.up)("a-descriptions-item"),c=(0,i.up)("a-switch"),d=(0,i.up)("a-radio-button"),p=(0,i.up)("a-radio-group"),u=(0,i.up)("a-descriptions"),v=(0,i.up)("DatabaseOutlined"),y=(0,i.up)("a-input-number"),g=(0,i.up)("FormItem"),w=(0,i.up)("CardGroup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(u,{bordered:"",class:"bg-white mb-15"},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{label:t.$t("Namespace"),span:2},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(a.d.registry?.name)+"/"+(0,n.zw)(a.d.namespace),1)])),_:1},8,["label"]),(0,i.Wm)(o,{label:t.$t("Enabled"),span:1},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{class:"relative",style:{top:"-3px"},checked:a.d.policySwitch,"onUpdate:checked":e[0]||(e[0]=t=>a.d.policySwitch=t)},null,8,["checked"])])),_:1},8,["label"]),(0,i.Wm)(o,{label:t.$t("Type"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{value:a.d.content.type,"onUpdate:value":e[1]||(e[1]=t=>a.d.content.type=t)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{value:"Locality"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.$t("Locality")),1)])),_:1}),(0,i.Wm)(d,{value:"FailOver"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.$t("FailOver")),1)])),_:1}),(0,i.Wm)(d,{value:"ActiveActive"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.$t("ActiveActive")),1)])),_:1})])),_:1},8,["value"])])),_:1},8,["label"])])),_:1}),a.d.content&&a.d.content.targets&&a.d.serviceExports?((0,i.wg)(),(0,i.j4)(w,{key:0,fixed:!0,col:3,cards:a.d.serviceExports},{title:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.$t("Export")),1)])),extra:(0,i.w5)((({item:t})=>[(0,i.Wm)(c,{class:"relative",style:{top:"-3px"},checked:a.d.content.targets[t.id].enabled,"onUpdate:checked":e=>a.d.content.targets[t.id].enabled=e},null,8,["checked","onUpdate:checked"])])),default:(0,i.w5)((({item:e})=>[(0,i.Wm)(u,{bordered:"",class:"bg-white"},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{label:t.$t("Namespace"),span:3},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.service.registry?.name)+" / "+(0,n.zw)(e.service.namespace),1)])),_:2},1032,["label"]),a.d.content.targets[e.id]?((0,i.wg)(),(0,i.j4)(o,{key:0,label:t.$t("Service"),span:3},{default:(0,i.w5)((()=>[(0,i._)("div",m,[(0,i.Wm)(v,{class:"font-20 mr-10 primary"}),(0,i._)("a",{class:"pointer relative",style:{top:"-2px"},onClick:t=>s.detail(e.service.id,e.service.namespace)},[(0,i._)("b",null,(0,n.zw)(e.service.name),1)],8,h)])])),_:2},1032,["label"])):(0,i.kq)("",!0),"ActiveActive"==a.d.content.type?((0,i.wg)(),(0,i.j4)(o,{key:1,label:t.$t("Weight"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{name:["content","targets",e.id,"weight"],rules:t.rules.weight},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{value:a.d.content.targets[e.id].weight,"onUpdate:value":t=>a.d.content.targets[e.id].weight=t,min:1},null,8,["value","onUpdate:value"])])),_:2},1032,["name","rules"])])),_:2},1032,["label"])):(0,i.kq)("",!0)])),_:2},1024)])),_:1},8,["cards"])):(0,i.kq)("",!0)],64)}]]);const S=[{key:"Registry",dataIndex:"registry.name"},{key:"Namespace",width:130,dataIndex:"namespace"},{key:"Exports",dataIndex:"serviceExports"},{key:"Policy",dataIndex:"policy"},{key:"Action",width:130,dataIndex:"action"}];var z={name:"ServiceImportList",components:{MoreOutlined:p.Z,EnvSelector:u.Z,ServiceImportCard:_},props:["embed","serviceExport"],i18n:a(89234),data(){return{key:"",syncLoading:-1,pageNo:1,pageSize:10,total:0,columns:S,loading:!0,visible:!1,payload:{content:{type:"Locality",enabled:!0,targets:[{enabled:!0,weight:10},{enabled:!0,weight:20}]},serviceExports:[{service:{name:"service A"}},{service:{name:"service B"}}],registry:{name:"Reg A"},namespace:{name:"NS A"}},list:[]}},computed:{start(){return(this.pageNo-1)*this.pageSize},dataColumns(){return this.columns.filter((t=>"Organization"!=t.key||this.$isPro)).map((t=>(t.title=this.$t(t.key),t)))}},created(){this.search()},methods:{valid(){this.$refs.form.validateFields().then((()=>{this.save()})).catch((()=>{}))},save(){let t=d().cloneDeep(this.payload);t.registry=this.payload.registry.id,t.serviceExports=[],this.payload.serviceExports&&this.payload.serviceExports.forEach((e=>{t.serviceExports.push(e.id)}));let e=t.id;delete t.id,this.$gql.mutation(`updateServiceImport(id:${e}, data: $data){data{id}}`,{data:t},{data:"ServiceImportInput!"}).then((()=>{this.visible=!1,this.search(),this.$message.success(this.$t("Save successfully"),3)}))},edit(t){this.payload=d().cloneDeep(t),this.visible=!0,this.payload.content||(this.payload.content={}),this.payload.content.type||(this.payload.content.type="Locality"),null==this.payload.policySwitch&&(this.payload.policySwitch=!0),this.payload.serviceExports&&(this.payload.content.targets&&"object"==typeOf(this.payload.content.targets)||(this.payload.content.targets={}),this.payload.serviceExports.forEach((t=>{let e=t.id,a=t.service?.registry;this.payload.content.targets[e]||(this.payload.content.targets[e]={registry:a,weight:0,enabled:!1})})))},search(t,e){t&&(this.pageNo=t,this.pageSize=e);let a={start:this.start,limit:this.pageSize};this.loading=!0;let i={};i.name={contains:this.key},this.embed&&(i.serviceExports={id:{eq:this.serviceExport}}),this.$gql.query("serviceImports(filters: $filters, pagination: $pagination){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\tpolicySwitch,\n\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\tserviceExports{data{id,attributes{\n\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\tservice{data{id,attributes{\n\t\t\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t\t\t}}}\n\t\t\t\t\t\t\t}}}\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}",{filters:i,pagination:a},{filters:"ServiceImportFiltersInput",pagination:"PaginationArg"}).then((t=>{this.list=this.reset(t.values),this.total=t.pagination.total,this.loading=!1}))},reset(t){return t||[]}}};var W=(0,k.Z)(z,[["render",function(t,e,a,c,d,p){const u=(0,i.up)("a-input-search"),m=(0,i.up)("a-divider"),h=(0,i.up)("EnvSelector"),v=(0,i.up)("a-tag"),y=(0,i.up)("a-menu-item"),g=(0,i.up)("a-menu"),w=(0,i.up)("MoreOutlined"),k=(0,i.up)("a-dropdown"),f=(0,i.up)("a-table"),b=(0,i.up)("a-card"),x=(0,i.up)("ServiceImportCard"),$=(0,i.up)("a-form"),_=(0,i.up)("a-modal"),S=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(b,{class:"card nopd",loading:d.loading},{title:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.title?t.title:t.$t("Service Imports")),1)])),extra:(0,i.w5)((()=>[a.embed?((0,i.wg)(),(0,i.iD)("div",r,[(0,i.WI)(t.$slots,"extra")])):(0,i.kq)("",!0),t.hasSearch?((0,i.wg)(),(0,i.iD)("div",l,[(0,i.Wm)(u,{value:d.key,"onUpdate:value":e[0]||(e[0]=t=>d.key=t),onSearch:e[1]||(e[1]=t=>p.search()),class:"right-search-input",placeholder:t.$t("search")},null,8,["value","placeholder"]),a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(m,{key:0,type:"vertical"})),a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(h,{key:1}))])):(0,i.kq)("",!0)])),default:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(f,{pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:p.search,onChange:p.search,current:d.pageNo,pageSize:d.pageSize,showTotal:(e,a)=>`${t.$t("Total")} ${e}`,total:d.total},columns:p.dataColumns,"data-source":d.list,class:"bg-white"},{bodyCell:(0,i.w5)((({column:e,record:a})=>["registry.name"===e.dataIndex?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i.Uk)((0,n.zw)(a.registry?.name),1)],64)):"policy"===e.dataIndex?((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[(0,i.Uk)((0,n.zw)(a.content?t.$t(a.content.type):t.$t("unset")),1)],64)):"serviceExports"===e.dataIndex?((0,i.wg)(),(0,i.iD)(i.HY,{key:2},[a.serviceExports?((0,i.wg)(),(0,i.iD)("div",s,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.serviceExports,((t,e)=>((0,i.wg)(),(0,i.j4)(v,{key:e,closable:!1},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t?.service?.registry?.name)+" / "+(0,n.zw)(t?.service?.namespace)+" / "+(0,n.zw)(t?.service?.name),1)])),_:2},1024)))),128))])):(0,i.kq)("",!0)],64)):"action"===e.dataIndex?((0,i.wg)(),(0,i.j4)(k,{key:3},{overlay:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("a",{onClick:t=>p.edit(a)},[(0,i.Uk)((0,n.zw)((a.content&&a.content.type?t.$t("edit"):t.$t("create"))+" "+t.$t("Policy")),1)],8,o)),[[S,["service:update"]]])])),_:2},1024)])),_:2},1024)])),default:(0,i.w5)((()=>[(0,i._)("a",null,[(0,i.Wm)(w)])])),_:2},1024)):(0,i.kq)("",!0)])),_:1},8,["pagination","columns","data-source"])])])),_:3},8,["loading"]),(0,i.Wm)(_,{visible:d.visible,"onUpdate:visible":e[3]||(e[3]=t=>d.visible=t),title:"MCS "+t.$t("Policy"),onOk:p.valid,width:"80%","ok-text":t.$t("Save")},{default:(0,i.w5)((()=>[(0,i.Wm)($,{model:d.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,i.w5)((()=>[(0,i.Wm)(x,{d:d.payload,"onUpdate:d":e[2]||(e[2]=t=>d.payload=t)},null,8,["d"])])),_:1},8,["model"])])),_:1},8,["visible","title","onOk","ok-text"])],64)}]])}}]);