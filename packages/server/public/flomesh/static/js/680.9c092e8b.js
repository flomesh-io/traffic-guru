"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[680],{50128:function(e,t,a){a.d(t,{Z:function(){return o}});var i=a(66252),l=a(3577);const s={class:"mini-chart"},n=["id"];a(57658);var r=a(85263),d={name:"MiniBar",props:["dv","id","axis","height","colors","stack","ver","unit"],data(){return{id2:Math.ceil(1e3*Math.random()),isMounted:!1,simpleImage:r.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,a(33907).rn)("setting",["lang"])},watch:{lang(e){this.$i18n.locale=e},dv(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)},ver(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)}},mounted(){this.isMounted=!0,this.$i18n.locale=this.lang,this.renderChart()},methods:{getLegend(){let e={};return this.dv.forEach((t=>{e[t.type]=t.type})),Object.keys(e)},getXAxis(){let e={};return this.dv.forEach((t=>{e[t.date]=t.date})),Object.keys(e).sort()},getSeriesValue(){let e={};return this.dv.forEach((t=>{e[t.date]||(e[t.date]={}),t.itemStyle?e[t.date][t.type]={value:t.value,itemStyle:t.itemStyle}:e[t.date][t.type]=t.value})),e},getSeries(e,t){let a=this.getSeriesValue(),i=[];return e.forEach((e=>{let l=[];t.forEach((t=>{l.push(a[t][e]||0)}));let s={name:e,type:"bar",smooth:!0,areaStyle:{},emphasis:{focus:"series"},data:l};this.stack&&(s.stack=this.stack),i.push(s)})),i},renderChart(){let e=this.getLegend(),t=this.getXAxis(),a=this.getSeries(e,t),i=document.getElementById(this.id+this.id2);i&&this.$echarts.dispose(i);let l=this.$echarts.init(i);l.showLoading();let s={color:this.colors?this.colors:["rgba(0, 137, 237,0.7)","rgba(255, 157, 77,0.7)","rgba(90, 216, 166,0.7)","rgba(227, 137, 163,0.7)","rgba(146, 112, 202,0.7)"],tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:e,show:!1},toolbox:{},grid:{top:"0px",right:"10px",left:"30px",bottom:"0px"},xAxis:[{axisLabel:{backgroundColor:"rgba(240,240,240,0.7)",padding:[2,3,2,3],textStyle:{color:"#6a7985"},inside:!0,borderRadius:2,minInterval:20},data:t,axisTick:{show:!1},axisLine:{show:!1},z:10}],yAxis:[{show:!!this.axis,type:"value",axisLabel:this.axis?{formatter:e=>""+e+(this.unit?this.unit:"")}:{showMinLabel:!1,showMaxLabel:!1,inside:!0,margin:-30,backgroundColor:"rgba(240,240,240,0.7)",padding:[2,3,2,3],textStyle:{color:"#6a7985"},formatter:e=>""+e+(this.unit?this.unit:"")}}],series:a};l.setOption(s,{lazyUpdate:!0}),l.hideLoading()}}};var o=(0,a(83744).Z)(d,[["render",function(e,t,a,r,d,o){const u=(0,i.up)("a-empty");return(0,i.wg)(),(0,i.iD)("div",s,[a.dv&&0!=a.dv.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(u,{key:0,image:d.simpleImage,description:""},null,8,["image"])),(0,i._)("div",{ref:a.id,class:"chart-content full",id:a.id+d.id2,style:(0,l.j5)({height:a.height?a.height+"px":"100px"})},null,12,n)])}],["__scopeId","data-v-64c489b5"]])},49568:function(e,t,a){a.d(t,{Z:function(){return u}});var i=a(66252),l=a(3577);const s={class:"mini-chart"},n={class:"absolute full mt-10"},r=["id"];a(57658);var d=a(85263),o={name:"MiniSector",props:["dv","noEmpty","id","height","padding","colors","ver"],data(){return{id2:Math.ceil(1e3*Math.random()),isMounted:!1,simpleImage:d.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,a(33907).rn)("setting",["lang"])},watch:{lang(e){this.$i18n.locale=e},dv(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)},ver(){this.isMounted&&setTimeout((()=>{this.renderChart()}),100)}},mounted(){this.isMounted=!0,this.$i18n.locale=this.lang,setTimeout((()=>{this.renderChart()}),100)},methods:{getSeries(){let e=[];return e.push({type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"40",fontWeight:"bold"}},labelLine:{show:!1},data:this.dv}),e},renderChart(){let e=this.getSeries(),t=document.getElementById(this.id+this.id2);t&&this.$echarts.dispose(t);let a=this.$echarts.init(t);a.showLoading();let i={color:this.colors?this.colors:["rgba(0, 137, 237,0.7)","rgba(255, 157, 77,0.7)","rgba(90, 216, 166,0.7)","rgba(227, 137, 163,0.7)","rgba(146, 112, 202,0.7)"],tooltip:{trigger:"item"},legend:{show:!0,orient:"vertical",right:"right",formatter:function(e){return e.length>10?e.substr(0,10)+"...":e}},toolbox:{},grid:{left:this.padding?this.padding[3]:0,right:this.padding?this.padding[1]:0,bottom:this.padding?this.padding[2]:0,top:this.padding?this.padding[0]:0,containLabel:!0},series:e};a.setOption(i,{lazyUpdate:!0}),a.hideLoading()}}};var u=(0,a(83744).Z)(o,[["render",function(e,t,a,d,o,u){const h=(0,i.up)("a-empty");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("div",n,[a.dv&&0!=a.dv.length||a.noEmpty?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(h,{key:0,image:o.simpleImage,description:""},null,8,["image"]))]),(0,i._)("div",{ref:a.id,class:"chart-content full",id:a.id+o.id2,style:(0,l.j5)({height:a.height?a.height+"px":"200px"})},null,12,r)])}],["__scopeId","data-v-51a6e4be"]])},1299:function(e,t,a){a.d(t,{Z:function(){return r}});var i=a(66252),l=a(3577);const s={key:0,class:"title"};var n={name:"DetailList",props:{title:{type:String,required:!1,default:""},col:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"large"},layout:{type:String,required:!1,default:"horizontal"}}};var r=(0,a(83744).Z)(n,[["render",function(e,t,a,n,r,d){const o=(0,i.up)("a-row");return(0,i.wg)(),(0,i.iD)("div",{class:(0,l.C_)(["detail-list","small"===a.size?"small":"large","vertical"===a.layout?"vertical":"horizontal"]),style:(0,l.j5)("flex-"+a.col)},[a.title?((0,i.wg)(),(0,i.iD)("div",s,(0,l.zw)(a.title),1)):(0,i.kq)("",!0),(0,i.Wm)(o,null,{default:(0,i.w5)((()=>[(0,i.WI)(e.$slots,"default")])),_:3})],6)}]])},13589:function(e,t,a){a.d(t,{Z:function(){return d}});var i=a(66252),l=a(3577);const s={class:"detail-content"};const n={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}};var r={name:"DetailListItem",i18n:a(39945),props:{name:{type:String,required:!1,default:""},rules:{type:Array,required:!1,default(){return[]}},term:{type:String,required:!1,default:""},termTop:{type:Boolean}},data(){return{col:2,responsive:n}},computed:{getRules(){return this.rules.map((e=>(e.message=this.$t(e.message),e))),this.rules}},created(){this.$parent&&this.$parent.$parent&&this.$parent.$parent.col>0&&(this.col=this.$parent.$parent.col)},methods:{}};var d=(0,a(83744).Z)(r,[["render",function(e,t,a,n,r,d){const o=(0,i.up)("a-form-item"),u=(0,i.up)("a-col");return(0,i.wg)(),(0,i.j4)(u,(0,i.dG)({class:"detail-list-content flex"},r.responsive[r.col]),{default:(0,i.w5)((()=>[(0,i._)("div",{class:(0,l.C_)(a.termTop?"term top":"term")},(0,l.zw)(a.term),3),(0,i._)("div",s,[a.rules?((0,i.wg)(),(0,i.j4)(o,{key:0,name:a.name,rules:d.getRules},{default:(0,i.w5)((()=>[(0,i.WI)(e.$slots,"default")])),_:3},8,["name","rules"])):(0,i.WI)(e.$slots,"default",{key:1})])])),_:3},16)}]])},54721:function(e,t,a){a.d(t,{Z:function(){return L}});var i=a(66252),l=a(3577);const s={key:0},n={key:1,class:"gray"},r={key:0},d={key:1,class:"gray"},o={class:"font-s gray"};a(57658);var u=a(96486),h=a.n(u),p=a(84471),c=a(26917),m=a(61103),g=a(1299),b=a(33907),v=a(50976),f=a(49702),y=a(72167),w=a(13589),$=a(84722),_={name:"Lb7Detail",i18n:a(89234),components:{DetailListItem:w.Z,DetailList:g.Z,PageLayout:m.Z,AutoForm:v.Z,LogViewer:f.Z},props:["embed","name","rid"],data(){return{type:"7 Load Balancer",initMapping:[{label:"Load Balancing",fields:[[{label:"Algorithm",value:""},{label:"Hash On",value:"None"}]]},{label:"Targets",fields:[[{label:"Discovery Name",value:""}],[{label:"Target Hosts",value:""}]]},{label:"Active Healthcheck",fields:[[{label:"Type",value:"HTTP"},{label:"HTTPS Verify Certificate",value:"Yes"},{label:"Concurrency",value:10}],[{label:"Timeout",value:1},{label:"HTTPS SNI",value:""},{label:"HTTPS Path",value:"/"}]]},{label:"Active Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","302"]}],[{label:"Interval",value:0},{label:"Successes",value:0}]]},{label:"Active Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","429","500","501","502","503","504","505"]}],[{label:"Interval",value:0},{label:"Timeouts",value:0}],[{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]},{label:"Passive Healthcheck",fields:[[{label:"Type",value:"HTTP"}]]},{label:"Passive Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","201","202","203","204","205","206","300"]}],[{label:"Successes",value:0}]]},{label:"Passive Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","500","503"]}],[{label:"Timeouts",value:0},{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]}],visible:!1,detail:{content:{mapping:[],bps_limit:null,tps_limit:null,port:8e3,paths:""},profile:{id:null},L7Cluster:{id:null},name:""},loading:!0,logloading:!0,logs:[],log:"{}",pid:"",filter:"",params:{pageNo:1,pageSize:10,total:0},profiles:[],clusters:[],tps:[],tpsCnt:0,activeTabKey:"2"}},computed:{...(0,b.rn)("setting",["isMobile"])},created(){this.pid=this.rid||"",""!=this.pid?(this.loading=!0,this.$gql.query(`l7Lb(id: ${this.pid}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tL7Cluster{data{id,attributes{name}}},\n\t\t\t\t\t\tprofile{data{id,attributes{name}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}`).then((e=>{let t=e.data;t.content.mapping=(0,$.kL)(this.initMapping,t.content.mapping),this.loading=!1,this.detail=t,this.getData()}))):(this.detail={profile:{id:null},L7Cluster:{id:null},content:{mapping:this.initMapping,port:80,bps_limit:null,tps_limit:null,paths:""},name:""},this.loading=!1),this.embed&&(this.detail.name=this.name),this.$gql.query("l7Clusters{data{id,attributes{name}}}").then((e=>{this.clusters=e.data})),this.$gql.query("profiles{data{id,attributes{name}}}").then((e=>{this.profiles=e.data})),""!=this.pid&&(0,c.ap)(this.pid).then((0,p.hw)(((e,t)=>{let a=(0,c.tl)(e);this.tpsCnt=t.data,this.tps=[],a.forEach((e=>{let t={type:"7lb"};t.value=e[0],t.date=(0,y.Z)(new Date(e[1]),"yyyy-MM-dd HH:mm"),this.tps.push(t)}))}))).catch((e=>{}))},methods:{onTabChange(e){},valid(){return""==this.detail.name&&""==this.name?(this.$message.error(this.$t("The name cannot be empty"),3),!1):this.detail.L7Cluster.id?!!this.detail.profile.id||(this.$message.error("Profile cannot be empty",3),!1):(this.$message.error("The cluster cannot be empty",3),!1)},save(e){if(!this.valid())return;let t=h().cloneDeep(this.detail);t.content.mapping=h().cloneDeep(this.detail.content.mapping),t.content.port=8e3,t.content.bps_limit=1*t.content.bps_limit,t.content.tps_limit=1*t.content.tps_limit,t.content.is_gateway=!!this.embed,t.L7Cluster=t.L7Cluster.id,t.profile=t.profile.id,e&&(t.registry=e,t.name=this.name+" 4LB"),t.content.targets||(t.content.targets="[]"),delete t.id,""!=this.pid?this.$gql.mutation(`updateL7Lb(id:${this.pid}, data: $data){data{id}}`,{data:t},{data:"L7LbInput!"}).then((()=>{this.embed?this.$emit("saved",e):(this.$message.success(this.$t("Save successfully"),3),this.$closePage(this.$route))})):this.$gql.mutation("createL7Lb(data: $data){data{id}}",{data:t},{data:"L7LbInput!"}).then((t=>{this.embed?this.$emit("saved",e):(this.pid=t.data.id,this.$message.success(this.$t("Created successfully"),3),this.$closePage(this.$route))}))},handleChange(){},hide(){this.visible=!1},joinPath(e){let t="";return e?(e.map(((e,a)=>(a>0&&(t+="\n"),t+=e.host+e.path,e))),t):t},splitPath(e){let t=[],a=e.split("\n");return t?(a.map((e=>{let a=e.replace("http://","http:||").replace("https://","https:||").split("/"),i=a.shift();return i=i.replace("http:||","http://").replace("https:||","https://"),t.push({host:i,path:"/"+a.join("/")}),e})),t):e},getData(e,t){e&&(this.params.pageNo=e,this.params.pageSize=t),this.logloading=!0,this.data=[],this.filter=`iid = '${this.pid}'`,(0,c.hT)(this.params.pageNo,this.params.pageSize,this.filter,"timestamp","desc").then((0,p.hw)(((e,t)=>{this.logloading=!1,this.params.total=1*e.data,this.logs=(0,c.OI)(t)}))).catch((e=>{}))}}};var L=(0,a(83744).Z)(_,[["render",function(e,t,a,u,h,p){const c=(0,i.up)("a-input"),m=(0,i.up)("DetailListItem"),g=(0,i.up)("a-select-option"),b=(0,i.up)("a-select"),v=(0,i.up)("a-textarea"),f=(0,i.up)("DetailList"),y=(0,i.up)("a-button"),w=(0,i.up)("AutoForm"),$=(0,i.up)("a-card"),_=(0,i.up)("a-tab-pane"),L=(0,i.up)("LogViewer"),k=(0,i.up)("a-tabs"),T=(0,i.up)("a-col"),C=(0,i.up)("a-row"),S=(0,i.up)("PageLayout");return(0,i.wg)(),(0,i.j4)(S,{"hide-breadcrumb":a.embed,title:a.embed?" ":h.detail.name?h.detail.name:e.$t("new")+" 7LB"},(0,i.Nv)({headerContent:(0,i.w5)((()=>[(0,i.Wm)(f,{size:"small",col:2},{default:(0,i.w5)((()=>[a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(m,{key:0,term:e.$t("as")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{placeholder:e.$t("unset"),value:h.detail.name,"onUpdate:value":t[0]||(t[0]=e=>h.detail.name=e),class:"width-200"},null,8,["placeholder","value"])])),_:1},8,["term"])),(0,i.Wm)(m,{term:e.$t("port")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{type:"number",disabled:"",placeholder:e.$t("unset"),value:h.detail.content.port,"onUpdate:value":t[1]||(t[1]=e=>h.detail.content.port=e),class:"width-100"},null,8,["placeholder","value"])])),_:1},8,["term"]),(0,i.Wm)(m,{term:e.$t("profile")},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{placeholder:e.$t("unallocated"),class:"width-200",value:h.detail.profile.id,"onUpdate:value":t[2]||(t[2]=e=>h.detail.profile.id=e),onChange:t[3]||(t[3]=e=>p.handleChange())},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.profiles,((e,t)=>((0,i.wg)(),(0,i.j4)(g,{key:t,value:e.id},{default:(0,i.w5)((()=>[e.id?((0,i.wg)(),(0,i.iD)("span",s,(0,l.zw)(e.name),1)):(0,i.kq)("",!0),e.id?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",n,(0,l.zw)(e.name),1))])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term"]),(0,i.Wm)(m,{term:e.$t("cluster")},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{placeholder:e.$t("unallocated"),class:"width-200",value:h.detail.L7Cluster.id,"onUpdate:value":t[4]||(t[4]=e=>h.detail.L7Cluster.id=e),onChange:t[5]||(t[5]=e=>p.handleChange())},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.clusters,((e,t)=>((0,i.wg)(),(0,i.j4)(g,{key:t,value:e.id},{default:(0,i.w5)((()=>[e.id?((0,i.wg)(),(0,i.iD)("span",r,(0,l.zw)(e.name),1)):(0,i.kq)("",!0),e.id?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",d,(0,l.zw)(e.name),1))])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term"]),(0,i.Wm)(m,{term:e.$t("bindwidth")+" (Mb)"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{value:h.detail.content.bps_limit,"onUpdate:value":t[6]||(t[6]=e=>h.detail.content.bps_limit=e),type:"number",placeholder:e.$t("unset"),class:"width-100"},null,8,["value","placeholder"])])),_:1},8,["term"]),(0,i.Wm)(m,{term:e.$t("tps2")},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{type:"number",value:h.detail.content.tps_limit,"onUpdate:value":t[7]||(t[7]=e=>h.detail.content.tps_limit=e),placeholder:e.$t("unset"),class:"width-100"},null,8,["value","placeholder"])])),_:1},8,["term"]),(0,i.Wm)(m,{term:e.$t("paths"),"term-top":!0},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{value:h.detail.content.paths,"onUpdate:value":t[8]||(t[8]=e=>h.detail.content.paths=e),placeholder:e.$t("unset"),rows:4},null,8,["value","placeholder"]),(0,i._)("div",o,(0,l.zw)(e.$t("List of host:path")),1)])),_:1},8,["term"])])),_:1})])),action:(0,i.w5)((()=>[a.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(y,{key:0,type:"primary",onClick:t[9]||(t[9]=e=>p.save())},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(""!=h.pid?e.$t("save"):e.$t("create")),1)])),_:1}))])),default:(0,i.w5)((()=>[(0,i.Wm)(C,{class:"row-mg"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{type:"card"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{key:"1",tab:e.$t("config")},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.detail.content.mapping,((t,a)=>((0,i.wg)(),(0,i.j4)($,{key:a,class:"card mb-24",title:e.$t(t.label),bordered:!1,loading:h.loading},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{fields:t.fields},null,8,["fields"])])),_:2},1032,["title","loading"])))),128))])),_:1},8,["tab"]),""!=h.pid?((0,i.wg)(),(0,i.j4)(_,{key:"11",tab:e.$t("log")},{default:(0,i.w5)((()=>[(0,i.Wm)(L,{uid:h.pid,type:"7lb"},null,8,["uid"])])),_:1},8,["tab"])):(0,i.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:2},[""==h.pid||a.embed?void 0:{name:"extra",fn:(0,i.w5)((()=>[])),key:"0"}]),1032,["hide-breadcrumb","title"])}]])},34596:function(e,t,a){a.r(t),a.d(t,{default:function(){return s}});var i=a(66252);var l={name:"Detail",components:{Lb7Detail:a(54721).Z},data(){return{rid:""}},created(){this.rid=this.$route.params.id||""}};var s=(0,a(83744).Z)(l,[["render",function(e,t,a,l,s,n){const r=(0,i.up)("Lb7Detail");return(0,i.wg)(),(0,i.j4)(r,{rid:s.rid},null,8,["rid"])}]])}}]);