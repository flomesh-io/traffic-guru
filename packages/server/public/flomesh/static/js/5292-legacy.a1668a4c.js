"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[5292],{23235:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _Users_zhangcheng_Desktop_work_flomesh_gui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(95082),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(92222),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(57327),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(41539),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(21249),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(57658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_5__),lodash__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(96486),lodash__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_6__),_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(71153),_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(13471),vuex__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(33907),_layouts_PageLayout__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(61103);__webpack_exports__.Z={name:"NetworkView",i18n:__webpack_require__(89234),components:{PageLayout:_layouts_PageLayout__WEBPACK_IMPORTED_MODULE_7__.Z,NodeIndexOutlined:_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_8__.Z,FieldTimeOutlined:_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_9__.Z},data:function(){return{date:"",endDate:"",filter:"",loading:!0,params:{pageNo:1,pageSize:10,total:0},data:[]}},computed:(0,_Users_zhangcheng_Desktop_work_flomesh_gui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({},(0,vuex__WEBPACK_IMPORTED_MODULE_10__.rn)("setting",["layout","pageWidth"])),created:function(){this.getData()},methods:{getSqlPagging:function(e){return"SELECT traceid,cnt,duration,minReqTime,maxResTime,serviceName,podName FROM ( ".concat(e," ) ORDER BY minReqTime DESC LIMIT ").concat((this.params.pageNo-1)*this.params.pageSize,",").concat(this.params.pageSize,";")},getWhere:function(){var e="where 1=1 ";return this.filter&&""!=this.filter&&(e+=" AND (trace.id = '".concat(this.filter,"' or service.name = '").concat(this.filter,"' or pod.name = '").concat(this.filter,"' or pod.ip = '").concat(this.filter,"') ")),this.date&&""!=this.date&&(e+=" AND reqTime > "+new Date(this.date).getTime()),this.endDate&&""!=this.endDate&&(e+=" AND reqTime < "+new Date(this.endDate).getTime()),e},getCount:function(e){var _=this,a="select count(1) as cnt from (select 1 from log ".concat(e," group by trace.id)");this.$request(this.$REST.CLICKHOUSE.QUERY(a),this.$METHOD.GET).then((function(e){_.params.total=1*e.data})).catch((function(e){}))},getData:function getData(pageNo,pageSize){var _this2=this;pageNo&&(this.params.pageNo=pageNo,this.params.pageSize=pageSize);var whereSQL=this.getWhere();this.getCount(whereSQL),this.data=[],this.loading=!0;var SQL=this.getSqlPagging("select trace.id as traceid,count() as cnt,(max(resTime) - min(reqTime)) as duration,min(reqTime) as minReqTime,max(resTime) as maxResTime,groupUniqArray(service.name) as serviceName,groupUniqArray(pod.name) as podName from log ".concat(whereSQL," group by trace.id"));this.$request(this.$REST.CLICKHOUSE.QUERY(SQL),this.$METHOD.GET).then((function(res){_this2.loading=!1;var nodes=res.data.split("\n");nodes.map((function(nodeStr){var node=nodeStr.split("\t"),item={traceId:node[0],spancnt:node[1],duration:node[2],start:node[3],end:node[4],service:lodash__WEBPACK_IMPORTED_MODULE_6___default().uniq(eval(node[5])),pod:lodash__WEBPACK_IMPORTED_MODULE_6___default().uniq(eval(node[6]))};return""!=node[0]&&_this2.data.push(item),nodeStr}))})).catch((function(e){}))},detail:function(e){this.$router.push({path:"/fsm/waterfall/detail/"+e})}}}},35292:function(e,_,a){a.r(_),a.d(_,{default:function(){return E}});a(57327),a(41539),a(92222);var t=a(66252),n=a(3577),r=function(e){return(0,t.dD)("data-v-6639f4bc"),e=e(),(0,t.Cn)(),e},o={class:"search-input"},i={class:"form-row"},s={class:"label"},u={class:"content"},c=r((function(){return(0,t._)("em",{class:"em"}," ~ ",-1)})),l=["onClick"],d=r((function(){return(0,t._)("div",{class:"content"},null,-1)})),p=r((function(){return(0,t._)("em",null," ~ ",-1)}));var m=a(23235);var E=(0,a(83744).Z)(m.Z,[["render",function(e,_,a,r,m,E){var h=(0,t.up)("a-input-search"),D=(0,t.up)("a-date-picker"),f=(0,t.up)("a-form"),g=(0,t.up)("a-card"),w=(0,t.up)("a-typography-paragraph"),O=(0,t.up)("a-tag"),M=(0,t.up)("a-list-item-meta"),P=(0,t.up)("NodeIndexOutlined"),T=(0,t.up)("FieldTimeOutlined"),C=(0,t.up)("a-list-item"),v=(0,t.up)("a-list"),U=(0,t.up)("PageLayout");return(0,t.wg)(),(0,t.j4)(U,{title:e.$t("Waterfall")},{headerContent:(0,t.w5)((function(){return[(0,t._)("div",{class:(0,n.C_)(["search-head",e.layout,e.pageWidth])},[(0,t._)("div",o,[(0,t.Wm)(h,{class:"search-ipt",value:m.filter,"onUpdate:value":_[0]||(_[0]=function(e){return m.filter=e}),onSearch:_[1]||(_[1]=function(e){return E.getData()}),loading:m.loading,placeholder:e.$t("Please input")+":"+e.$t("Trace / Service / Pod"),size:"large"},null,8,["value","loading","placeholder"])]),(0,t.Wm)(g,{bordered:!1,class:"search-form"},{default:(0,t.w5)((function(){return[(0,t.Wm)(f,null,{default:(0,t.w5)((function(){return[(0,t._)("div",i,[(0,t._)("div",s,[(0,t._)("span",null,(0,n.zw)(e.$t("Time screening")),1)]),(0,t._)("div",u,[(0,t.Wm)(D,{value:m.date,"onUpdate:value":_[2]||(_[2]=function(e){return m.date=e}),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:e.$t("Start Date"),onChange:_[3]||(_[3]=function(e){return E.getData()})},null,8,["value","placeholder"]),c,(0,t.Wm)(D,{value:m.endDate,"onUpdate:value":_[4]||(_[4]=function(e){return m.endDate=e}),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:e.$t("End Date"),onChange:_[5]||(_[5]=function(e){return E.getData()})},null,8,["value","placeholder"])])])]})),_:1})]})),_:1})],2)]})),default:(0,t.w5)((function(){return[(0,t.Wm)(g,{class:"search-content",loading:m.loading},{default:(0,t.w5)((function(){return[(0,t.Wm)(v,{"item-layout":"vertical",pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:E.getData,onChange:E.getData,current:m.params.pageNo,pageSize:m.params.pageSize,showTotal:function(_,a){return"".concat(e.$t("Total")," ").concat(_)},total:m.params.total}},{default:(0,t.w5)((function(){return[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(m.data,(function(_,a){return(0,t.wg)(),(0,t.j4)(C,{key:a},{actions:(0,t.w5)((function(){return[(0,t._)("span",null,[(0,t.Wm)(P),(0,t.Uk)(" "+(0,n.zw)(_.spancnt)+" "+(0,n.zw)(e.$t("unitci")),1)]),(0,t._)("span",null,[(0,t.Wm)(T),(0,t.Uk)(" "+(0,n.zw)(_.duration)+" ms",1)]),(0,t._)("span",null,[(0,t._)("em",null,(0,n.zw)(new Date(1*_.start).toLocaleString()),1),p,(0,t._)("em",null,(0,n.zw)(new Date(1*_.end).toLocaleString()),1)])]})),default:(0,t.w5)((function(){return[(0,t.Wm)(M,null,{title:(0,t.w5)((function(){return[(0,t.Uk)(" Trace :  "),(0,t.Wm)(w,{class:"search-content-meta",copyable:{tooltips:!1}},{default:(0,t.w5)((function(){return[(0,t._)("a",{href:"javascript:void(0)",onClick:function(e){return E.detail(_.traceId)}},(0,n.zw)(_.traceId),9,l)]})),_:2},1024)]})),description:(0,t.w5)((function(){return[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(_.service,(function(e,_){return(0,t.wg)(),(0,t.j4)(O,{key:_},{default:(0,t.w5)((function(){return[(0,t.Uk)((0,n.zw)(e),1)]})),_:2},1024)})),128)),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(_.pod,(function(e,_){return(0,t.wg)(),(0,t.j4)(O,{key:_},{default:(0,t.w5)((function(){return[(0,t.Uk)((0,n.zw)(e),1)]})),_:2},1024)})),128))]})),_:2},1024),d]})),_:2},1024)})),128))]})),_:1},8,["pagination"])]})),_:1},8,["loading"])]})),_:1},8,["title"])}],["__scopeId","data-v-6639f4bc"]])}}]);