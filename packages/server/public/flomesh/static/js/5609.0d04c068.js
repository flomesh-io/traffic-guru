"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[5609],{54721:function(e,t,a){a.d(t,{Z:function(){return _}});var l=a(66252),i=a(3577);const s={key:0},n={key:1,class:"gray"},d={key:0},o={key:1,class:"gray"},u={class:"font-s gray"};a(57658);var r=a(96486),p=a.n(r),c=a(84471),h=a(26917),m=a(61103),g=a(1299),b=a(33907),v=a(50976),f=a(49702),w=a(72167),y=a(13589),$=a(84722),k={name:"Lb7Detail",i18n:a(89234),components:{DetailListItem:y.Z,DetailList:g.Z,PageLayout:m.Z,AutoForm:v.Z,LogViewer:f.Z},props:["embed","name","rid"],data(){return{type:"7 Load Balancer",initMapping:[{label:"Load Balancing",fields:[[{label:"Algorithm",value:""},{label:"Hash On",value:"None"}]]},{label:"Targets",fields:[[{label:"Discovery Name",value:""}],[{label:"Target Hosts",value:""}]]},{label:"Active Healthcheck",fields:[[{label:"Type",value:"HTTP"},{label:"HTTPS Verify Certificate",value:"Yes"},{label:"Concurrency",value:10}],[{label:"Timeout",value:1},{label:"HTTPS SNI",value:""},{label:"HTTPS Path",value:"/"}]]},{label:"Active Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","302"]}],[{label:"Interval",value:0},{label:"Successes",value:0}]]},{label:"Active Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","429","500","501","502","503","504","505"]}],[{label:"Interval",value:0},{label:"Timeouts",value:0}],[{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]},{label:"Passive Healthcheck",fields:[[{label:"Type",value:"HTTP"}]]},{label:"Passive Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","201","202","203","204","205","206","300"]}],[{label:"Successes",value:0}]]},{label:"Passive Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","500","503"]}],[{label:"Timeouts",value:0},{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]}],visible:!1,detail:{content:{mapping:[],bps_limit:null,tps_limit:null,port:8e3,paths:""},profile:{id:null},L7Cluster:{id:null},name:""},loading:!0,logloading:!0,logs:[],log:"{}",pid:"",filter:"",params:{pageNo:1,pageSize:10,total:0},profiles:[],clusters:[],tps:[],tpsCnt:0,activeTabKey:"2"}},computed:{...(0,b.rn)("setting",["isMobile"])},created(){this.pid=this.rid||"",""!=this.pid?(this.loading=!0,this.$gql.query(`l7Lb(id: ${this.pid}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tL7Cluster{data{id,attributes{name}}},\n\t\t\t\t\t\tprofile{data{id,attributes{name}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}`).then((e=>{let t=e.data;t.content.mapping=(0,$.kL)(this.initMapping,t.content.mapping),this.loading=!1,this.detail=t,this.getData()}))):(this.detail={profile:{id:null},L7Cluster:{id:null},content:{mapping:this.initMapping,port:80,bps_limit:null,tps_limit:null,paths:""},name:""},this.loading=!1),this.embed&&(this.detail.name=this.name),this.$gql.query("l7Clusters{data{id,attributes{name}}}").then((e=>{this.clusters=e.data})),this.$gql.query("profiles{data{id,attributes{name}}}").then((e=>{this.profiles=e.data})),""!=this.pid&&(0,h.ap)(this.pid).then((0,c.hw)(((e,t)=>{let a=(0,h.tl)(e);this.tpsCnt=t.data,this.tps=[],a.forEach((e=>{let t={type:"7lb"};t.value=e[0],t.date=(0,w.Z)(new Date(e[1]),"yyyy-MM-dd HH:mm"),this.tps.push(t)}))}))).catch((e=>{}))},methods:{onTabChange(e){},valid(){return""==this.detail.name&&""==this.name?(this.$message.error(this.$t("The name cannot be empty"),3),!1):this.detail.L7Cluster.id?!!this.detail.profile.id||(this.$message.error("Profile cannot be empty",3),!1):(this.$message.error("The cluster cannot be empty",3),!1)},save(e){if(!this.valid())return;let t=p().cloneDeep(this.detail);t.content.mapping=p().cloneDeep(this.detail.content.mapping),t.content.port=8e3,t.content.bps_limit=1*t.content.bps_limit,t.content.tps_limit=1*t.content.tps_limit,t.content.is_gateway=!!this.embed,t.L7Cluster=t.L7Cluster.id,t.profile=t.profile.id,e&&(t.registry=e,t.name=this.name+" 4LB"),t.content.targets||(t.content.targets="[]"),delete t.id,""!=this.pid?this.$gql.mutation(`updateL7Lb(id:${this.pid}, data: $data){data{id}}`,{data:t},{data:"L7LbInput!"}).then((()=>{this.embed?this.$emit("saved",e):(this.$message.success(this.$t("Save successfully"),3),this.$closePage(this.$route))})):this.$gql.mutation("createL7Lb(data: $data){data{id}}",{data:t},{data:"L7LbInput!"}).then((t=>{this.embed?this.$emit("saved",e):(this.pid=t.data.id,this.$message.success(this.$t("Created successfully"),3),this.$closePage(this.$route))}))},handleChange(){},hide(){this.visible=!1},joinPath(e){let t="";return e?(e.map(((e,a)=>(a>0&&(t+="\n"),t+=e.host+e.path,e))),t):t},splitPath(e){let t=[],a=e.split("\n");return t?(a.map((e=>{let a=e.replace("http://","http:||").replace("https://","https:||").split("/"),l=a.shift();return l=l.replace("http:||","http://").replace("https:||","https://"),t.push({host:l,path:"/"+a.join("/")}),e})),t):e},getData(e,t){e&&(this.params.pageNo=e,this.params.pageSize=t),this.logloading=!0,this.data=[],this.filter=`iid = '${this.pid}'`,(0,h.hT)(this.params.pageNo,this.params.pageSize,this.filter,"timestamp","desc").then((0,c.hw)(((e,t)=>{this.logloading=!1,this.params.total=1*e.data,this.logs=(0,h.OI)(t)}))).catch((e=>{}))}}};var _=(0,a(83744).Z)(k,[["render",function(e,t,a,r,p,c){const h=(0,l.up)("a-input"),m=(0,l.up)("DetailListItem"),g=(0,l.up)("a-select-option"),b=(0,l.up)("a-select"),v=(0,l.up)("a-textarea"),f=(0,l.up)("DetailList"),w=(0,l.up)("a-button"),y=(0,l.up)("AutoForm"),$=(0,l.up)("a-card"),k=(0,l.up)("a-tab-pane"),_=(0,l.up)("LogViewer"),C=(0,l.up)("a-tabs"),L=(0,l.up)("a-col"),T=(0,l.up)("a-row"),D=(0,l.up)("PageLayout");return(0,l.wg)(),(0,l.j4)(D,{"hide-breadcrumb":a.embed,title:a.embed?" ":p.detail.name?p.detail.name:e.$t("new")+" 7LB"},(0,l.Nv)({headerContent:(0,l.w5)((()=>[(0,l.Wm)(f,{size:"small",col:2},{default:(0,l.w5)((()=>[a.embed?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(m,{key:0,term:e.$t("as")},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{placeholder:e.$t("unset"),value:p.detail.name,"onUpdate:value":t[0]||(t[0]=e=>p.detail.name=e),class:"width-200"},null,8,["placeholder","value"])])),_:1},8,["term"])),(0,l.Wm)(m,{term:e.$t("port")},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{type:"number",disabled:"",placeholder:e.$t("unset"),value:p.detail.content.port,"onUpdate:value":t[1]||(t[1]=e=>p.detail.content.port=e),class:"width-100"},null,8,["placeholder","value"])])),_:1},8,["term"]),(0,l.Wm)(m,{term:e.$t("profile")},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{placeholder:e.$t("unallocated"),class:"width-200",value:p.detail.profile.id,"onUpdate:value":t[2]||(t[2]=e=>p.detail.profile.id=e),onChange:t[3]||(t[3]=e=>c.handleChange())},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.profiles,((e,t)=>((0,l.wg)(),(0,l.j4)(g,{key:t,value:e.id},{default:(0,l.w5)((()=>[e.id?((0,l.wg)(),(0,l.iD)("span",s,(0,i.zw)(e.name),1)):(0,l.kq)("",!0),e.id?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("i",n,(0,i.zw)(e.name),1))])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term"]),(0,l.Wm)(m,{term:e.$t("cluster")},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{placeholder:e.$t("unallocated"),class:"width-200",value:p.detail.L7Cluster.id,"onUpdate:value":t[4]||(t[4]=e=>p.detail.L7Cluster.id=e),onChange:t[5]||(t[5]=e=>c.handleChange())},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.clusters,((e,t)=>((0,l.wg)(),(0,l.j4)(g,{key:t,value:e.id},{default:(0,l.w5)((()=>[e.id?((0,l.wg)(),(0,l.iD)("span",d,(0,i.zw)(e.name),1)):(0,l.kq)("",!0),e.id?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("i",o,(0,i.zw)(e.name),1))])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"])])),_:1},8,["term"]),(0,l.Wm)(m,{term:e.$t("bindwidth")+" (Mb)"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{value:p.detail.content.bps_limit,"onUpdate:value":t[6]||(t[6]=e=>p.detail.content.bps_limit=e),type:"number",placeholder:e.$t("unset"),class:"width-100"},null,8,["value","placeholder"])])),_:1},8,["term"]),(0,l.Wm)(m,{term:e.$t("tps2")},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{type:"number",value:p.detail.content.tps_limit,"onUpdate:value":t[7]||(t[7]=e=>p.detail.content.tps_limit=e),placeholder:e.$t("unset"),class:"width-100"},null,8,["value","placeholder"])])),_:1},8,["term"]),(0,l.Wm)(m,{term:e.$t("paths"),"term-top":!0},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{value:p.detail.content.paths,"onUpdate:value":t[8]||(t[8]=e=>p.detail.content.paths=e),placeholder:e.$t("unset"),rows:4},null,8,["value","placeholder"]),(0,l._)("div",u,(0,i.zw)(e.$t("List of host:path")),1)])),_:1},8,["term"])])),_:1})])),action:(0,l.w5)((()=>[a.embed?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(w,{key:0,type:"primary",onClick:t[9]||(t[9]=e=>c.save())},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(""!=p.pid?e.$t("save"):e.$t("create")),1)])),_:1}))])),default:(0,l.w5)((()=>[(0,l.Wm)(T,{class:"row-mg"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{type:"card"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{key:"1",tab:e.$t("config")},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.detail.content.mapping,((t,a)=>((0,l.wg)(),(0,l.j4)($,{key:a,class:"card mb-24",title:e.$t(t.label),bordered:!1,loading:p.loading},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{fields:t.fields},null,8,["fields"])])),_:2},1032,["title","loading"])))),128))])),_:1},8,["tab"]),""!=p.pid?((0,l.wg)(),(0,l.j4)(k,{key:"11",tab:e.$t("log")},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{uid:p.pid,type:"7lb"},null,8,["uid"])])),_:1},8,["tab"])):(0,l.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:2},[""==p.pid||a.embed?void 0:{name:"extra",fn:(0,l.w5)((()=>[])),key:"0"}]),1032,["hide-breadcrumb","title"])}]])},72744:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var l=a(66252),i=a(3577),s=a(87932);const n=(e=>((0,l.dD)("data-v-13190fca"),e=e(),(0,l.Cn)(),e))((()=>(0,l._)("img",{src:s,style:{width:"200px"}},null,-1)));a(57658);var d=a(9294),o=a(93327),u=a(33907),r=a(54721),p=a(48025),c=a(13554),h={name:"RegistryDetail",i18n:a(89234),components:{JsEditor:d.Z,ServiceList:c.Z,Lb7Detail:r.Z,Lb4Detail:p.Z,RegistryBaseDetail:o.Z},data(){return{selectedKeys:"",selectedNS:[],namespaces:[],detail:{organization:null,type:"k8s",name:"",content:{domain:"",credit:"",autoUpstream:!1,autoApplication:!1,isGateway:!0,gatewayPath:"",gatewayPort:0},address:""},types:[{name:"eureka"},{name:"nacos"},{name:"zookeeper"},{name:"k8s"},{name:"consul"}],orgs:[],pjsConfig:"",pid:"",json:'{ "":"" }',config:"",noTitleKey:""}},computed:{...(0,u.rn)("setting",["isMobile"]),namespaceTabs(){let e=[];return this.namespaces.forEach((t=>{e.push({key:t.id,tab:t.name,services:t.services.length})})),e}},created(){this.$gql.query("organizations{data{id,attributes{name}}}").then((e=>{this.orgs=e.data})),this.pid=this.$route.params.id||""},methods:{enabledChange(e){this.$gql.mutation(`updateServiceSync(id: ${e.id}, data: $data){data{id}}`,{data:{deleted:!e.enabled}},{data:"ServiceInput!"}).then((()=>{this.$message.success(this.$t("Save successfully"),3)}))},getDetail(e){this.detail=e.detail,this.namespaces=e.namespaces,this.selectedKeys=e.selectedKeys,this.selectedNS=e.selectedNS||[]},selectNS(e){this.selectedNS={services:[]},this.detail.namespaces.forEach((t=>{t.id==e&&(this.selectedNS=t)}))},save7lb(e){this.$refs.Lb7Detail.save(e)},assignOrganization(){this.$gql.mutation(`updateNamespace(id:${this.selectedNS.id}, data: $data){data{id}}`,{data:{organization:this.selectedNS.organizationId}},{data:"NamespaceInput!"}).then((()=>{this.$refs.RegistryBaseDetail.loaddata(),this.$message.success(this.$t("Save successfully"),3)}))},assignOrganizationByItem(e,t){this.$gql.mutation(`updateService(id:${e}, data: $data){data{id,attributes{organization{data{id}}}}}`,{data:{organization:t}},{data:"ServiceInput!"}).then((()=>{this.$refs.RegistryBaseDetail.loaddata(),this.$message.success(this.$t("Save successfully"),3)}))},pjsChange(e){this.pjsConfig=e},getDefaultPjsConfig(){fetch("pipy-4lb.js").then((e=>e.text())).then((e=>{this.pjsConfig=e})).catch((e=>{}))},handleChange(){}}};var m=(0,a(83744).Z)(h,[["render",function(e,t,a,s,d,o){const u=(0,l.up)("a-result"),r=(0,l.up)("a-select-option"),p=(0,l.up)("a-select"),c=(0,l.up)("a-button"),h=(0,l.up)("ServiceList"),m=(0,l.up)("a-col"),g=(0,l.up)("a-row"),b=(0,l.up)("a-tab-pane"),v=(0,l.up)("a-card"),f=((0,l.up)("Lb4Detail"),(0,l.up)("Lb7Detail"),(0,l.up)("JsEditor")),w=(0,l.up)("a-tabs"),y=(0,l.up)("RegistryBaseDetail");return(0,l.wg)(),(0,l.j4)(y,{ref:"RegistryBaseDetail",pid:d.pid,types:d.types,onGetDetail:o.getDetail},{tabs:(0,l.w5)((()=>[(0,l.Wm)(w,{type:"card",onChange:e.cardchange},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{key:"1",tab:e.$t("Namespace")},{default:(0,l.w5)((()=>[""==d.pid?((0,l.wg)(),(0,l.j4)(u,{key:0,"sub-title":e.$t("Please save the registration certificate first")},{icon:(0,l.w5)((()=>[n])),_:1},8,["sub-title"])):(0,l.kq)("",!0),""!=d.pid?((0,l.wg)(),(0,l.j4)(g,{key:1,class:"row-mg"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{mode:"registry","embed-services":d.selectedNS.services,"tab-list":o.namespaceTabs,tabKey:d.selectedKeys,"onUpdate:tabKey":t[1]||(t[1]=e=>d.selectedKeys=e),embed:!0,metric:!1,"has-search":!1,onNsChange:o.selectNS,onEnabledChange:o.enabledChange},(0,l.Nv)({organization:(0,l.w5)((({item:t})=>[t.organization?((0,l.wg)(),(0,l.j4)(p,{key:0,placeholder:e.$t("unset"),value:t.organization.id,"onUpdate:value":e=>t.organization.id=e,onChange:e=>o.assignOrganizationByItem(t.id,t.organization.id),class:"width-180",ref:"select"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.orgs,((e,t)=>((0,l.wg)(),(0,l.j4)(r,{value:e.id,key:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.name),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["placeholder","value","onUpdate:value","onChange"])):(0,l.kq)("",!0)])),_:2},[e.$isPro?{name:"extra",fn:(0,l.w5)((()=>[(0,l.Wm)(p,{placeholder:e.$t("unset"),value:d.selectedNS.organizationId,"onUpdate:value":t[0]||(t[0]=e=>d.selectedNS.organizationId=e),class:"width-180",ref:"select"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.orgs,((e,t)=>((0,l.wg)(),(0,l.j4)(r,{value:e.id,key:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value"]),(0,l.Wm)(c,{class:"ml-10",type:"primary",onClick:o.assignOrganization},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.$t("Assign Organization")),1)])),_:1},8,["onClick"])])),key:"0"}:void 0]),1032,["embed-services","tab-list","tabKey","onNsChange","onEnabledChange"])])),_:1})])),_:1})):(0,l.kq)("",!0)])),_:1},8,["tab"]),(0,l.kq)("",!0),e.$isPro&&"k8s"!=d.detail.type?((0,l.wg)(),(0,l.j4)(b,{key:"3",tab:e.$t("config")},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{class:"card mb-24 nopd",bordered:!1},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{value:d.pjsConfig,onInput:o.pjsChange},null,8,["value","onInput"])])),_:1})])),_:1},8,["tab"])):(0,l.kq)("",!0)])),_:1},8,["onChange"])])),_:1},8,["pid","types","onGetDetail"])}],["__scopeId","data-v-13190fca"]])}}]);