"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[4721],{54721:function(t,e,a){a.d(e,{Z:function(){return k}});a(68309);var l=a(66252),n=a(3577),i={key:0},u={key:1,class:"gray"},r={key:0},s={key:1,class:"gray"},o={class:"font-s gray"};var d=a(95082),c=(a(41539),a(54747),a(57658),a(21249),a(74916),a(15306),a(69600),a(57327),a(96486)),p=a.n(c),h=a(84471),m=a(26917),f=a(61103),b=a(1299),v=a(33907),g=a(50976),w=a(49702),y=a(72167),$=a(13589),_=a(84722),T={name:"Lb7Detail",i18n:a(89234),components:{DetailListItem:$.Z,DetailList:b.Z,PageLayout:f.Z,AutoForm:g.Z,LogViewer:w.Z},props:["embed","name","rid"],data:function(){return{type:"7 Load Balancer",initMapping:[{label:"Load Balancing",fields:[[{label:"Algorithm",value:""},{label:"Hash On",value:"None"}]]},{label:"Targets",fields:[[{label:"Discovery Name",value:""}],[{label:"Target Hosts",value:""}]]},{label:"Active Healthcheck",fields:[[{label:"Type",value:"HTTP"},{label:"HTTPS Verify Certificate",value:"Yes"},{label:"Concurrency",value:10}],[{label:"Timeout",value:1},{label:"HTTPS SNI",value:""},{label:"HTTPS Path",value:"/"}]]},{label:"Active Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","302"]}],[{label:"Interval",value:0},{label:"Successes",value:0}]]},{label:"Active Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","429","500","501","502","503","504","505"]}],[{label:"Interval",value:0},{label:"Timeouts",value:0}],[{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]},{label:"Passive Healthcheck",fields:[[{label:"Type",value:"HTTP"}]]},{label:"Passive Healthcheck - Healthy",fields:[[{label:"HTTP Statuses",value:["200","201","202","203","204","205","206","300"]}],[{label:"Successes",value:0}]]},{label:"Passive Healthcheck - Unhealthy",fields:[[{label:"HTTP Statuses",value:["404","500","503"]}],[{label:"Timeouts",value:0},{label:"TCP Failures",value:0},{label:"HTTP Failures",value:0}]]}],visible:!1,detail:{content:{mapping:[],bps_limit:null,tps_limit:null,port:8e3,paths:""},profile:{id:null},L7Cluster:{id:null},name:""},loading:!0,logloading:!0,logs:[],log:"{}",pid:"",filter:"",params:{pageNo:1,pageSize:10,total:0},profiles:[],clusters:[],tps:[],tpsCnt:0,activeTabKey:"2"}},computed:(0,d.Z)({},(0,v.rn)("setting",["isMobile"])),created:function(){var t=this;this.pid=this.rid||"",""!=this.pid?(this.loading=!0,this.$gql.query("l7Lb(id: ".concat(this.pid,"){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tL7Cluster{data{id,attributes{name}}},\n\t\t\t\t\t\tprofile{data{id,attributes{name}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}")).then((function(e){var a=e.data;a.content.mapping=(0,_.kL)(t.initMapping,a.content.mapping),t.loading=!1,t.detail=a,t.getData()}))):(this.detail={profile:{id:null},L7Cluster:{id:null},content:{mapping:this.initMapping,port:80,bps_limit:null,tps_limit:null,paths:""},name:""},this.loading=!1),this.embed&&(this.detail.name=this.name),this.$gql.query("l7Clusters{data{id,attributes{name}}}").then((function(e){t.clusters=e.data})),this.$gql.query("profiles{data{id,attributes{name}}}").then((function(e){t.profiles=e.data})),""!=this.pid&&(0,m.ap)(this.pid).then((0,h.hw)((function(e,a){var l=(0,m.tl)(e);t.tpsCnt=a.data,t.tps=[],l.forEach((function(e){var a={type:"7lb"};a.value=e[0],a.date=(0,y.Z)(new Date(e[1]),"yyyy-MM-dd HH:mm"),t.tps.push(a)}))}))).catch((function(t){}))},methods:{onTabChange:function(t){},valid:function(){return""==this.detail.name&&""==this.name?(this.$message.error(this.$t("The name cannot be empty"),3),!1):this.detail.L7Cluster.id?!!this.detail.profile.id||(this.$message.error("Profile cannot be empty",3),!1):(this.$message.error("The cluster cannot be empty",3),!1)},save:function(t){var e=this;if(this.valid()){var a=p().cloneDeep(this.detail);a.content.mapping=p().cloneDeep(this.detail.content.mapping),a.content.port=8e3,a.content.bps_limit=1*a.content.bps_limit,a.content.tps_limit=1*a.content.tps_limit,a.content.is_gateway=!!this.embed,a.L7Cluster=a.L7Cluster.id,a.profile=a.profile.id,t&&(a.registry=t,a.name=this.name+" 4LB"),a.content.targets||(a.content.targets="[]"),delete a.id,""!=this.pid?this.$gql.mutation("updateL7Lb(id:".concat(this.pid,", data: $data){data{id}}"),{data:a},{data:"L7LbInput!"}).then((function(){e.embed?e.$emit("saved",t):(e.$message.success(e.$t("Save successfully"),3),e.$closePage(e.$route))})):this.$gql.mutation("createL7Lb(data: $data){data{id}}",{data:a},{data:"L7LbInput!"}).then((function(a){e.embed?e.$emit("saved",t):(e.pid=a.data.id,e.$message.success(e.$t("Created successfully"),3),e.$closePage(e.$route))}))}},handleChange:function(){},hide:function(){this.visible=!1},joinPath:function(t){var e="";return t?(t.map((function(t,a){return a>0&&(e+="\n"),e+=t.host+t.path,t})),e):e},splitPath:function(t){var e=[],a=t.split("\n");return e?(a.map((function(t){var a=t.replace("http://","http:||").replace("https://","https:||").split("/"),l=a.shift();return l=l.replace("http:||","http://").replace("https:||","https://"),e.push({host:l,path:"/"+a.join("/")}),t})),e):t},getData:function(t,e){var a=this;t&&(this.params.pageNo=t,this.params.pageSize=e),this.logloading=!0,this.data=[],this.filter="iid = '".concat(this.pid,"'"),(0,m.hT)(this.params.pageNo,this.params.pageSize,this.filter,"timestamp","desc").then((0,h.hw)((function(t,e){a.logloading=!1,a.params.total=1*t.data,a.logs=(0,m.OI)(e)}))).catch((function(t){}))}}};var k=(0,a(83744).Z)(T,[["render",function(t,e,a,d,c,p){var h=(0,l.up)("a-input"),m=(0,l.up)("DetailListItem"),f=(0,l.up)("a-select-option"),b=(0,l.up)("a-select"),v=(0,l.up)("a-textarea"),g=(0,l.up)("DetailList"),w=(0,l.up)("a-button"),y=(0,l.up)("AutoForm"),$=(0,l.up)("a-card"),_=(0,l.up)("a-tab-pane"),T=(0,l.up)("LogViewer"),k=(0,l.up)("a-tabs"),L=(0,l.up)("a-col"),C=(0,l.up)("a-row"),H=(0,l.up)("PageLayout");return(0,l.wg)(),(0,l.j4)(H,{"hide-breadcrumb":a.embed,title:a.embed?" ":c.detail.name?c.detail.name:t.$t("new")+" 7LB"},(0,l.Nv)({headerContent:(0,l.w5)((function(){return[(0,l.Wm)(g,{size:"small",col:2},{default:(0,l.w5)((function(){return[a.embed?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(m,{key:0,term:t.$t("as")},{default:(0,l.w5)((function(){return[(0,l.Wm)(h,{placeholder:t.$t("unset"),value:c.detail.name,"onUpdate:value":e[0]||(e[0]=function(t){return c.detail.name=t}),class:"width-200"},null,8,["placeholder","value"])]})),_:1},8,["term"])),(0,l.Wm)(m,{term:t.$t("port")},{default:(0,l.w5)((function(){return[(0,l.Wm)(h,{type:"number",disabled:"",placeholder:t.$t("unset"),value:c.detail.content.port,"onUpdate:value":e[1]||(e[1]=function(t){return c.detail.content.port=t}),class:"width-100"},null,8,["placeholder","value"])]})),_:1},8,["term"]),(0,l.Wm)(m,{term:t.$t("profile")},{default:(0,l.w5)((function(){return[(0,l.Wm)(b,{placeholder:t.$t("unallocated"),class:"width-200",value:c.detail.profile.id,"onUpdate:value":e[2]||(e[2]=function(t){return c.detail.profile.id=t}),onChange:e[3]||(e[3]=function(t){return p.handleChange()})},{default:(0,l.w5)((function(){return[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.profiles,(function(t,e){return(0,l.wg)(),(0,l.j4)(f,{key:e,value:t.id},{default:(0,l.w5)((function(){return[t.id?((0,l.wg)(),(0,l.iD)("span",i,(0,n.zw)(t.name),1)):(0,l.kq)("",!0),t.id?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("i",u,(0,n.zw)(t.name),1))]})),_:2},1032,["value"])})),128))]})),_:1},8,["placeholder","value"])]})),_:1},8,["term"]),(0,l.Wm)(m,{term:t.$t("cluster")},{default:(0,l.w5)((function(){return[(0,l.Wm)(b,{placeholder:t.$t("unallocated"),class:"width-200",value:c.detail.L7Cluster.id,"onUpdate:value":e[4]||(e[4]=function(t){return c.detail.L7Cluster.id=t}),onChange:e[5]||(e[5]=function(t){return p.handleChange()})},{default:(0,l.w5)((function(){return[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.clusters,(function(t,e){return(0,l.wg)(),(0,l.j4)(f,{key:e,value:t.id},{default:(0,l.w5)((function(){return[t.id?((0,l.wg)(),(0,l.iD)("span",r,(0,n.zw)(t.name),1)):(0,l.kq)("",!0),t.id?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("i",s,(0,n.zw)(t.name),1))]})),_:2},1032,["value"])})),128))]})),_:1},8,["placeholder","value"])]})),_:1},8,["term"]),(0,l.Wm)(m,{term:t.$t("bindwidth")+" (Mb)"},{default:(0,l.w5)((function(){return[(0,l.Wm)(h,{value:c.detail.content.bps_limit,"onUpdate:value":e[6]||(e[6]=function(t){return c.detail.content.bps_limit=t}),type:"number",placeholder:t.$t("unset"),class:"width-100"},null,8,["value","placeholder"])]})),_:1},8,["term"]),(0,l.Wm)(m,{term:t.$t("tps2")},{default:(0,l.w5)((function(){return[(0,l.Wm)(h,{type:"number",value:c.detail.content.tps_limit,"onUpdate:value":e[7]||(e[7]=function(t){return c.detail.content.tps_limit=t}),placeholder:t.$t("unset"),class:"width-100"},null,8,["value","placeholder"])]})),_:1},8,["term"]),(0,l.Wm)(m,{term:t.$t("paths"),"term-top":!0},{default:(0,l.w5)((function(){return[(0,l.Wm)(v,{value:c.detail.content.paths,"onUpdate:value":e[8]||(e[8]=function(t){return c.detail.content.paths=t}),placeholder:t.$t("unset"),rows:4},null,8,["value","placeholder"]),(0,l._)("div",o,(0,n.zw)(t.$t("List of host:path")),1)]})),_:1},8,["term"])]})),_:1})]})),action:(0,l.w5)((function(){return[a.embed?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(w,{key:0,type:"primary",onClick:e[9]||(e[9]=function(t){return p.save()})},{default:(0,l.w5)((function(){return[(0,l.Uk)((0,n.zw)(""!=c.pid?t.$t("save"):t.$t("create")),1)]})),_:1}))]})),default:(0,l.w5)((function(){return[(0,l.Wm)(C,{class:"row-mg"},{default:(0,l.w5)((function(){return[(0,l.Wm)(L,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(k,{type:"card"},{default:(0,l.w5)((function(){return[(0,l.Wm)(_,{key:"1",tab:t.$t("config")},{default:(0,l.w5)((function(){return[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.detail.content.mapping,(function(e,a){return(0,l.wg)(),(0,l.j4)($,{key:a,class:"card mb-24",title:t.$t(e.label),bordered:!1,loading:c.loading},{default:(0,l.w5)((function(){return[(0,l.Wm)(y,{fields:e.fields},null,8,["fields"])]})),_:2},1032,["title","loading"])})),128))]})),_:1},8,["tab"]),""!=c.pid?((0,l.wg)(),(0,l.j4)(_,{key:"11",tab:t.$t("log")},{default:(0,l.w5)((function(){return[(0,l.Wm)(T,{uid:c.pid,type:"7lb"},null,8,["uid"])]})),_:1},8,["tab"])):(0,l.kq)("",!0)]})),_:1})]})),_:1})]})),_:1})]})),_:2},[""==c.pid||a.embed?void 0:{name:"extra",fn:(0,l.w5)((function(){return[]})),key:"0"}]),1032,["hide-breadcrumb","title"])}]])}}]);