(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[3327],{79797:function(t,e,n){!function(){"use strict";var e=n(17536).typeOf;t.exports.stringify=function(t){var n,a="";return"---"+(n={undefined:function(){return"null"},null:function(){return"null"},number:function(t){return t},boolean:function(t){return t?"true":"false"},string:function(t){return JSON.stringify(t)},array:function(t){var i="";return 0===t.length?i+="[]":(a=a.replace(/$/,"  "),t.forEach((function(t){var r=n[e(t)];if(!r)throw new Error("what the crap: "+e(t));i+="\n"+a+"- "+r(t)})),a=a.replace(/  /,""),i)},object:function(t){var i="";return 0===Object.keys(t).length?i+="{}":(a=a.replace(/$/,"  "),Object.keys(t).forEach((function(r){var o=t[r],l=n[e(o)];if(void 0!==o){if(!l)throw new Error("what the crap: "+e(o));i+="\n"+a+r+": "+l(o)}})),a=a.replace(/  /,""),i)},function:function(){return"[object Function]"}})[e(t)](t)+"\n"}}()},17536:function(t){!function(){"use strict";var e,n,a=Function("return this")(),i="Boolean Number String Function Array Date RegExp Object".split(" "),r={};for(e in i)i.hasOwnProperty(e)&&(n=i[e],r["[object "+n+"]"]=n.toLowerCase());function o(t){return null==t?String(t):r[Object.prototype.toString.call(t)]||"object"}function l(t){var e,n;if("object"===o(t))for(e in t)if(void 0!==(n=t[e])&&"function"!==o(n))return!1;return!0}String.prototype.entityify||(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),String.prototype.quote||(String.prototype.quote=function(){var t,e,n=this.length,a='"';for(e=0;e<n;e+=1)if((t=this.charAt(e))>=" ")"\\"!==t&&'"'!==t||(a+="\\"),a+=t;else switch(t){case"\b":a+="\\b";break;case"\f":a+="\\f";break;case"\n":a+="\\n";break;case"\r":a+="\\r";break;case"\t":a+="\\t";break;default:t=t.charCodeAt(),a+="\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)}return a+'"'}),String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,(function(e,n){var a=t[n];return"string"==typeof a||"number"==typeof a?a:e}))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*(\S*(?:\s+\S+)*)\s*$/,"$1")}),t.exports={typeOf:o,isEmpty:l},a.typeOf=a.typeOf||o,a.isEmpty=a.isEmpty||l}()},93327:function(t,e,n){"use strict";n.d(e,{Z:function(){return O}});n(68309);var a=n(66252),i=n(3577),r={key:0},o={key:1,class:"gray"},l={key:0,class:"flex mt-10"};var s=n(95082),u=(n(69826),n(41539),n(75505),n(87714),n(82801),n(1174),n(38862),n(57658),n(54747),n(96486)),c=n.n(u),d=n(85263),f=n(61103),p=n(16822),g=n(1299),m=n(13589),h=n(8333),y=n(33907),w=n(62202),v={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 112H724V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H500V72c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v40H320c-17.7 0-32 14.3-32 32v120h-96c-17.7 0-32 14.3-32 32v632c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32v-96h96c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM664 888H232V336h218v174c0 22.1 17.9 40 40 40h174v338zm0-402H514V336h.2L664 485.8v.2zm128 274h-56V456L544 264H360v-80h68v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h152v32c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-32h68v576z"}}]},name:"snippets",theme:"outlined"},k=n(33058);function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),a.forEach((function(e){$(t,e,n[e])}))}return t}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var C=function(t,e){var n=b({},t,e.attrs);return(0,a.Wm)(k.Z,b({},n,{icon:v}),null)};C.displayName="SnippetsOutlined",C.inheritAttrs=!1;var S=C,_=n(93320),j=n(79797),P={name:"RegistryBaseDetail",i18n:n(89234),components:{DetailListItem:m.Z,DetailList:g.Z,Status:p.Z,UploadOutlined:w.Z,SnippetsOutlined:S,PageLayout:f.Z,YamlEditor:h.Z},props:["pid","types"],data:function(){return{connectLoading:!1,namespaces:[],fileList:[],simpleImage:d.Z.PRESENTED_IMAGE_SIMPLE,service:"{\n\t\t}",configJson:null,yamlConfig:"",detail:{organization:null,type:"k8s",name:"",config:null,content:{credit:"",autoUpstream:!1,autoApplication:!1,isGateway:!1,gatewayPath:"",gatewayPort:0},address:""},json:'{ "":"" }',config:"",loading:!0}},computed:(0,s.Z)((0,s.Z)({},(0,y.rn)("rules",["rules"])),{},{getCluster:function(){var t=this,e=null;return this.configJson&&this.configJson.clusters&&(e=this.configJson["current-context"]?this.configJson.clusters.find((function(e){return e.name==t.configJson["current-context"]})).cluster:this.configJson.clusters[0].cluster),e}}),created:function(){""!=this.pid?this.loaddata():(this.detail={organization:null,type:"k8s",name:"",config:null,yamlConfig:"",content:{credit:"",autoUpstream:!1,autoApplication:!1,isGateway:!1,gatewayPath:"",gatewayPort:0},address:""},this.loading=!1,this.$emit("getDetail",{detail:this.detail}))},methods:{clearConfig:function(){this.detail.config=null,this.configJson=null},getYaml:function(){this.detail.config=this.yamlConfig,this.configJson=_.load(this.yamlConfig)},convertToYaml:function(t){if(""==t)return"";var e=JSON.parse(t);return j.stringify(e)},beforeUpload:function(t){var e=this;return new Promise((function(){var n=new FileReader;n.readAsDataURL(t),n.onload=function(){if(n.result){var t=atob(n.result.split("base64,")[1]);e.detail.config=t,e.configJson=_.load(t),e.yamlConfig=e.convertToYaml(JSON.stringify(e.configJson))}}}))},valid:function(){return""!=this.detail.name||(this.$message.error(this.$t("The name cannot be empty"),3),!1)},saved:function(t){""!=this.pid?(this.$message.success(this.$t("Save successfully"),3),this.$closePage(this.$route)):(this.$message.success(this.$t("Created successfully"),3),this.$router.push({path:"/ops-center/registry/detail/"+t}),this.$closePage(this.$route))},pingValidate:function(){var t=this;this.$refs.layout.$refs.form.validateFields().then((function(){t.ping()})).catch((function(){}))},validate:function(){var t=this;this.$refs.layout.$refs.form.validateFields().then((function(){t.save()})).catch((function(){}))},ping:function(){var t=this;if(this.valid()){var e=c().cloneDeep(this.detail);delete e.services,delete e.L4LBs,delete e.id,delete e.namespaces,delete e.L7Lbs,delete e.yamlConfig,this.connectLoading=!0,this.$gql.mutation("pingRegistry(data: $data)",{data:e},{data:"RegistryInput"}).then((function(e){t.connectLoading=!1,e.isOK?t.$message.success(t.$t("Connect successfully"),3):t.$message.error(e.error,3)}))}},save:function(){var t=this;if(this.valid()){var e=c().cloneDeep(this.detail);delete e.services,delete e.L4LBs,delete e.namespaces,delete e.L7Lbs,delete e.yamlConfig,""!=this.pid?(delete e.id,this.$gql.mutation("updateRegistry(id:".concat(this.pid,", data: $data){data{id}}"),{data:e},{data:"RegistryInput!"}).then((function(){t.saved()}))):this.$gql.mutation("createRegistry(data: $data){data{id}}",{data:e},{data:"RegistryInput!"}).then((function(e){t.saved(e.data.id)}))}},handleChange:function(){},hide:function(){this.visible=!1,this.save()},loaddata:function(){var t=this;this.loading=!0,this.$gql.query("registry(id: ".concat(this.pid,"){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\taddress,\n\t\t\t\t\t\tconfig,\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\tnamespaces(pagination: {limit: 9999 }){data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\torganization{data{id,attributes{name}}},\n\t\t\t\t\t\t\tservices(pagination: {limit: 9999 }){data{id,attributes{\n\t\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\t\tgatewayPath,\n\t\t\t\t\t\t\t\tdeleted,\n\t\t\t\t\t\t\t\tfleet{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\torganization{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\t}}}\n\t\t\t\t\t\t}}}\n\t\t\t\t\t}}}")).then((function(e){if(t.detail=e.data,t.detail.content||(t.detail.content={}),t.detail.content.credit||(t.detail.content.credit=""),t.detail.config?(t.configJson=_.load(t.detail.config),t.yamlConfig=t.convertToYaml(JSON.stringify(t.configJson))):(t.configJson=null,t.yamlConfig=t.convertToYaml("{}")),null==t.detail.content.autoUpstream&&(t.detail.content.autoUpstream=!1),null==t.detail.content.autoApplication&&(t.detail.content.autoApplication=!1),t.detail.namespaces){var n=!1;t.detail.namespaces.forEach((function(e){e.organizationId=e.organization?e.organization.id:null,e.services.length>0&&(e.services.forEach((function(t){t.organization=t.organization?t.organization:{id:null},t.enabled=!t.deleted})),n||(n=!0,t.selectedKeys=e.id,t.selectedNS=e))}))}t.loading=!1,t.namespaces=e.data.namespaces,t.$emit("getDetail",{detail:t.detail,namespaces:t.namespaces,selectedNS:t.selectedNS,selectedKeys:t.selectedKeys})}))}}};var O=(0,n(83744).Z)(P,[["render",function(t,e,n,s,u,c){var d=(0,a.up)("a-input"),f=(0,a.up)("DetailListItem"),p=(0,a.up)("a-select-option"),g=(0,a.up)("a-select"),m=(0,a.up)("a-switch"),h=(0,a.up)("a-input-number"),y=((0,a.up)("a-checkbox"),(0,a.up)("DetailList")),w=(0,a.up)("a-col"),v=(0,a.up)("a-textarea"),k=(0,a.up)("YamlEditor"),b=(0,a.up)("SnippetsOutlined"),$=(0,a.up)("a-button"),C=(0,a.up)("a-popover"),S=(0,a.up)("UploadOutlined"),_=(0,a.up)("a-upload"),j=(0,a.up)("a-tag"),P=(0,a.up)("Status"),O=(0,a.up)("a-row"),L=(0,a.up)("PageLayout"),z=(0,a.Q2)("permission");return(0,a.wg)(),(0,a.j4)(L,{title:u.detail.name?u.detail.name:t.$t("Registry"),"form-state":u.detail,ref:"layout"},{headerContent:(0,a.w5)((function(){return[(0,a.Wm)(O,null,{default:(0,a.w5)((function(){return[(0,a.Wm)(w,{xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,a.w5)((function(){return[(0,a.Wm)(y,{size:"small",col:1},{default:(0,a.w5)((function(){return[(0,a.Wm)(f,{term:t.$t("as"),rules:t.rules.uniqueName("registries",{id:n.pid}),name:"name"},{default:(0,a.w5)((function(){return[(0,a.Wm)(d,{placeholder:t.$t("unset"),value:u.detail.name,"onUpdate:value":e[0]||(e[0]=function(t){return u.detail.name=t}),class:"width-200"},null,8,["placeholder","value"])]})),_:1},8,["term","rules"]),""==n.pid?((0,a.wg)(),(0,a.j4)(f,{key:0,term:t.$t("Type"),rules:t.rules.required,name:"type"},{default:(0,a.w5)((function(){return[(0,a.Wm)(g,{placeholder:t.$t("unallocated"),class:"width-200",value:u.detail.type,"onUpdate:value":e[1]||(e[1]=function(t){return u.detail.type=t}),onChange:e[2]||(e[2]=function(t){return c.handleChange()})},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.types,(function(t,e){return(0,a.wg)(),(0,a.j4)(p,{key:e,value:t.name},{default:(0,a.w5)((function(){return[t.name?((0,a.wg)(),(0,a.iD)("span",r,(0,i.zw)(t.name),1)):(0,a.kq)("",!0),t.name?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("i",o,(0,i.zw)(t.name),1))]})),_:2},1032,["value"])})),128))]})),_:1},8,["placeholder","value"])]})),_:1},8,["term","rules"])):((0,a.wg)(),(0,a.j4)(f,{key:1,term:t.$t("Type")},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(u.detail.type),1)]})),_:1},8,["term"])),t.$isPro?((0,a.wg)(),(0,a.j4)(f,{key:2,term:t.$t("Is Gateway")},{default:(0,a.w5)((function(){return[(0,a.Wm)(m,{checked:u.detail.content.isGateway,"onUpdate:checked":e[3]||(e[3]=function(t){return u.detail.content.isGateway=t})},null,8,["checked"])]})),_:1},8,["term"])):(0,a.kq)("",!0),u.detail.content.isGateway&&t.$isPro?((0,a.wg)(),(0,a.j4)(f,{key:3,rules:t.rules.required,name:["content","gatewayPath"],term:t.$t("Gateway Path")},{default:(0,a.w5)((function(){return[(0,a.Wm)(d,{placeholder:t.$t("unset"),value:u.detail.content.gatewayPath,"onUpdate:value":e[4]||(e[4]=function(t){return u.detail.content.gatewayPath=t}),class:"width-300"},null,8,["placeholder","value"])]})),_:1},8,["rules","term"])):(0,a.kq)("",!0),u.detail.content.isGateway&&t.$isPro?((0,a.wg)(),(0,a.j4)(f,{key:4,term:t.$t("Gateway Port")},{default:(0,a.w5)((function(){return[(0,a.Wm)(h,{placeholder:t.$t("unset"),min:0,value:u.detail.content.gatewayPort,"onUpdate:value":e[5]||(e[5]=function(t){return u.detail.content.gatewayPort=t}),class:"width-300"},null,8,["placeholder","value"])]})),_:1},8,["term"])):(0,a.kq)("",!0),(t.$isPro,(0,a.kq)("",!0))]})),_:1})]})),_:1}),(0,a.Wm)(w,{xl:12,lg:24,md:24,sm:24,xs:24},{default:(0,a.w5)((function(){return[(0,a.Wm)(y,{size:"small",col:1},{default:(0,a.w5)((function(){return["k8s"!=u.detail.type?((0,a.wg)(),(0,a.j4)(f,{key:0,rules:t.rules.required,name:"address",term:t.$t("Location")},{default:(0,a.w5)((function(){return[(0,a.Wm)(v,{value:u.detail.address,"onUpdate:value":e[8]||(e[8]=function(t){return u.detail.address=t}),placeholder:t.$t("protocol://hostname:port"),"allow-clear":""},null,8,["value","placeholder"])]})),_:1},8,["rules","term"])):(0,a.kq)("",!0),"k8s"==u.detail.type?((0,a.wg)(),(0,a.j4)(f,{key:1,term:"k8s"==u.detail.type?"K8S Config":t.$t("Config"),rules:t.rules.required,name:["config"]},{default:(0,a.w5)((function(){return[(0,a.Wm)(C,{trigger:"click","destroy-tooltip-on-hide":!0,title:"K8S Config"},{content:(0,a.w5)((function(){return[(0,a.Wm)(k,{onFetch:c.getYaml,class:"width-500",value:u.yamlConfig,"onUpdate:value":e[9]||(e[9]=function(t){return u.yamlConfig=t})},null,8,["onFetch","value"])]})),default:(0,a.w5)((function(){return[(0,a.Wm)($,{class:"mr-10"},{default:(0,a.w5)((function(){return[(0,a.Wm)(b),(0,a.Uk)(" "+(0,i.zw)(t.$t("Paste")),1)]})),_:1})]})),_:1}),(0,a.Wm)(_,{"file-list":u.fileList,"onUpdate:file-list":e[10]||(e[10]=function(t){return u.fileList=t}),"before-upload":c.beforeUpload},{default:(0,a.w5)((function(){return[(0,a.Wm)($,null,{default:(0,a.w5)((function(){return[(0,a.Wm)(S),(0,a.Uk)(" "+(0,i.zw)(t.$t("Upload")),1)]})),_:1})]})),_:1},8,["file-list","before-upload"]),u.configJson&&c.getCluster?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",null,[(0,a.Wm)(j,{closable:"",onClose:c.clearConfig},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(c.getCluster.server)+" ("+(0,i.zw)(u.configJson.apiVersion)+") ",1)]})),_:1},8,["onClose"])]),u.configJson&&"Config"==u.configJson.kind?((0,a.wg)(),(0,a.j4)(P,{key:0,class:"inline-block",d:{status:"success"}})):u.configJson?((0,a.wg)(),(0,a.j4)(P,{key:1,class:"inline-block",d:{status:"failed"}})):(0,a.kq)("",!0)])):(0,a.kq)("",!0)]})),_:1},8,["term","rules"])):(0,a.kq)("",!0),"k8s"!=u.detail.type?((0,a.wg)(),(0,a.j4)(f,{key:2,term:t.$t("Credit")},{default:(0,a.w5)((function(){return[(0,a.Wm)(v,{class:"height-90",value:u.detail.content.credit,"onUpdate:value":e[11]||(e[11]=function(t){return u.detail.content.credit=t}),placeholder:t.$t("Please input user:passwor or token"),"allow-clear":""},null,8,["value","placeholder"])]})),_:1},8,["term"])):(0,a.kq)("",!0),(0,a.kq)("",!0)]})),_:1})]})),_:1})]})),_:1})]})),action:(0,a.w5)((function(){return[(0,a.Wm)($,{class:"mr-10",type:"primary",onClick:c.pingValidate,loading:u.connectLoading},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("Connect Registry")),1)]})),_:1},8,["onClick","loading"]),""!=n.pid?(0,a.wy)(((0,a.wg)(),(0,a.j4)($,{key:0,type:"primary",onClick:c.validate},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("save")),1)]})),_:1},8,["onClick"])),[[z,["registry:update"]]]):(0,a.wy)(((0,a.wg)(),(0,a.j4)($,{key:1,type:"primary",onClick:c.validate},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("create")),1)]})),_:1},8,["onClick"])),[[z,["registry:create"]]])]})),default:(0,a.w5)((function(){return[(0,a.Wm)(O,null,{default:(0,a.w5)((function(){return[(0,a.Wm)(w,{xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,a.w5)((function(){return[(0,a.WI)(t.$slots,"tabs")]})),_:3})]})),_:3})]})),_:3},8,["title","form-state"])}]])}}]);