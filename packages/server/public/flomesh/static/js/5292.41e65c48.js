"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[5292],{23235:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96486),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__),_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(71153),_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(13471),vuex__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(33907),_layouts_PageLayout__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61103);__webpack_exports__.Z={name:"NetworkView",i18n:__webpack_require__(89234),components:{PageLayout:_layouts_PageLayout__WEBPACK_IMPORTED_MODULE_2__.Z,NodeIndexOutlined:_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_3__.Z,FieldTimeOutlined:_ant_design_icons_vue__WEBPACK_IMPORTED_MODULE_4__.Z},data(){return{date:"",endDate:"",filter:"",loading:!0,params:{pageNo:1,pageSize:10,total:0},data:[]}},computed:{...(0,vuex__WEBPACK_IMPORTED_MODULE_5__.rn)("setting",["layout","pageWidth"])},created(){this.getData()},methods:{getSqlPagging(e){return`SELECT traceid,cnt,duration,minReqTime,maxResTime,serviceName,podName FROM ( ${e} ) ORDER BY minReqTime DESC LIMIT ${(this.params.pageNo-1)*this.params.pageSize},${this.params.pageSize};`},getWhere(){let e="where 1=1 ";return this.filter&&""!=this.filter&&(e+=` AND (trace.id = '${this.filter}' or service.name = '${this.filter}' or pod.name = '${this.filter}' or pod.ip = '${this.filter}') `),this.date&&""!=this.date&&(e+=" AND reqTime > "+new Date(this.date).getTime()),this.endDate&&""!=this.endDate&&(e+=" AND reqTime < "+new Date(this.endDate).getTime()),e},getCount(e){let a=`select count(1) as cnt from (select 1 from log ${e} group by trace.id)`;this.$request(this.$REST.CLICKHOUSE.QUERY(a),this.$METHOD.GET).then((e=>{this.params.total=1*e.data})).catch((e=>{}))},getData(pageNo,pageSize){pageNo&&(this.params.pageNo=pageNo,this.params.pageSize=pageSize);let whereSQL=this.getWhere();this.getCount(whereSQL),this.data=[],this.loading=!0;let SQL=this.getSqlPagging(`select trace.id as traceid,count() as cnt,(max(resTime) - min(reqTime)) as duration,min(reqTime) as minReqTime,max(resTime) as maxResTime,groupUniqArray(service.name) as serviceName,groupUniqArray(pod.name) as podName from log ${whereSQL} group by trace.id`);this.$request(this.$REST.CLICKHOUSE.QUERY(SQL),this.$METHOD.GET).then((res=>{this.loading=!1;let nodes=res.data.split("\n");nodes.map((nodeStr=>{let node=nodeStr.split("\t"),item={traceId:node[0],spancnt:node[1],duration:node[2],start:node[3],end:node[4],service:lodash__WEBPACK_IMPORTED_MODULE_1___default().uniq(eval(node[5])),pod:lodash__WEBPACK_IMPORTED_MODULE_1___default().uniq(eval(node[6]))};return""!=node[0]&&this.data.push(item),nodeStr}))})).catch((e=>{}))},detail(e){this.$router.push({path:"/fsm/waterfall/detail/"+e})}}}},35292:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});var _=t(66252),i=t(3577);const n=e=>((0,_.dD)("data-v-6639f4bc"),e=e(),(0,_.Cn)(),e),s={class:"search-input"},r={class:"form-row"},l={class:"label"},o={class:"content"},d=n((()=>(0,_._)("em",{class:"em"}," ~ ",-1))),u=["onClick"],c=n((()=>(0,_._)("div",{class:"content"},null,-1))),p=n((()=>(0,_._)("em",null," ~ ",-1)));var m=t(23235);var h=(0,t(83744).Z)(m.Z,[["render",function(e,a,t,n,m,h){const g=(0,_.up)("a-input-search"),D=(0,_.up)("a-date-picker"),E=(0,_.up)("a-form"),w=(0,_.up)("a-card"),f=(0,_.up)("a-typography-paragraph"),T=(0,_.up)("a-tag"),O=(0,_.up)("a-list-item-meta"),M=(0,_.up)("NodeIndexOutlined"),P=(0,_.up)("FieldTimeOutlined"),v=(0,_.up)("a-list-item"),C=(0,_.up)("a-list"),S=(0,_.up)("PageLayout");return(0,_.wg)(),(0,_.j4)(S,{title:e.$t("Waterfall")},{headerContent:(0,_.w5)((()=>[(0,_._)("div",{class:(0,i.C_)(["search-head",e.layout,e.pageWidth])},[(0,_._)("div",s,[(0,_.Wm)(g,{class:"search-ipt",value:m.filter,"onUpdate:value":a[0]||(a[0]=e=>m.filter=e),onSearch:a[1]||(a[1]=e=>h.getData()),loading:m.loading,placeholder:e.$t("Please input")+":"+e.$t("Trace / Service / Pod"),size:"large"},null,8,["value","loading","placeholder"])]),(0,_.Wm)(w,{bordered:!1,class:"search-form"},{default:(0,_.w5)((()=>[(0,_.Wm)(E,null,{default:(0,_.w5)((()=>[(0,_._)("div",r,[(0,_._)("div",l,[(0,_._)("span",null,(0,i.zw)(e.$t("Time screening")),1)]),(0,_._)("div",o,[(0,_.Wm)(D,{value:m.date,"onUpdate:value":a[2]||(a[2]=e=>m.date=e),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:e.$t("Start Date"),onChange:a[3]||(a[3]=e=>h.getData())},null,8,["value","placeholder"]),d,(0,_.Wm)(D,{value:m.endDate,"onUpdate:value":a[4]||(a[4]=e=>m.endDate=e),"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:e.$t("End Date"),onChange:a[5]||(a[5]=e=>h.getData())},null,8,["value","placeholder"])])])])),_:1})])),_:1})],2)])),default:(0,_.w5)((()=>[(0,_.Wm)(w,{class:"search-content",loading:m.loading},{default:(0,_.w5)((()=>[(0,_.Wm)(C,{"item-layout":"vertical",pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:h.getData,onChange:h.getData,current:m.params.pageNo,pageSize:m.params.pageSize,showTotal:(a,t)=>`${e.$t("Total")} ${a}`,total:m.params.total}},{default:(0,_.w5)((()=>[((0,_.wg)(!0),(0,_.iD)(_.HY,null,(0,_.Ko)(m.data,((a,t)=>((0,_.wg)(),(0,_.j4)(v,{key:t},{actions:(0,_.w5)((()=>[(0,_._)("span",null,[(0,_.Wm)(M),(0,_.Uk)(" "+(0,i.zw)(a.spancnt)+" "+(0,i.zw)(e.$t("unitci")),1)]),(0,_._)("span",null,[(0,_.Wm)(P),(0,_.Uk)(" "+(0,i.zw)(a.duration)+" ms",1)]),(0,_._)("span",null,[(0,_._)("em",null,(0,i.zw)(new Date(1*a.start).toLocaleString()),1),p,(0,_._)("em",null,(0,i.zw)(new Date(1*a.end).toLocaleString()),1)])])),default:(0,_.w5)((()=>[(0,_.Wm)(O,null,{title:(0,_.w5)((()=>[(0,_.Uk)(" Trace :  "),(0,_.Wm)(f,{class:"search-content-meta",copyable:{tooltips:!1}},{default:(0,_.w5)((()=>[(0,_._)("a",{href:"javascript:void(0)",onClick:e=>h.detail(a.traceId)},(0,i.zw)(a.traceId),9,u)])),_:2},1024)])),description:(0,_.w5)((()=>[((0,_.wg)(!0),(0,_.iD)(_.HY,null,(0,_.Ko)(a.service,((e,a)=>((0,_.wg)(),(0,_.j4)(T,{key:a},{default:(0,_.w5)((()=>[(0,_.Uk)((0,i.zw)(e),1)])),_:2},1024)))),128)),((0,_.wg)(!0),(0,_.iD)(_.HY,null,(0,_.Ko)(a.pod,((e,a)=>((0,_.wg)(),(0,_.j4)(T,{key:a},{default:(0,_.w5)((()=>[(0,_.Uk)((0,i.zw)(e),1)])),_:2},1024)))),128))])),_:2},1024),c])),_:2},1024)))),128))])),_:1},8,["pagination"])])),_:1},8,["loading"])])),_:1},8,["title"])}],["__scopeId","data-v-6639f4bc"]])}}]);