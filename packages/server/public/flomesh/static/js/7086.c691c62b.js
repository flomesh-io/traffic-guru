"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[7086],{21002:function(t,e,a){a.d(e,{Z:function(){return i}});var n=a(66252);var s={name:"SyncBar",components:{SyncOutlined:a(21826).Z},props:["percent"],methods:{sync(){this.$emit("sync")}}};var i=(0,a(83744).Z)(s,[["render",function(t,e,a,s,i,r){const o=(0,n.up)("a-progress"),l=(0,n.up)("SyncOutlined"),c=(0,n.up)("a-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[a.percent>-1?((0,n.wg)(),(0,n.j4)(o,{key:0,size:"small",class:"title-progress","stroke-color":{"0%":"#00adef","100%":"#87d068"},percent:a.percent},null,8,["percent"])):(0,n.kq)("",!0),-1==a.percent?((0,n.wg)(),(0,n.j4)(c,{key:1,type:"link",shape:"circle",onClick:r.sync},{icon:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"font-20 icon-menu-sm rotate-icon"})])),_:1},8,["onClick"])):(0,n.kq)("",!0),a.percent>-1&&a.percent<100?((0,n.wg)(),(0,n.j4)(c,{key:2,type:"link",shape:"circle"},{icon:(0,n.w5)((()=>[a.percent>-1&&a.percent<100?((0,n.wg)(),(0,n.j4)(l,{key:0,spin:"",class:"font-12"})):(0,n.kq)("",!0)])),_:1})):(0,n.kq)("",!0)],64)}],["__scopeId","data-v-6a8f29bb"]])},47086:function(t,e,a){a.r(e),a.d(e,{default:function(){return v}});var n=a(66252);var s=a(3577),i=a(49963);const r={key:0},o=["onClick"],l={key:0},c={key:2},d={key:3},u=["onClick"];a(57658);var p=a(60459),h=a(2692),g=a(99684),m=a(21002);const w=[{key:"as",dataIndex:"name"},{key:"Namespace",width:130,dataIndex:"namespaceName"},{key:"Labels",dataIndex:"labels"},{key:"Hosts",dataIndex:"hosts"},{key:"Creation Timestamp",dataIndex:"createdAt",sorter:!0},{key:"Action",width:130,dataIndex:"action"}];var y={name:"IngressList",components:{EnvSelector:p.Z,MoreOutlined:h.Z,PlusCircleTwoTone:g.Z,SyncBar:m.Z},props:["hasSearch"],i18n:a(89234),data(){return{pageNo:1,syncLoading:-1,pageSize:10,total:0,key:"",columns:w,sorter:"name",sortOrder:"asc",loading:!0,list:[]}},computed:{dataColumns(){return this.columns.map((t=>(t.title=this.$t(t.key),t.sorter&&this.sorter==t.dataIndex&&(t.sortOrder=this.sortOrder),t)))},start(){return(this.pageNo-1)*this.pageSize}},created(){this.sync(!0)},methods:{sync(t){t&&(this.syncLoading=0,this.$gql.mutation("fetchIngresses").then((()=>{this.syncLoading=100,this.search(),setTimeout((()=>{this.syncLoading=-1}),1e3)}))),this.syncLoading<90&&(this.syncLoading+=10,setTimeout((()=>{this.sync()}),100))},remove(t){this.$gql.mutation(`deleteIngressSync(id:${t}){data{id}}`).then((()=>{this.$message.success(this.$t("Deleted successfully"),3),this.search()}))},newItem(){this.$router.push({path:"/fsm/ingress/create"})},detail(t){this.$router.push({path:`/fsm/ingress/detail/${t}`})},sort(t,e,a){this.sorter=a.field,this.sortOrder=a.order,this.search()},search(t,e){t&&(this.pageNo=t,this.pageSize=e);let a={start:this.start,limit:this.pageSize};this.loading=!0;let n={};n.name={contains:this.key};let s="name:asc";this.sorter&&this.sortOrder&&(s=this.sortOrder.replace(/end/g,""),s=s.replace(/\$/g,""),s=`${this.sorter}:${s}`),this.$gql.query(`getIngresses(filters: $filters, pagination: $pagination, sort: "${s}"){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t\t}}},\n\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}`,{filters:n,pagination:a},{filters:"IngressFiltersInput",pagination:"PaginationArg"}).then((t=>{this.list=this.reset(t.data),this.total=t.pagination.total,this.loading=!1}))},reset(t){for(let e=0;e<t.length;e++){let a=t[e].content;t[e].namespaceName=t[e].namespace.name,t[e].labels=a.metadata.labels?a.metadata.labels:{},t[e].hosts=a.hosts,t[e].createdAt=new Date(t[e].createdAt).toLocaleString()}return t}}},k=a(83744);var f={name:"Ingresss",components:{IngressList:(0,k.Z)(y,[["render",function(t,e,a,p,h,g){const m=(0,n.up)("a-input-search"),w=(0,n.up)("a-divider"),y=(0,n.up)("PlusCircleTwoTone"),k=(0,n.up)("a-button"),f=(0,n.up)("SyncBar"),v=(0,n.up)("EnvSelector"),$=(0,n.up)("a-tag"),b=(0,n.up)("a-menu-item"),_=(0,n.up)("a-popconfirm"),I=(0,n.up)("a-menu"),C=(0,n.up)("MoreOutlined"),S=(0,n.up)("a-dropdown"),z=(0,n.up)("a-table"),x=(0,n.up)("a-card"),W=(0,n.Q2)("permission");return(0,n.wg)(),(0,n.j4)(x,{class:"card nopd",title:t.$t("Ingress"),loading:h.loading},(0,n.Nv)({default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(z,{pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:g.search,onChange:g.search,current:h.pageNo,pageSize:h.pageSize,showTotal:(e,a)=>`${t.$t("Total")} ${e}`,total:h.total},onChange:g.sort,columns:g.dataColumns,"data-source":h.list,class:"bg-white"},{bodyCell:(0,n.w5)((({column:e,record:a})=>["name"===e.dataIndex?((0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("a",{href:"javascript:void(0)",onClick:t=>g.detail(a.id)},(0,s.zw)(a.name),9,o)])):"labels"===e.dataIndex?((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[a.content.metadata&&a.content.metadata.labels?((0,n.wg)(),(0,n.iD)("div",l,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(Object.keys(a.content.metadata.labels),((t,e)=>((0,n.wg)(),(0,n.j4)($,{key:e,closable:!1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(t)+":"+(0,s.zw)(a.content.metadata.labels[t]),1)])),_:2},1024)))),128))])):(0,n.kq)("",!0)],64)):"hosts"===e.dataIndex?((0,n.wg)(),(0,n.iD)("div",c,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.content.spec.rules,((t,e)=>(0,n.wy)(((0,n.wg)(),(0,n.j4)($,{key:e,closable:!1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(t.host),1)])),_:2},1024)),[[i.F8,t.host]]))),128))])):"action"===e.dataIndex?((0,n.wg)(),(0,n.iD)("div",d,[(0,n.Wm)(S,null,{overlay:(0,n.w5)((()=>[(0,n.Wm)(I,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.wy)(((0,n.wg)(),(0,n.iD)("a",{onClick:t=>g.detail(a.id)},[(0,n.Uk)((0,s.zw)(t.$t("edit")),1)],8,u)),[[W,["ingress:update"]]])])),_:2},1024),(0,n.Wm)(b,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,{placement:"topLeft","ok-text":t.$t("Yes"),"cancel-text":t.$t("No"),onConfirm:t=>g.remove(a.id)},{title:(0,n.w5)((()=>[(0,n._)("p",null,(0,s.zw)(t.$t("Tip")),1),(0,n._)("p",null,(0,s.zw)(t.$t("Are you sure to delete this?")),1)])),default:(0,n.w5)((()=>[(0,n.wy)(((0,n.wg)(),(0,n.iD)("a",null,[(0,n.Uk)((0,s.zw)(t.$t("delete")),1)])),[[W,["ingress:delete"]]])])),_:2},1032,["ok-text","cancel-text","onConfirm"])])),_:2},1024)])),_:2},1024)])),default:(0,n.w5)((()=>[(0,n._)("a",null,[(0,n.Wm)(C)])])),_:2},1024)])):(0,n.kq)("",!0)])),_:1},8,["pagination","onChange","columns","data-source"])])])),_:2},[a.hasSearch?{name:"extra",fn:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(m,{value:h.key,"onUpdate:value":e[0]||(e[0]=t=>h.key=t),onSearch:e[1]||(e[1]=t=>g.search()),class:"right-search-input",placeholder:t.$t("search")},null,8,["value","placeholder"]),(0,n.wy)((0,n.Wm)(w,{type:"vertical"},null,512),[[W,["ingress:create"]]]),(0,n.wy)(((0,n.wg)(),(0,n.j4)(k,{type:"link",shape:"circle",onClick:g.newItem},{icon:(0,n.w5)((()=>[(0,n.Wm)(y,{class:"font-20 icon-menu-sm rotate-icon"})])),_:1},8,["onClick"])),[[W,["ingress:create"]]]),(0,n.wy)((0,n.Wm)(w,{type:"vertical"},null,512),[[W,["ingress:create"]]]),(0,n.wy)((0,n.Wm)(f,{percent:h.syncLoading,onSync:e[2]||(e[2]=t=>g.sync(!0))},null,8,["percent"]),[[W,["ingress:create"]]]),(0,n.Wm)(w,{type:"vertical"}),(0,n.Wm)(v)])])),key:"0"}:void 0]),1032,["title","loading"])}],["__scopeId","data-v-291d4ecc"]])},i18n:a(89234),data(){return{}},created(){}};var v=(0,k.Z)(f,[["render",function(t,e,a,s,i,r){const o=(0,n.up)("IngressList");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(o,{"has-search":!0})])}]])}}]);