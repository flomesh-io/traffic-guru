"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[5523],{60300:function(t,e,n){n.d(e,{Z:function(){return u}});var a=n(66252),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},r=n(33058);function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),a.forEach((function(e){c(t,e,n[e])}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(t,e){var n=o({},t,e.attrs);return(0,a.Wm)(r.Z,o({},n,{icon:i}),null)};l.displayName="DatabaseOutlined",l.inheritAttrs=!1;var u=l},29253:function(t,e,n){var a=n(82109),i=n(14230);a({target:"String",proto:!0,forced:n(43429)("fixed")},{fixed:function(){return i(this,"tt","","")}})},75523:function(t,e,n){n.d(e,{Z:function(){return I}});n(74916),n(64765),n(92222),n(68309);var a=n(66252),i=n(3577),r={key:0},o={key:1},c={key:0},l=["onClick"];n(21249),n(57327),n(41539),n(54747),n(57658),n(33948);var u=n(96486),s=n.n(u),d=n(2692),p=n(60459),v={class:"full"},m=["onClick"];var f=n(95082),h=n(76754);n(29253);var g=n(87202),y=n(99684),w={name:"CardGroup",components:{DeleteOutlined:g.Z,PlusCircleTwoTone:y.Z},props:["cards","col","fixed"],emits:["add","remove"],data:function(){return{}},computed:{},watch:{},created:function(){},methods:{add:function(){this.$emit("add",{})},remove:function(t){this.$emit("remove",t)}}},k=n(83744);var b=(0,k.Z)(w,[["render",function(t,e,n,i,r,o){var c=(0,a.up)("a-divider"),l=(0,a.up)("DeleteOutlined"),u=(0,a.up)("PlusCircleTwoTone"),s=(0,a.up)("a-card"),d=(0,a.up)("a-col"),p=(0,a.up)("a-row");return(0,a.wg)(),(0,a.j4)(p,{class:"row-mg"},{default:(0,a.w5)((function(){return[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.cards,(function(e,i){return(0,a.wg)(),(0,a.j4)(d,{key:i,class:"col-pd mb-20",xl:24/(n.col||2),lg:24,md:24,sm:24,xs:24},{default:(0,a.w5)((function(){return[(0,a.Wm)(s,null,{title:(0,a.w5)((function(){return[(0,a.WI)(t.$slots,"title",{item:e,index:i})]})),extra:(0,a.w5)((function(){return[(0,a.WI)(t.$slots,"extra",{item:e,index:i}),!n.fixed&&n.cards.length>1?((0,a.wg)(),(0,a.j4)(c,{key:0,type:"vertical"})):(0,a.kq)("",!0),!n.fixed&&n.cards.length>1?((0,a.wg)(),(0,a.j4)(l,{key:1,onClick:function(t){return o.remove(i)},class:"font-20 font-primary icon-menu primary"},null,8,["onClick"])):(0,a.kq)("",!0),n.fixed||n.cards.length-1!=i?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(c,{key:2,type:"vertical"})),n.fixed||n.cards.length-1!=i?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(u,{key:3,onClick:o.add,class:"font-20 font-primary icon-menu primary rotate-icon"},null,8,["onClick"]))]})),_:2},1024),(0,a.WI)(t.$slots,"default",{item:e,index:i})]})),_:2},1032,["xl"])})),128))]})),_:3})}]]),x=n(33907),$=n(60300),S={name:"ServiceImportCard",components:{FormItem:h.Z,CardGroup:b,DatabaseOutlined:$.Z},props:["d"],i18n:n(89234),computed:(0,f.Z)({},(0,x.rn)("rules",["rules"])),methods:{detail:function(t,e){this.$router.push({path:"/fsm/service/detail/".concat(e||"default","/").concat(t)})}}};var _=(0,k.Z)(S,[["render",function(t,e,n,r,o,c){var l=(0,a.up)("a-descriptions-item"),u=(0,a.up)("a-switch"),s=(0,a.up)("a-radio-button"),d=(0,a.up)("a-radio-group"),p=(0,a.up)("a-descriptions"),f=(0,a.up)("DatabaseOutlined"),h=(0,a.up)("a-input-number"),g=(0,a.up)("FormItem"),y=(0,a.up)("CardGroup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(p,{bordered:"",class:"bg-white mb-15"},{default:(0,a.w5)((function(){return[(0,a.Wm)(l,{label:t.$t("Namespace"),span:2},{default:(0,a.w5)((function(){var t;return[(0,a.Uk)((0,i.zw)(null===(t=n.d.registry)||void 0===t?void 0:t.name)+"/"+(0,i.zw)(n.d.namespace),1)]})),_:1},8,["label"]),(0,a.Wm)(l,{label:t.$t("Enabled"),span:1},{default:(0,a.w5)((function(){return[(0,a.Wm)(u,{class:"relative",style:{top:"-3px"},checked:n.d.policySwitch,"onUpdate:checked":e[0]||(e[0]=function(t){return n.d.policySwitch=t})},null,8,["checked"])]})),_:1},8,["label"]),(0,a.Wm)(l,{label:t.$t("Type"),span:3},{default:(0,a.w5)((function(){return[(0,a.Wm)(d,{value:n.d.content.type,"onUpdate:value":e[1]||(e[1]=function(t){return n.d.content.type=t})},{default:(0,a.w5)((function(){return[(0,a.Wm)(s,{value:"Locality"},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("Locality")),1)]})),_:1}),(0,a.Wm)(s,{value:"FailOver"},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("FailOver")),1)]})),_:1}),(0,a.Wm)(s,{value:"ActiveActive"},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("ActiveActive")),1)]})),_:1})]})),_:1},8,["value"])]})),_:1},8,["label"])]})),_:1}),n.d.content&&n.d.content.targets&&n.d.serviceExports?((0,a.wg)(),(0,a.j4)(y,{key:0,fixed:!0,col:3,cards:n.d.serviceExports},{title:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.$t("Export")),1)]})),extra:(0,a.w5)((function(t){var e=t.item;return[(0,a.Wm)(u,{class:"relative",style:{top:"-3px"},checked:n.d.content.targets[e.id].enabled,"onUpdate:checked":function(t){return n.d.content.targets[e.id].enabled=t}},null,8,["checked","onUpdate:checked"])]})),default:(0,a.w5)((function(e){var r=e.item;return[(0,a.Wm)(p,{bordered:"",class:"bg-white"},{default:(0,a.w5)((function(){return[(0,a.Wm)(l,{label:t.$t("Namespace"),span:3},{default:(0,a.w5)((function(){var t;return[(0,a.Uk)((0,i.zw)(null===(t=r.service.registry)||void 0===t?void 0:t.name)+" / "+(0,i.zw)(r.service.namespace),1)]})),_:2},1032,["label"]),n.d.content.targets[r.id]?((0,a.wg)(),(0,a.j4)(l,{key:0,label:t.$t("Service"),span:3},{default:(0,a.w5)((function(){return[(0,a._)("div",v,[(0,a.Wm)(f,{class:"font-20 mr-10 primary"}),(0,a._)("a",{class:"pointer relative",style:{top:"-2px"},onClick:function(t){return c.detail(r.service.id,r.service.namespace)}},[(0,a._)("b",null,(0,i.zw)(r.service.name),1)],8,m)])]})),_:2},1032,["label"])):(0,a.kq)("",!0),"ActiveActive"==n.d.content.type?((0,a.wg)(),(0,a.j4)(l,{key:1,label:t.$t("Weight"),span:3},{default:(0,a.w5)((function(){return[(0,a.Wm)(g,{name:["content","targets",r.id,"weight"],rules:t.rules.weight},{default:(0,a.w5)((function(){return[(0,a.Wm)(h,{value:n.d.content.targets[r.id].weight,"onUpdate:value":function(t){return n.d.content.targets[r.id].weight=t},min:1},null,8,["value","onUpdate:value"])]})),_:2},1032,["name","rules"])]})),_:2},1032,["label"])):(0,a.kq)("",!0)]})),_:2},1024)]})),_:1},8,["cards"])):(0,a.kq)("",!0)],64)}]]),z=[{key:"Registry",dataIndex:"registry.name"},{key:"Namespace",width:130,dataIndex:"namespace"},{key:"Exports",dataIndex:"serviceExports"},{key:"Policy",dataIndex:"policy"},{key:"Action",width:130,dataIndex:"action"}],W={name:"ServiceImportList",components:{MoreOutlined:d.Z,EnvSelector:p.Z,ServiceImportCard:_},props:["embed","serviceExport"],i18n:n(89234),data:function(){return{key:"",syncLoading:-1,pageNo:1,pageSize:10,total:0,columns:z,loading:!0,visible:!1,payload:{content:{type:"Locality",enabled:!0,targets:[{enabled:!0,weight:10},{enabled:!0,weight:20}]},serviceExports:[{service:{name:"service A"}},{service:{name:"service B"}}],registry:{name:"Reg A"},namespace:{name:"NS A"}},list:[]}},computed:{start:function(){return(this.pageNo-1)*this.pageSize},dataColumns:function(){var t=this;return this.columns.filter((function(e){return"Organization"!=e.key||t.$isPro})).map((function(e){return e.title=t.$t(e.key),e}))}},created:function(){this.search()},methods:{valid:function(){var t=this;this.$refs.form.validateFields().then((function(){t.save()})).catch((function(){}))},save:function(){var t=this,e=s().cloneDeep(this.payload);e.registry=this.payload.registry.id,e.serviceExports=[],this.payload.serviceExports&&this.payload.serviceExports.forEach((function(t){e.serviceExports.push(t.id)}));var n=e.id;delete e.id,this.$gql.mutation("updateServiceImport(id:".concat(n,", data: $data){data{id}}"),{data:e},{data:"ServiceImportInput!"}).then((function(){t.visible=!1,t.search(),t.$message.success(t.$t("Save successfully"),3)}))},edit:function(t){var e=this;this.payload=s().cloneDeep(t),this.visible=!0,this.payload.content||(this.payload.content={}),this.payload.content.type||(this.payload.content.type="Locality"),null==this.payload.policySwitch&&(this.payload.policySwitch=!0),this.payload.serviceExports&&(this.payload.content.targets&&"object"==typeOf(this.payload.content.targets)||(this.payload.content.targets={}),this.payload.serviceExports.forEach((function(t){var n,a=t.id,i=null===(n=t.service)||void 0===n?void 0:n.registry;e.payload.content.targets[a]||(e.payload.content.targets[a]={registry:i,weight:0,enabled:!1})})))},search:function(t,e){var n=this;t&&(this.pageNo=t,this.pageSize=e);var a={start:this.start,limit:this.pageSize};this.loading=!0;var i={};i.name={contains:this.key},this.embed&&(i.serviceExports={id:{eq:this.serviceExport}}),this.$gql.query("serviceImports(filters: $filters, pagination: $pagination){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\tpolicySwitch,\n\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\tserviceExports{data{id,attributes{\n\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\tservice{data{id,attributes{\n\t\t\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\t\t\tnamespace,\n\t\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}},\n\t\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t\t\t}}}\n\t\t\t\t\t\t\t}}}\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}",{filters:i,pagination:a},{filters:"ServiceImportFiltersInput",pagination:"PaginationArg"}).then((function(t){n.list=n.reset(t.values),n.total=t.pagination.total,n.loading=!1}))},reset:function(t){return t||[]}}};var I=(0,k.Z)(W,[["render",function(t,e,n,u,s,d){var p=(0,a.up)("a-input-search"),v=(0,a.up)("a-divider"),m=(0,a.up)("EnvSelector"),f=(0,a.up)("a-tag"),h=(0,a.up)("a-menu-item"),g=(0,a.up)("a-menu"),y=(0,a.up)("MoreOutlined"),w=(0,a.up)("a-dropdown"),k=(0,a.up)("a-table"),b=(0,a.up)("a-card"),x=(0,a.up)("ServiceImportCard"),$=(0,a.up)("a-form"),S=(0,a.up)("a-modal"),_=(0,a.Q2)("permission");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(b,{class:"card nopd",loading:s.loading},{title:(0,a.w5)((function(){return[(0,a.Uk)((0,i.zw)(t.title?t.title:t.$t("Service Imports")),1)]})),extra:(0,a.w5)((function(){return[n.embed?((0,a.wg)(),(0,a.iD)("div",r,[(0,a.WI)(t.$slots,"extra")])):(0,a.kq)("",!0),t.hasSearch?((0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(p,{value:s.key,"onUpdate:value":e[0]||(e[0]=function(t){return s.key=t}),onSearch:e[1]||(e[1]=function(t){return d.search()}),class:"right-search-input",placeholder:t.$t("search")},null,8,["value","placeholder"]),n.embed?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(v,{key:0,type:"vertical"})),n.embed?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(m,{key:1}))])):(0,a.kq)("",!0)]})),default:(0,a.w5)((function(){return[(0,a._)("div",null,[(0,a.Wm)(k,{pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:d.search,onChange:d.search,current:s.pageNo,pageSize:s.pageSize,showTotal:function(e,n){return"".concat(t.$t("Total")," ").concat(e)},total:s.total},columns:d.dataColumns,"data-source":s.list,class:"bg-white"},{bodyCell:(0,a.w5)((function(e){var n,r=e.column,o=e.record;return["registry.name"===r.dataIndex?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)((0,i.zw)(null===(n=o.registry)||void 0===n?void 0:n.name),1)],64)):"policy"===r.dataIndex?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,i.zw)(o.content?t.$t(o.content.type):t.$t("unset")),1)],64)):"serviceExports"===r.dataIndex?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[o.serviceExports?((0,a.wg)(),(0,a.iD)("div",c,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.serviceExports,(function(t,e){return(0,a.wg)(),(0,a.j4)(f,{key:e,closable:!1},{default:(0,a.w5)((function(){var e,n,r,o;return[(0,a.Uk)((0,i.zw)(null==t||null===(e=t.service)||void 0===e||null===(n=e.registry)||void 0===n?void 0:n.name)+" / "+(0,i.zw)(null==t||null===(r=t.service)||void 0===r?void 0:r.namespace)+" / "+(0,i.zw)(null==t||null===(o=t.service)||void 0===o?void 0:o.name),1)]})),_:2},1024)})),128))])):(0,a.kq)("",!0)],64)):"action"===r.dataIndex?((0,a.wg)(),(0,a.j4)(w,{key:3},{overlay:(0,a.w5)((function(){return[(0,a.Wm)(g,null,{default:(0,a.w5)((function(){return[(0,a.Wm)(h,null,{default:(0,a.w5)((function(){return[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:function(t){return d.edit(o)}},[(0,a.Uk)((0,i.zw)((o.content&&o.content.type?t.$t("edit"):t.$t("create"))+" "+t.$t("Policy")),1)],8,l)),[[_,["service:update"]]])]})),_:2},1024)]})),_:2},1024)]})),default:(0,a.w5)((function(){return[(0,a._)("a",null,[(0,a.Wm)(y)])]})),_:2},1024)):(0,a.kq)("",!0)]})),_:1},8,["pagination","columns","data-source"])])]})),_:3},8,["loading"]),(0,a.Wm)(S,{visible:s.visible,"onUpdate:visible":e[3]||(e[3]=function(t){return s.visible=t}),title:"MCS "+t.$t("Policy"),onOk:d.valid,width:"80%","ok-text":t.$t("Save")},{default:(0,a.w5)((function(){return[(0,a.Wm)($,{model:s.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,a.w5)((function(){return[(0,a.Wm)(x,{d:s.payload,"onUpdate:d":e[2]||(e[2]=function(t){return s.payload=t})},null,8,["d"])]})),_:1},8,["model"])]})),_:1},8,["visible","title","onOk","ok-text"])],64)}]])}}]);