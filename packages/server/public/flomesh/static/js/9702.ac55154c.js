"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[9702],{49702:function(e,t,a){a.d(t,{Z:function(){return j}});var s=a(66252),i=a(3577),l=a(49963);const n={class:"mb-10"},o={class:"log-filter-title"},h={class:"flex"},r={class:"pl-30"},d={class:"flex-item2 pr-20"},p={key:0,class:"flex-item search-warpper"},u={class:"inline-block"},c={key:1,class:"inline-block"},g=["onClick"],m={class:"flex"},w={class:"flex-item pd-x-15"},v={key:0,class:"icon","aria-hidden":"true"},y=["xlink:href"],k={key:1,class:"icon","aria-hidden":"true"},f=[(e=>((0,s.dD)("data-v-072864cc"),e=e(),(0,s.Cn)(),e))((()=>(0,s._)("use",{"xlink:href":"#icon-info"},null,-1)))],_=["onClick"],D={key:0},b={key:1},S={key:2},$={key:3};a(57658);var C=a(50128),q=a(48551),z=a(49568),W=a(84471),x=a(26917),V=a(21936),L=a(87849),M=a(13471),A=a(33907),E=a(72167);const N={" ":x.S6,AND:x.S6,OR:x.S6,and:x.S6,or:x.S6,"=":["http","tcp","GET","POST","PUT","DELETE"]};var T={name:"LogViewer",i18n:a(89234),components:{DownOutlined:L.Z,FieldTimeOutlined:M.Z,JsonEditor:V.Z,MiniArea:q.Z,MiniBar:C.Z,MiniSector:z.Z},props:["type","uid","noSearch","params","logLevel","selected","hideChart","pageSize"],data(){return{pipy:null,logLevels:["None","Main","All"],logLevelVal:null,selectedVal:null,pipys:[],dateVal:[60,100],sqlDateMap:{0:"1 month",10:"15 day",20:"7 day",30:"3 day",40:"1 day",50:"12 hour",60:"6 hour",70:"1 hour",80:"30 minute",90:"5 minute",100:"1 second"},marks:{},name:"",date:"",log:"{}",arrow:"desc",visible:!1,select_keys:x.S6,WHERE_DATA:N,endDate:"",sortBy:"timestamp",prefix:" ",filter:"",loading:!0,tps:[],latency:[],status:[],statusColors:[],tpsCnt:0,pagging:{pageNo:1,total:0},data:[],key:[]}},computed:{...(0,A.rn)("setting",["layout","pageWidth"]),datamarks(){return this.marks={0:"1"+this.$t(" Mths"),10:"15"+this.$t(" D"),20:"7"+this.$t(" D"),30:"3"+this.$t(" D"),40:"1"+this.$t(" D"),50:"12"+this.$t(" H"),60:"6"+this.$t(" H"),70:"1"+this.$t(" H"),80:"30"+this.$t(" M"),90:"5"+this.$t(" M"),100:this.$t(" At present")},this.marks}},watch:{logLevelVal:{deep:!0,handler(){this.$emit("update:logLevel",this.logLevelVal)}}},created(){this.logLevelVal=this.logLevel,this.selectedVal=this.selected,this.getData()},methods:{changeSelected(e){this.$emit("update:selected",e);let t=[];e.forEach((e=>{t.push(this.data[e])})),this.$emit("changeSelected",t)},emitSave(e){this.$emit("save",{logLevel:e.target.value})},onDateChange(e){this.dateVal=e,this.getData()},setPipy(e){this.pipy=e,this.getData()},getWhere(){let e=[];if(this.uid)switch(this.type){case"4lb":e.push(`x_parameters.a4lbid ='${this.uid}'`);break;case"7lb":e.push(`x_parameters.7lbid ='${this.uid}'`);break;case"api":e.push(`x_parameters.aid ='${this.uid}'`);break;case"mesh":e.push(`meshName ='${this.params.name}'`);break;case"service":e.push((0,x.lh)(null,this.params.name,this.params.namespace,this.params.domain));break;case"app":e.push(`x_parameters.appid ='${this.uid}'`)}return this.pipy&&e.push(`x_parameters.igid = '${this.pipy.id}'`),this.key&&e.push(`message like '%${this.key}%'`),e.join(" AND ")},getData(e){if(e&&(this.pagging.pageNo=e),this.loading=!0,this.data=[],this.filter=this.getWhere(),(0,x.hT)(this.pagging.pageNo,this.pageSize||10,this.filter,this.sortBy,this.arrow,null,null,this.sqlDateMap[this.dateVal[0]],this.sqlDateMap[this.dateVal[1]],this.type,this.uid).then((0,W.hw)(((e,t)=>{this.loading=!1,this.pagging.total=1*e.data,this.data=(0,x.OI)(t),this.logLevelVal=this.logLevel,this.selectedVal=this.selected}))).catch((e=>{})),this.$gql.query('fleets(filters:{type:{eq:"pipy"}}){data{id,attributes{name}}}').then((e=>{this.pipys=e.data})),!this.hideChart){(0,x.lD)(this.pagging.pageNo,this.pageSize||10,this.filter,this.sortBy,this.arrow,null,null,this.sqlDateMap[this.dateVal[0]],this.sqlDateMap[this.dateVal[1]],this.type,this.uid).then((e=>{let t=(0,x.tl)(e);this.latency=[],t.forEach((e=>{let t={};t.type=this.type,t.value=e[1],t.date=500*e[0]+"ms",this.latency.push(t)}))}));const e=["#8bd4a1","#8bd4a1","#8bd4a1","#fac858","#fb9690","#fb9690"];(0,x.NL)(this.pagging.pageNo,this.pageSize||10,this.filter,this.sortBy,this.arrow,null,null,this.sqlDateMap[this.dateVal[0]],this.sqlDateMap[this.dateVal[1]],this.type,this.uid).then((t=>{let a=(0,x.tl)(t);this.status=[],a.forEach((t=>{let a={};a.type=this.type,a.value=t[0],a.name=t[1],this.status.push(a),this.statusColors.push(e[1*(t[1]+"").substr(0,1)])}))})),(0,x.PT)(this.pagging.pageNo,this.pageSize||10,this.filter,this.sortBy,this.arrow,null,null,this.sqlDateMap[this.dateVal[0]],this.sqlDateMap[this.dateVal[1]],this.type,this.uid).then((0,W.hw)(((e,t)=>{let a=(0,x.tl)(e);this.tpsCnt=t.data,this.tps=[],a.forEach((e=>{let t={};t.type=this.type,t.value=e[0],t.date=(0,E.Z)(new Date(e[1]),"yyyy-MM-dd HH:mm"),this.tps.push(t)}))}))).catch((e=>{}))}},detail(e){this.visible=!0,this.log=(0,x.Ny)({data:e})},onSearch(){this.getData()},orderBy(e,t){this.sortBy=e.replace(/\./g,"_"),this.arrow=t,this.getData()},onClose(){this.visible=!1}}};var j=(0,a(83744).Z)(T,[["render",function(e,t,a,C,q,z){const W=(0,s.up)("a-radio"),x=(0,s.up)("a-radio-group"),V=(0,s.up)("FieldTimeOutlined"),L=(0,s.up)("a-slider"),M=(0,s.up)("a-input-search"),A=(0,s.up)("a-divider"),E=(0,s.up)("DownOutlined"),N=(0,s.up)("a-menu-item"),T=(0,s.up)("a-menu"),j=(0,s.up)("a-dropdown"),H=(0,s.up)("JsonEditor"),B=(0,s.up)("a-drawer"),P=(0,s.up)("a-tag"),Z=(0,s.up)("a-list-item-meta"),O=(0,s.up)("a-checkbox"),U=(0,s.up)("a-list-item"),F=(0,s.up)("a-list"),R=(0,s.up)("a-checkbox-group"),Y=(0,s.up)("a-card"),J=(0,s.up)("a-col"),K=(0,s.up)("MiniSector"),G=(0,s.up)("MiniArea"),I=(0,s.up)("MiniBar"),Q=(0,s.up)("a-row");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.wy)((0,s._)("div",n,[(0,s._)("span",o,(0,i.zw)(e.$t("Log Record Level"))+":",1),(0,s.Wm)(x,{onChange:z.emitSave,value:q.logLevelVal,"onUpdate:value":t[0]||(t[0]=e=>q.logLevelVal=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(q.logLevels,((t,a)=>((0,s.wg)(),(0,s.j4)(W,{key:a,value:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(e.$t(t)),1)])),_:2},1032,["value"])))),128))])),_:1},8,["onChange","value"])],512),[[l.F8,q.logLevelVal]]),(0,s.Wm)(Q,{class:"row-mg"},{default:(0,s.w5)((()=>[(0,s.Wm)(J,{class:"col-pd",xl:a.hideChart?24:16,lg:24,md:24,sm:24,xs:24},{default:(0,s.w5)((()=>[(0,s.Wm)(Y,{class:"search-content",loading:q.loading},{title:(0,s.w5)((()=>[(0,s._)("div",h,[(0,s._)("div",r,[(0,s.Wm)(V,{class:"FieldTimeOutlined"})]),(0,s._)("div",d,[(0,s.Wm)(L,{range:"",class:"slider-dot",onChange:z.onDateChange,"tooltip-visible":!1,marks:z.datamarks,step:null,"default-value":q.dateVal},null,8,["onChange","marks","default-value"])]),a.noSearch?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("div",u,[(0,s.Wm)(M,{value:q.key,"onUpdate:value":t[1]||(t[1]=e=>q.key=e),onSearch:z.onSearch,class:"right-search-input",placeholder:e.$t("search")},null,8,["value","onSearch","placeholder"])]),"api"==a.type?((0,s.wg)(),(0,s.j4)(A,{key:0,type:"vertical"})):(0,s.kq)("",!0),"api"==a.type?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(j,null,{overlay:(0,s.w5)((()=>[(0,s.Wm)(T,null,{default:(0,s.w5)((()=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[(0,s._)("a",{href:"javascript:void(0);",onClick:t[3]||(t[3]=e=>z.setPipy(null)),class:"uppercase"},(0,i.zw)(e.$t("All")),1)])),_:1}),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(q.pipys,((e,t)=>((0,s.wg)(),(0,s.j4)(N,{key:t},{default:(0,s.w5)((()=>[(0,s._)("a",{href:"javascript:void(0);",onClick:t=>z.setPipy(e),class:"uppercase"},(0,i.zw)(e.name),9,g)])),_:2},1024)))),128))])),_:1})])),default:(0,s.w5)((()=>[(0,s._)("b",{class:"ant-dropdown-link font-primary uppercase",onClick:t[2]||(t[2]=(0,l.iM)((()=>{}),["prevent"]))},[(0,s.Uk)((0,i.zw)(q.pipy&&q.pipy.name||e.$t("Pipy"))+" ",1),(0,s.Wm)(E)])])),_:1})])):(0,s.kq)("",!0)]))])])),default:(0,s.w5)((()=>[(0,s._)("div",m,[q.visible?((0,s.wg)(),(0,s.j4)(B,{key:0,"get-container":!1,title:e.$t("log"),placement:"bottom",height:"600",closable:!1,visible:q.visible,onClose:z.onClose},{default:(0,s.w5)((()=>[(0,s.Wm)(H,{"is-readonly":!0,value:q.log},null,8,["value"])])),_:1},8,["title","visible","onClose"])):(0,s.kq)("",!0),(0,s._)("div",w,[(0,s.Wm)(R,{onChange:z.changeSelected,value:q.selectedVal,"onUpdate:value":t[4]||(t[4]=e=>q.selectedVal=e),style:{width:"100%"}},{default:(0,s.w5)((()=>[(0,s.Wm)(F,{"item-layout":"vertical",pagination:{showSizeChanger:!1,showQuickJumper:!1,onShowSizeChange:z.getData,onChange:z.getData,current:q.pagging.pageNo,pageSize:a.pageSize||10,showTotal:(t,a)=>`${e.$t("Total")} ${t}`,total:q.pagging.total}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(q.data,((e,t)=>((0,s.wg)(),(0,s.j4)(U,{key:e},{actions:(0,s.w5)((()=>[e["res.status"]>0?((0,s.wg)(),(0,s.iD)("span",D,"Status "+(0,i.zw)(e["res.status"]),1)):(0,s.kq)("",!0),(0,s._)("span",null,[(0,s.Wm)(V),(0,s.Uk)(" "+(0,i.zw)(e.timestamp),1)]),e.remoteAddr?((0,s.wg)(),(0,s.iD)("span",b,"Remote "+(0,i.zw)(e.remoteAddr)+" : "+(0,i.zw)(e.remotePort),1)):(0,s.kq)("",!0),e.localAddr?((0,s.wg)(),(0,s.iD)("span",S,"Local "+(0,i.zw)(e.localAddr)+" : "+(0,i.zw)(e.localPort),1)):(0,s.kq)("",!0),e.resSize&&e.resSize>0?((0,s.wg)(),(0,s.iD)("span",$,"Size:"+(0,i.zw)(e.resSize/1e3)+" kb ",1)):(0,s.kq)("",!0)])),extra:(0,s.w5)((()=>[null!=a.selected?((0,s.wg)(),(0,s.j4)(O,{key:0,value:t},null,8,["value"])):(0,s.kq)("",!0)])),default:(0,s.w5)((()=>[(0,s.Wm)(Z,{class:"log-viewer-list-meta"},{avatar:(0,s.w5)((()=>[1*e["res.status"]>=200&&1*e["res.status"]<600?((0,s.wg)(),(0,s.iD)("svg",v,[(0,s._)("use",{"xlink:href":["#icon-success","#icon-success","#icon-success","#icon-warning","#icon-error","#icon-error"][1*(e["res.status"]+"").substr(0,1)]},null,8,y)])):((0,s.wg)(),(0,s.iD)("svg",k,f))])),title:(0,s.w5)((()=>[(0,s._)("a",{href:"javascript:void(0)",class:"mr-16 pointer",onClick:t=>z.detail(e.message)},(0,i.zw)(e["req.path"]||e["pod.name"]),9,_),e["req.method"]?((0,s.wg)(),(0,s.j4)(P,{key:0,color:"GET"==e["req.method"]?"green":"blue"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(e["req.method"]),1)])),_:2},1032,["color"])):(0,s.kq)("",!0)])),description:(0,s.w5)((()=>[])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["pagination"])])),_:1},8,["onChange","value"])])])])),_:1},8,["loading"])])),_:1},8,["xl"]),a.hideChart?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(J,{key:0,class:"col-pd",xl:8,lg:24,md:24,sm:24,xs:24},{default:(0,s.w5)((()=>[(0,s.Wm)(Y,{class:"card mb-15 nopd",loading:q.loading,title:e.$t("Load Status")},{default:(0,s.w5)((()=>[(0,s.Wm)(K,{colors:q.statusColors,dv:q.status,height:200,padding:[0,0,0,0]},null,8,["colors","dv"])])),_:1},8,["loading","title"]),(0,s.Wm)(Y,{class:"card mb-15 nopd",loading:q.loading,title:e.$t("tps")},{default:(0,s.w5)((()=>[(0,s.Wm)(G,{id:a.type,colors:["#8be4c1"],dv:q.tps,height:200,padding:[0,0,0,0],axis:!1,unit:"",showy:!1},null,8,["id","dv"])])),_:1},8,["loading","title"]),(0,s.Wm)(Y,{class:"card nopd",loading:q.loading,title:e.$t("Latency")},{default:(0,s.w5)((()=>[(0,s.Wm)(I,{colors:["#8be4c1"],id:a.type,dv:q.latency,height:200,padding:[0,0,0,0],showy:!1,axis:!1},null,8,["id","dv"])])),_:1},8,["loading","title"])])),_:1}))])),_:1})],64)}],["__scopeId","data-v-072864cc"]])}}]);