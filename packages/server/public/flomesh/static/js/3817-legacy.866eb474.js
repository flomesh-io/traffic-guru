"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[3817],{68757:function(_,e,t){var a=t(82109),r=t(46916),s=t(1702),n=t(84488),i=t(60614),o=t(68554),c=t(47850),l=t(41340),d=t(58173),u=t(34706),p=t(10647),E=t(5112),h=t(31913),m=E("replace"),f=TypeError,D=s("".indexOf),g=s("".replace),O=s("".slice),M=Math.max,w=function(_,e,t){return t>_.length?-1:""===e?t:D(_,e,t)};a({target:"String",proto:!0},{replaceAll:function(_,e){var t,a,s,E,P,T,b,j,I,k=n(this),C=0,v=0,U="";if(!o(_)){if((t=c(_))&&(a=l(n(u(_))),!~D(a,"g")))throw f("`.replaceAll` does not allow non-global regexes");if(s=d(_,m))return r(s,_,k,e);if(h&&t)return g(l(k),_,e)}for(E=l(k),P=l(_),(T=i(e))||(e=l(e)),b=P.length,j=M(1,b),C=w(E,P,0);-1!==C;)I=T?l(e(P,C,E)):p(P,E,C,[],void 0,e),U+=O(E,v,C)+I,v=C+b,C=w(E,P,C+j);return v<E.length&&(U+=O(E,v)),U}})},28045:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _Users_zhangcheng_Desktop_work_flomesh_gui_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3336),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21249),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41539),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(54747),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(57658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(38862),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(74916),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(15306),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(68757),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(92222),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_9__),lodash__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(96486),lodash__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_10__),_components_editor_JsonEditor__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(21936),columns=[{key:"Span Id",dataIndex:"spanId",width:150},{key:"Service",dataIndex:"svcName",width:150},{key:"Pod",dataIndex:"podName",width:150},{key:"Count",dataIndex:"cnt",width:70},{key:"Duration",dataIndex:"duration",width:150},{key:"Waterfall",dataIndex:"waterfall"}];__webpack_exports__.Z={name:"NetworkDetail",i18n:__webpack_require__(89234),components:{JsonEditor:_components_editor_JsonEditor__WEBPACK_IMPORTED_MODULE_11__.Z},props:{},data:function(){return{traceId:"",loading:!0,log:"{}",visible:!1,duration:0,time:"",spans:[],columns:columns}},computed:{dataColumns:function(){var _=this;return this.columns.map((function(e){return e.title=_.$t(e.key),e}))}},created:function(){this.traceId=this.$route.params.id||"",this.traceId?(this.loading=!0,this.getData()):this.loading=!1},methods:{afterVisibleChange:function(_){},showDrawer:function(_){this.getLog(_),this.visible=!0},onClose:function(){this.visible=!1},getStep:function(_){return Math.ceil(_/this.duration*100)},getTime:function(_){return _+"ms"},buildSpan:function buildSpan(lastduration,node,nodes,ending){var _start=node[6]-this.time,_n={key:node[0],spanId:node[0],cnt:node[2],svcName:node[3].indexOf("[")>=0?lodash__WEBPACK_IMPORTED_MODULE_10___default().uniq(eval(node[3])):[node[3]],podName:node[4].indexOf("[")>=0?lodash__WEBPACK_IMPORTED_MODULE_10___default().uniq(eval(node[4])):[node[4]],duration:node[5],reqTime:node[6],resTime:node[7],start:this.getStep(_start),end:this.getStep(_start+1*node[5]),startTime:this.getTime(_start),endTime:this.getTime(_start+1*node[5]),marks:{}};if(_n.marks[this.getStep(_start)]=this.getTime(_start),_n.marks[this.getStep(1*_start+1*node[5])]=this.getTime(1*_start+1*node[5]),!ending){var _child=this.getChild({start:_start},node[0],nodes);_child&&_child.length>0?_n.children=_child:this.getChildSpan({start:_start},_n)}return lastduration.start=node[5],_n},getChild:function(_,e,t){var a=this,r=[];return t?(t.forEach((function(t){var s=t.split("\t");s[0]&&""!=e&&e==s[1]&&r.push(a.buildSpan(_,s))})),r):[]},getEndChild:function(_,e){var t=this,a=[];return e.forEach((function(e){var r=e.split("\t");r[0]&&a.push(t.buildSpan(_,r,null,!0))})),a},setSpan:function(_){var e=this,t={start:0};_.forEach((function(a){var r=a.split("\t");(r[0]&&!r[1]||""==r[1])&&e.spans.push(e.buildSpan(t,r,_))}))},getLog:function(_){var e=this,t="select message from log where trace.span='".concat(_,"';");this.$request(this.$REST.CLICKHOUSE.QUERY(t),this.$METHOD.GET).then((function(_){if("object"==(0,_Users_zhangcheng_Desktop_work_flomesh_gui_node_modules_babel_runtime_helpers_esm_typeof_js__WEBPACK_IMPORTED_MODULE_0__.Z)(_.data))e.log=JSON.stringify(_.data);else{var t=[];_.data.split("\n").map((function(_){return _&&""!=_&&t.push(JSON.parse(_.replaceAll('\\"','"'))),_})),e.log=JSON.stringify(t)}})).catch((function(_){}))},getData:function(){var _=this,e="select trace.id,count(),(max(resTime) - min(reqTime)) as duration,min(reqTime) from log where trace.id='".concat(this.traceId,"' group by trace.id;");this.$request(this.$REST.CLICKHOUSE.QUERY(e),this.$METHOD.GET).then((function(e){e.data.split("\n").map((function(e){var t=e.split("\t");return t[0]&&(_.duration=t[2],_.time=t[3]),e})),_.getSpan()})).catch((function(_){}))},getSpan:function(){var _=this,e="select trace.span,max(trace.parent),count(),groupArray(service.name),groupArray(pod.name),(max(resTime) - min(reqTime)) as duration,min(reqTime) as minreqTime,max(resTime) from log where trace.id='".concat(this.traceId,"' group by trace.span  order by minreqTime asc;");this.$request(this.$REST.CLICKHOUSE.QUERY(e),this.$METHOD.GET).then((function(e){var t=e.data.split("\n");_.setSpan(t)})).catch((function(_){}))},getChildSpan:function(_,e){var t=this,a="select trace.span,trace.parent,1,service.name,pod.name,(resTime - reqTime) as duration,reqTime,resTime from log where trace.id='".concat(this.traceId,"' and trace.span='").concat(e.spanId,"' order by reqTime asc;");this.$request(this.$REST.CLICKHOUSE.QUERY(a),this.$METHOD.GET).then((function(a){var r=0,s=a.data.split("\n");(s.forEach((function(_){_.split("\t")[0]&&r++})),r>1)&&(e.children=[],t.getEndChild(_,s).forEach((function(_){e.children.push(_)})),t.spans=lodash__WEBPACK_IMPORTED_MODULE_10___default().cloneDeep(t.spans))})).catch((function(_){}))}}}},93817:function(_,e,t){t.r(e),t.d(e,{default:function(){return p}});var a=t(66252),r=t(3577),s={class:"network-card-header"},n={class:"network-card-body"},i={key:0,class:"inline-block"},o=["onClick"],c={key:1},l={key:4,class:"waterfall-panel"},d={class:"pr-15"};var u=t(28045);var p=(0,t(83744).Z)(u.Z,[["render",function(_,e,t,u,p,E){var h=(0,a.up)("JsonEditor"),m=(0,a.up)("a-drawer"),f=(0,a.up)("a-tag"),D=(0,a.up)("a-slider"),g=(0,a.up)("a-table"),O=(0,a.up)("a-card");return(0,a.wg)(),(0,a.j4)(O,{class:"card nopd",title:_.$t("Waterfall Detail")},{default:(0,a.w5)((function(){return[(0,a._)("div",s,[(0,a._)("h2",null,"Trace ID : "+(0,r.zw)(p.traceId),1)]),(0,a._)("div",n,[p.visible?((0,a.wg)(),(0,a.j4)(m,{key:0,"get-container":!1,title:_.$t("log"),placement:"right",width:"700",closable:!1,visible:p.visible,"wrap-style":{position:"absolute"},"after-visible-change":E.afterVisibleChange,onClose:E.onClose},{default:(0,a.w5)((function(){return[(0,a.Wm)(h,{"is-readonly":!0,value:p.log},null,8,["value"])]})),_:1},8,["title","visible","after-visible-change","onClose"])):(0,a.kq)("",!0),(0,a.Wm)(g,{columns:E.dataColumns,"data-source":p.spans,pagination:!1},{bodyCell:(0,a.w5)((function(_){var e=_.column,t=_.record;return["spanId"===e.dataIndex?((0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("a",{href:"javascript:void(0)",onClick:function(_){return E.showDrawer(t.spanId)}},(0,r.zw)(t.spanId),9,o)])):"duration"===e.dataIndex?((0,a.wg)(),(0,a.iD)("div",c,(0,r.zw)(t.duration)+" ms",1)):"svcName"===e.dataIndex?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:2},(0,a.Ko)(t.svcName,(function(_,e){return(0,a.wg)(),(0,a.j4)(f,{key:e},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,r.zw)(_),1)]})),_:2},1024)})),128)):"podName"===e.dataIndex?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:3},(0,a.Ko)(t.podName,(function(_,e){return(0,a.wg)(),(0,a.j4)(f,{key:e},{default:(0,a.w5)((function(){return[(0,a.Uk)((0,r.zw)(_),1)]})),_:2},1024)})),128)):"waterfall"===e.dataIndex?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",d,[(0,a.Wm)(D,{marks:t.marks,class:"waterfall",range:"","default-value":[t.start,t.end]},null,8,["marks","default-value"])])])):(0,a.kq)("",!0)]})),_:1},8,["columns","data-source"])])]})),_:1},8,["title"])}],["__scopeId","data-v-01b69977"]])}}]);