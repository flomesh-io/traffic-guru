"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[909],{71900:function(t,e,a){a.d(e,{Z:function(){return d}});var i=a(66252),s=a(3577);const n={class:"head-info"};var l={name:"HeadInfo",props:["title","content"]};var d=(0,a(83744).Z)(l,[["render",function(t,e,a,l,d,c){return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("span",null,(0,s.zw)(a.title),1),(0,i._)("p",null,[(0,i.Uk)((0,s.zw)(a.content),1),(0,i.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},70909:function(t,e,a){a.r(e),a.d(e,{default:function(){return I}});var i=a(66252),s=a(3577);const n=t=>((0,i.dD)("data-v-7d96160a"),t=t(),(0,i.Cn)(),t),l={key:0,class:"mt-25"},d={class:"mb-3"},c={key:0},o=n((()=>(0,i._)("svg",{class:"card-avatar icon","aria-hidden":"true"},[(0,i._)("use",{"xlink:href":"#icon-certificate"})],-1))),r={class:"certificate-meta-content meta-content"},p={class:"mb-3"},u=n((()=>(0,i._)("svg",{class:"border-square card-avatar icon square-50","aria-hidden":"true"},[(0,i._)("use",{"xlink:href":"#icon-certificate"})],-1))),h={class:"mb-10"},m={class:"meta-content"};a(57658);var f=a(99684),b=a(18310),g=a(61103),y=a(71900),w=a(69596),v=a(60459),k=a(79332),C=a(33907),$=a(85263),_=a(27484),T=a.n(_),S={name:"Certificates",components:{HeadInfo:y.Z,PageLayout:g.Z,EnvSelector:v.Z,CardList:w.Z,PlusCircleTwoTone:f.Z,FormItem:k.Z},i18n:a(89234),props:["isBind","col","bindCertificates","certificateSize","mode"],data(){return{tlsMap:{api:"API/LB Secret",client:"Client Secret",rfc8998:"RFC8998 Secret",k8s:"K8S Secret"},tlsTypes:[{value:"api",label:"API/LB TLS Secret"},{value:"client",label:"Client Secret"},{value:"rfc8998",label:"RFC8998 Secret"},{value:"k8s",label:"K8S Secret"}],keyDisplay:{},FileProtectOutlined:b.Z,isEdit:!1,bindCertificatesVals:[],certificates:[],visible:!1,visible2:!1,subscribes:[],flb:[],fsm:[],payload:{name:"",id:"",port:0,type:"k8s",namespaceId:null,content:{key:"",cert:""}},bindTarget:{},editorIsCreate:!0,workload:[],projects:[],pageSize:12,pageNo:1,total:0,loading:!0,activities:[],config:{},teams:[],simpleImage:$.Z.PRESENTED_IMAGE_SIMPLE}},computed:{...(0,C.rn)("rules",["rules"]),calcCertificates(){if(!this.isBind)return this.certificates;let t=[];return this.certificates.forEach((e=>{let a=!1;this.bindCertificates.forEach((t=>{t.id==e.id&&(a=!0)})),a||t.push(e)})),t},start(){return(this.pageNo-1)*this.pageSize}},watch:{bindCertificatesVals:{deep:!0,handler(){this.$emit("update:bindCertificates",this.bindCertificatesVals)}},bindCertificates:{deep:!0,immediate:!0,handler(t){null==t&&(this.bindCertificatesVals=[])}}},created(){this.loaddata()},methods:{changeType(){switch(this.payload.type){case"api":case"k8s":this.payload.content={key:"",cert:""};break;case"rfc8998":this.payload.content={key:"",cert:"",keyEnc:"",certEnc:""};break;case"client":this.payload.content={cert:""}}},envChange(t){this.payload.namespaceId=t.namespaceId},getCurrentStyle(t){const e={};return 1===t.date()&&(e.border="1px solid #1890ff",e.borderRadius="50%"),e},add(){this.isEdit=!1,this.payload={name:"",id:"",type:"api",namespaceId:null,content:{cert:"",key:""}},this.showModal()},getSample(){this.custom=this.customSample},showModal(){this.visible=!0},valid(){this.$refs.form.validateFields().then((()=>{this.handleOk()})).catch((()=>{}))},handleOk(){let t=this.payload.namespaceId;if(this.isEdit){const e=this.payload.id;delete this.payload.id,delete this.payload.namespaceId,delete this.payload.namespace;let a={content:this.payload.content,...this.payload};"k8s"==a.type&&t&&(a.namespace=t),this.$gql.mutation(`updateCertificate(id:${e}, data: $data){data{id}}`,{data:a},{data:"CertificateInput!"}).then((()=>{this.$message.success(this.$t("Save successfully"),3),this.visible=!1,this.loaddata()}))}else{delete this.payload.id,delete this.payload.namespaceId,delete this.payload.namespace;let e={...this.payload};"k8s"==e.type&&t&&(e.namespace=t),this.$gql.mutation("createCertificate(data: $data){data{id}}",{data:e},{data:"CertificateInput!"}).then((()=>{this.$message.success(this.$t("Created successfully"),3),this.visible=!1,this.loaddata()}))}},setting(t,e,a){this.keyDisplay={},this.payload.namespace=a.namespace,this.$gql.query(`certificate(id: ${a.id}){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}`).then((t=>{this.payload=t.data,this.payload.content=t.data.content,this.payload.namespaceId=t.data.namespace?.id})),this.isEdit=!0,this.showModal()},remove(t,e,a){this.$gql.mutation(`deleteCertificate(id: ${a.id}){data{id}}`).then((()=>{this.$message.success(this.$t("Deleted successfully"),3),this.loaddata()}))},showModal2(){this.visible2=!0},getTimeLabel(t){return new Date(t[0]).toLocaleDateString()+"~"+new Date(t[1]).toLocaleDateString()},handleOk2(){if(!this.bindTarget.validity[1])return void this.$message.error(this.$t("Please select a valid period"),3);this.bindCertificatesVals=this.bindCertificates;let t=this.bindCertificatesVals.findIndex((t=>t.id==this.bindTarget.id)),e={id:this.bindTarget.id,name:this.bindTarget.name,host:this.bindTarget.host,content:this.bindTarget.content,type:this.bindTarget.type,start:""+new Date(this.bindTarget.validity[0]).getTime(),end:""+new Date(this.bindTarget.validity[1]).getTime()};t>-1?this.bindCertificatesVals[t]=e:this.bindCertificatesVals.push(e),this.bindTarget={},this.visible2=!1,this.$message.success(this.$t("Binding succeeded"),3)},unbind(t){this.bindCertificatesVals=this.bindCertificates,this.bindCertificatesVals.splice(t,1)},editBind(t){this.bindCertificatesVals=this.bindCertificates,this.bindTarget=this.bindCertificatesVals[t];let e=new Date(1*this.bindTarget.start).toLocaleDateString(),a=new Date(1*this.bindTarget.end).toLocaleDateString();this.bindTarget.validity=[T()(e),T()(a)],this.isEdit=!0,this.showModal2()},bind(t,e,a){const i=this.certificateSize||2;this.bindCertificates.length>=i?this.$message.warning(this.$t(`At most ${i} certificates can be bound`)):(this.bindTarget=a,this.bindTarget.validity=[],this.showModal2())},edit(){},loaddata(t,e){t&&(this.pageNo=t,this.pageSize=e),this.loading=!0;const a={};"certificates"==this.mode&&(a.type={in:["api","rfc8998"]}),this.$gql.query(`certificates(filters: $filters, sort:"name:asc",pagination: {start: ${this.start}, limit: ${this.pageSize}}){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t\t}}},\n\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}`,{filters:a},{filters:"CertificateFiltersInput",pagination:"PaginationArg"}).then((t=>{this.certificates=t.data,this.total=t.pagination.total,this.loading=!1}))}}};var I=(0,a(83744).Z)(S,[["render",function(t,e,a,n,f,b){const g=(0,i.up)("PlusCircleTwoTone"),y=(0,i.up)("HeadInfo"),w=(0,i.up)("a-tag"),v=(0,i.up)("a-divider"),k=(0,i.up)("a-card-meta"),C=(0,i.up)("CardList"),$=(0,i.up)("a-pagination"),_=(0,i.up)("a-input"),T=(0,i.up)("FormItem"),S=(0,i.up)("a-descriptions-item"),I=(0,i.up)("a-select-option"),D=(0,i.up)("a-select"),z=(0,i.up)("EnvSelector"),W=(0,i.up)("a-alert"),E=(0,i.up)("a-textarea"),q=(0,i.up)("a-descriptions"),U=(0,i.up)("a-form"),O=(0,i.up)("a-modal"),j=(0,i.up)("a-range-picker"),x=(0,i.up)("PageLayout"),L=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(x,{"hide-head":a.isBind,avatar:f.FileProtectOutlined,"form-state":f.payload,ref:"layout"},{extra:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(y,{class:"split-right",title:t.$t("Create a certificate")},{body:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(g,{onClick:b.add,class:"font-primary icon-menu rotate-icon"},null,8,["onClick"])])])),_:1},8,["title"])),[[L,["certificate:create"]]])])),default:(0,i.w5)((()=>[a.isBind?((0,i.wg)(),(0,i.iD)("div",l,[a.bindCertificates.length>0?((0,i.wg)(),(0,i.j4)(v,{key:0,dashed:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.$t("Is binding")),1)])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(C,{empty:t.$t("Select a binding in the certificate list"),col:a.col,class:"mb-10","hide-action-title":!0,"data-source":a.bindCertificates,type:"component",loading:f.loading,actions:[{icon:"EditOutlined",text:t.$t("edit"),call:b.editBind,permission:["certificate:update"]},{icon:"DisconnectOutlined",text:t.$t("Unbind"),call:b.unbind,permission:["certificate:update"]}]},{default:(0,i.w5)((({item:e})=>[(0,i.Wm)(k,null,{title:(0,i.w5)((()=>[(0,i._)("div",d,[(0,i._)("span",null,(0,s.zw)(e.name),1),e.host?((0,i.wg)(),(0,i.iD)("span",c," / "+(0,s.zw)(e.host),1)):(0,i.kq)("",!0)])])),avatar:(0,i.w5)((()=>[o])),description:(0,i.w5)((()=>[(0,i._)("div",r,(0,s.zw)(t.$t("Term of validity"))+"ï¼š"+(0,s.zw)(b.getTimeLabel([1*e.start,1*e.end])),1)])),_:2},1024)])),_:1},8,["empty","col","data-source","loading","actions"])])):(0,i.kq)("",!0),(0,i._)("div",null,[a.isBind?((0,i.wg)(),(0,i.j4)(v,{key:0,dashed:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.$t("Certificate list")),1)])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(C,{empty:t.$t("No certificate"),col:a.col,"hide-action-title":!0,"data-source":b.calcCertificates,type:"component",loading:f.loading,actions:a.isBind?[{icon:"LinkOutlined",text:t.$t("Bind"),call:b.bind,permission:["certificate:update"]}]:[{icon:"EditOutlined",text:t.$t("edit"),call:b.setting,permission:["certificate:update"]},{icon:"CloseOutlined",hide:!0,text:t.$t("delete"),call:b.remove,permission:["certificate:delete"]}]},{default:(0,i.w5)((({item:t})=>[(0,i.Wm)(k,null,{title:(0,i.w5)((()=>[(0,i._)("div",p,(0,s.zw)(t.name),1)])),avatar:(0,i.w5)((()=>[u])),description:(0,i.w5)((()=>[(0,i._)("div",h,[t.type?((0,i.wg)(),(0,i.j4)(w,{key:0,color:{k8s:"blue",api:"green",rfc8998:"green",client:"green"}[t.type]},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(f.tlsMap[t.type]),1)])),_:2},1032,["color"])):(0,i.kq)("",!0),t.namespace?((0,i.wg)(),(0,i.j4)(w,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.namespace.registry?.name)+" / "+(0,s.zw)(t.namespace.name),1)])),_:2},1024)):(0,i.kq)("",!0)]),(0,i._)("div",m,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Object.keys(t.content||[]),((t,e)=>((0,i.wg)(),(0,i.iD)("div",{key:e},(0,s.zw)(t)+":******************** ",1)))),128))])])),_:2},1024)])),_:1},8,["empty","col","data-source","loading","actions"]),(0,i.Wm)($,{onChange:b.loaddata,current:f.pageNo,"onUpdate:current":e[0]||(e[0]=t=>f.pageNo=t),total:f.total,"page-size":f.pageSize,"show-less-items":""},null,8,["onChange","current","total","page-size"])]),(0,i.Wm)(O,{visible:f.visible,"onUpdate:visible":e[4]||(e[4]=t=>f.visible=t),title:t.$t("Certificates"),onOk:b.valid,width:"50%","ok-text":f.isEdit?t.$t("Save"):t.$t("create")},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{model:f.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{label:t.$t("as"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{name:"name",rules:t.rules.uniqueName("certificates",{id:f.payload.id,namespace:f.payload.namespace?.id})},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{placeholder:t.$t("unset"),value:f.payload.name,"onUpdate:value":e[1]||(e[1]=t=>f.payload.name=t),class:"width-300"},null,8,["placeholder","value"])])),_:1},8,["rules"])])),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Type"),span:"k8s"==f.payload.type?1:3},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{value:f.payload.type,"onUpdate:value":e[2]||(e[2]=t=>f.payload.type=t),class:"width-180",disabled:f.isEdit,onChange:b.changeType},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.tlsTypes,((t,e)=>((0,i.wg)(),(0,i.j4)(I,{value:t.value,key:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(t.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled","onChange"])])),_:1},8,["label","span"]),"k8s"==f.payload.type?((0,i.wg)(),(0,i.j4)(S,{key:0,label:t.$t("Namespace"),span:2},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{"no-all":!0,"is-filter":!0,namespace:f.payload.namespace,"onUpdate:namespace":e[3]||(e[3]=t=>f.payload.namespace=t),onEnvChange:b.envChange},null,8,["namespace","onEnvChange"])])),_:1},8,["label"])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Object.keys(f.payload.content),((e,a)=>((0,i.wg)(),(0,i.j4)(S,{key:a,label:t.$t("Certificate")+` (${e})`,span:3},{default:(0,i.w5)((()=>[f.isEdit&&f.payload.content[e]&&!f.keyDisplay[e]?((0,i.wg)(),(0,i.j4)(W,{key:0,type:"success",message:"********************",banner:"",closable:"",onClose:()=>{f.payload.content[e]="",f.keyDisplay[e]=!0}},null,8,["onClose"])):(0,i.kq)("",!0),!f.isEdit||f.keyDisplay[e]||""==f.payload.content[e]?((0,i.wg)(),(0,i.j4)(E,{key:1,value:f.payload.content[e],"onUpdate:value":t=>f.payload.content[e]=t,placeholder:e,rows:4},null,8,["value","onUpdate:value","placeholder"])):(0,i.kq)("",!0)])),_:2},1032,["label"])))),128))])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","onOk","ok-text"]),(0,i.Wm)(O,{visible:f.visible2,"onUpdate:visible":e[7]||(e[7]=t=>f.visible2=t),title:t.$t("Binding certificate"),onOk:b.handleOk2,width:"50%","ok-text":t.$t("Bind"),"destroy-on-close":!0},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{bordered:""},{default:(0,i.w5)((()=>[f.bindTarget.id?((0,i.wg)(),(0,i.j4)(S,{key:0,label:t.$t("ID"),span:3},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(f.bindTarget.id),1)])),_:1},8,["label"])):(0,i.kq)("",!0),(0,i.Wm)(S,{label:t.$t("as"),span:3},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(f.bindTarget.name),1)])),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Host"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{value:f.bindTarget.host,"onUpdate:value":e[5]||(e[5]=t=>f.bindTarget.host=t),class:"width-300"},null,8,["value"])])),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Term of validity"),span:3},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{value:f.bindTarget.validity,"onUpdate:value":e[6]||(e[6]=t=>f.bindTarget.validity=t)},{dateRender:(0,i.w5)((({current:t})=>[(0,i._)("div",{class:"ant-calendar-date",style:(0,s.j5)(b.getCurrentStyle(t))},(0,s.zw)(t.date()),5)])),_:1},8,["value"])])),_:1},8,["label"])])),_:1})])),_:1},8,["visible","title","onOk","ok-text"])])),_:1},8,["hide-head","avatar","form-state"])}],["__scopeId","data-v-7d96160a"]])}}]);