"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[6496],{71900:function(t,e,n){n.d(e,{Z:function(){return o}});var i=n(66252),a=n(3577),l={class:"head-info"};var u={name:"HeadInfo",props:["title","content"]};var o=(0,n(83744).Z)(u,[["render",function(t,e,n,u,o,d){return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("span",null,(0,a.zw)(n.title),1),(0,i._)("p",null,[(0,i.Uk)((0,a.zw)(n.content),1),(0,i.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},6496:function(t,e,n){n.r(e),n.d(e,{default:function(){return y}});n(68309);var i=n(66252),a=n(3577),l=n(49963),u=function(t){return(0,i.dD)("data-v-aaedaf84"),t=t(),(0,i.Cn)(),t}((function(){return(0,i._)("div",{class:"template-div"},null,-1)})),o={key:0},d={key:1,class:"gray"};var s=n(95082),c=(n(41539),n(54747),n(57658),n(96486)),r=n.n(c),p=n(38718),f=n(79954),g=n(61103),m=n(1299),h=n(33907),v=n(71900),b=n(13589),w={name:"PolicyDetail",i18n:n(89234),components:{HeadInfo:v.Z,DetailListItem:b.Z,DetailList:m.Z,PageLayout:g.Z,PluginConfig:p.Z,PluginList:f.Z},props:["embed","name"],data:function(){return{detail:{project:null,name:"",content:{plugins:[]}},projects:[],type:"Policy",visible:!1,labelVisible:!1,labelValue:"",visibleReview:!1,visibleRevise:!1,visibleDeploy:!1,visibleStop:!1,visibleRestart:!1,description1:"",description2:"",description3:"",description4:"",activeKey:"1",bindPolicy:null,visiblelog:!1,visibleEndpoint:!1,visibleProvider:!1,loading:!0,logloading:!0,swaggerLoading:!0,logs:[],log:"{}",pid:"",filter:"",params:{pageNo:1,pageSize:10,total:0},profiles:[],clusters:[],tps:[],tpsCnt:0,activeTabKey:"2"}},computed:(0,s.Z)({},(0,h.rn)({rules:function(t){return t.rules.rules},isMobile:function(t){return t.setting.isMobile}})),created:function(){this.pid=this.$route.params.id||"",this.type="Policy",this.embed&&(this.pid="")},mounted:function(){var t=this;this.$gql.query("projects{data{id,attributes{name}}}").then((function(e){t.projects=e.data})),""!=this.pid?(this.loading=!1,this.$gql.query("policy(id: ".concat(this.pid,"){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcontent,\n\t\t\t\t\t\tproject{data{id}},\n\t\t\t\t\t\tplugins{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\ticon{data{id,attributes{url,previewUrl}}},\n\t\t\t\t\t\t\ttype{data{id,attributes{name}}},\n\t\t\t\t\t\t\tdesc,\n\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcreatedAt,\n\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t}}}")).then((function(e){t.loading=!1,t.detail=e.data,t.detail.project=e.data.project.id,t.detail.content.plugins||(t.detail.content.plugins=[]);var n={};t.detail.content.plugins&&t.detail.content.plugins.forEach((function(t){n[t.id]=t,n[t.id].content.script||(n[t.id].content.script="")})),t.detail.content.plugins=[],t.detail.plugins&&t.detail.plugins.forEach((function(e){e.content.script=n[e.id].content.script,n[e.id]?(n[e.id].content.fields&&e.content.fields&&e.content.fields.forEach((function(t){n[e.id].content.fields.forEach((function(e){t.name==e.name&&(t.value=e.value)}))})),e.enable=n[e.id].enable):e.enable=!1,t.detail.content.plugins.push(e)}))}))):(this.detail={project:null,name:"",content:{plugins:[]}},this.loading=!1),this.embed&&(this.detail.name=this.name)},methods:{selectPlugin:function(t){this.detail.content.plugins.push((0,s.Z)((0,s.Z)({},t),{},{switch:!0})),this.visible=!1,this.$message.success(this.$t("Added successfully"),3)},showPluginBox:function(){this.visible=!0},handleClose:function(t,e){delete t[e]},onTabChange:function(t){},valid:function(){return""!=this.detail.name||(this.$message.error(this.$t("The name cannot be empty"),3),!1)},validate:function(){var t=this;this.$refs.layout.$refs.form.validateFields().then((function(){t.save()})).catch((function(){}))},save:function(){var t=this;if(this.valid()){var e=r().cloneDeep(this.detail);delete e.createdAt,delete e.updatedAt,delete e.id,e.plugins=[],e.content.plugins&&e.content.plugins.forEach((function(t){e.plugins.push(t.id)})),""!=this.pid?this.$gql.mutation("updatePolicy(id:".concat(this.pid,", data: $data){data{id}}"),{data:e},{data:"PolicyInput!"}).then((function(){t.$message.success(t.$t("Save successfully"),3),t.$closePage(t.$route)})):this.$gql.mutation("createPolicy(data: $data){data{id}}",{data:e},{data:"PolicyInput!"}).then((function(e){t.pid=e.data.id,t.$message.success(t.$t("Created successfully"),3),t.$closePage(t.$route)}))}},handleChange:function(){},hide:function(){this.visible=!1}}};var y=(0,n(83744).Z)(w,[["render",function(t,e,n,s,c,r){var p=(0,i.up)("a-input"),f=(0,i.up)("DetailListItem"),g=(0,i.up)("a-select-option"),m=(0,i.up)("a-select"),h=(0,i.up)("DetailList"),v=((0,i.up)("HeadInfo"),(0,i.up)("a-button")),b=(0,i.up)("PluginConfig"),w=(0,i.up)("a-col"),y=(0,i.up)("a-row"),$=(0,i.up)("a-tab-pane"),P=(0,i.up)("a-tabs"),k=(0,i.up)("PluginList"),_=(0,i.up)("a-modal"),j=(0,i.up)("PageLayout"),C=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(j,{"hide-breadcrumb":n.embed,title:n.embed?" ":c.detail.name?c.detail.name:t.$t("new")+t.$t("Policy"),"form-state":c.detail,ref:"layout"},(0,i.Nv)({headerContent:(0,i.w5)((function(){return[u,(0,i.Wm)(h,{size:"small",col:1},{default:(0,i.w5)((function(){return[n.embed?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(f,{key:0,term:t.$t("as"),rules:t.rules.uniqueName("policies",{id:c.pid,project:c.detail.project}),name:"name"},{default:(0,i.w5)((function(){return[(0,i.Wm)(p,{placeholder:t.$t("unset"),value:c.detail.name,"onUpdate:value":e[0]||(e[0]=function(t){return c.detail.name=t}),class:"width-200"},null,8,["placeholder","value"])]})),_:1},8,["term","rules"])),(0,i.Wm)(f,{term:t.$t("Project"),rules:t.rules.required,name:"project"},{default:(0,i.w5)((function(){return[(0,i.Wm)(m,{placeholder:t.$t("unallocated"),class:"width-200",value:c.detail.project,"onUpdate:value":e[1]||(e[1]=function(t){return c.detail.project=t}),onChange:e[2]||(e[2]=function(t){return r.handleChange()})},{default:(0,i.w5)((function(){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.projects,(function(t,e){return(0,i.wg)(),(0,i.j4)(g,{key:e,value:t.id},{default:(0,i.w5)((function(){return[t.id?((0,i.wg)(),(0,i.iD)("span",o,(0,a.zw)(t.name),1)):(0,i.kq)("",!0),t.id?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",d,(0,a.zw)(t.name),1))]})),_:2},1032,["value"])})),128))]})),_:1},8,["placeholder","value"])]})),_:1},8,["term","rules"])]})),_:1})]})),default:(0,i.w5)((function(){return[(0,i.Wm)(y,{class:"row-mg"},{default:(0,i.w5)((function(){return[(0,i.Wm)(w,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((function(){return[(0,i.Wm)(P,{type:"card",activeKey:c.activeKey,"onUpdate:activeKey":e[4]||(e[4]=function(t){return c.activeKey=t})},{rightExtra:(0,i.w5)((function(){return[(0,i.wy)((0,i.Wm)(v,{type:"primary",onClick:r.showPluginBox},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,a.zw)(t.$t("Add Plugin")),1)]})),_:1},8,["onClick"]),[[l.F8,c.detail.content.plugins.length>0]])]})),default:(0,i.w5)((function(){return[(0,i.Wm)($,{key:"1",tab:t.$t("Policy")},{default:(0,i.w5)((function(){return[(0,i.Wm)(y,{class:"row-mg"},{default:(0,i.w5)((function(){return[(0,i.Wm)(w,{class:"col-pd",xl:24,lg:24,md:24,sm:24,xs:24},{default:(0,i.w5)((function(){return[(0,i._)("div",null,[(0,i.Wm)(b,{plugins:c.detail.content.plugins,"onUpdate:plugins":e[3]||(e[3]=function(t){return c.detail.content.plugins=t}),onAdd:r.showPluginBox,"add-text":"Add Plugin"},null,8,["plugins","onAdd"])])]})),_:1})]})),_:1})]})),_:1},8,["tab"])]})),_:1},8,["activeKey"])]})),_:1})]})),_:1}),(0,i.Wm)(_,{footer:null,width:800,visible:c.visible,"onUpdate:visible":e[5]||(e[5]=function(t){return c.visible=t}),title:t.$t("Add Plugin"),onOk:t.handleOk},{default:(0,i.w5)((function(){return[(0,i.Wm)(k,{onSelectPlugin:r.selectPlugin,"hide-head":!0},null,8,["onSelectPlugin"])]})),_:1},8,["visible","title","onOk"])]})),_:2},[void 0,n.embed?void 0:{name:"action",fn:(0,i.w5)((function(){return[""!=c.pid?(0,i.wy)(((0,i.wg)(),(0,i.j4)(v,{key:0,type:"default",onClick:r.validate},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,a.zw)(t.$t("save")),1)]})),_:1},8,["onClick"])),[[C,["policy:update"]]]):(0,i.wy)(((0,i.wg)(),(0,i.j4)(v,{key:1,type:"primary",onClick:r.validate},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,a.zw)(t.$t("create")),1)]})),_:1},8,["onClick"])),[[C,["policy:create"]]])]})),key:"1"}]),1032,["hide-breadcrumb","title","form-state"])}],["__scopeId","data-v-aaedaf84"]])}}]);