"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[3535],{3535:function(t,e,a){a.r(e),a.d(e,{default:function(){return h}});var n=a(66252),i=a(3577);const s={key:0},o=["onClick"],r=["onClick"],l={key:2};a(57658);var d=a(21936);const c=[{key:"user",dataIndex:["user","username"]},{key:"IP",dataIndex:"loginIp"},{key:"Action",dataIndex:"action"},{key:"as",dataIndex:"name"},{key:"updTime",sorter:!0,dataIndex:"updatedAt"},{key:"content",dataIndex:"data"}];var u={name:"EventList",components:{JsonEditor:d.Z},i18n:a(89234),data(){return{key:"",keyAction:"",visible:!1,pageSize:10,pageNo:1,total:0,loading:!0,advanced:!0,sorter:"updatedAt",sortOrder:"end$desc",columns:c,events:[]}},computed:{dataColumns(){return this.columns.map((t=>(t.title=this.$t(t.key),t.sorter&&this.sorter==t.dataIndex&&(t.sortOrder=this.sortOrder),t)))},start(){return(this.pageNo-1)*this.pageSize}},created(){this.search()},methods:{sort(t,e,a){this.sorter=a.field,this.sortOrder=a.order,this.search()},onClose(){this.visible=!1},detail(t){this.visible=!0,this.log=JSON.stringify(t||{})},detailInterface(t){this.visible=!0,this.log=t},search(t,e){t&&(this.pageNo=t,this.pageSize=e);let a={start:this.start,limit:this.pageSize};this.loading=!0;const n=this.keyAction.replace(/\s*/g,"");let i={user:{username:{contains:this.key}},action:{contains:n}},s="updatedAt:desc";this.sorter&&this.sortOrder&&(s=this.sortOrder.replace(/\$/g,""),s=s.replace(/end/g,""),s=`${this.sorter}:${s}`),this.$gql.query(`events(filters: $filters, pagination: $pagination, sort: "${s}"){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tupdatedAt,\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\taction,\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\tloginIp,\n              content,\n              from,\n\t\t\t\t\t\t\tuser{data{id,attributes{username}}}\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}`,{filters:i,pagination:a},{filters:"EventFiltersInput",pagination:"PaginationArg"}).then((t=>{this.events=t.data,t.data.forEach((t=>{t.actions=[],0==t.action.indexOf("create")?(t.actions.push("create"),t.actions.push(t.action.replace(/^create/,""))):0==t.action.indexOf("update")?(t.actions.push("update"),t.actions.push(t.action.replace(/^update/,""))):0==t.action.indexOf("delete")?(t.actions.push("delete"),t.actions.push(t.action.replace(/^delete/,""))):t.actions.push(t.action)})),this.total=t.pagination.total,this.loading=!1}))}}};var h=(0,a(83744).Z)(u,[["render",function(t,e,a,d,c,u){const h=(0,n.up)("a-input-search"),p=(0,n.up)("a-table"),g=(0,n.up)("a-card"),k=(0,n.up)("JsonEditor"),v=(0,n.up)("a-drawer");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(g,{title:t.$t("Operating record"),class:"nopd",loading:c.loading},{extra:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(h,{value:c.keyAction,"onUpdate:value":e[0]||(e[0]=t=>c.keyAction=t),onSearch:e[1]||(e[1]=t=>u.search()),class:"right-search-input",style:{width:"200px"},placeholder:t.$t("search")+" "+t.$t("Action")},null,8,["value","placeholder"]),(0,n.Wm)(h,{value:c.key,"onUpdate:value":e[2]||(e[2]=t=>c.key=t),onSearch:e[3]||(e[3]=t=>u.search()),class:"right-search-input",style:{width:"200px"},placeholder:t.$t("search")+" "+t.$t("User")},null,8,["value","placeholder"])])])),default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(p,{columns:u.dataColumns,"data-source":c.events,pagination:{showSizeChanger:!0,showQuickJumper:!1,onShowSizeChange:u.search,onChange:u.search,current:c.pageNo,pageSize:c.pageSize,showTotal:(e,a)=>`${t.$t("Total")} ${e}`,total:c.total},onChange:u.sort},{bodyCell:(0,n.w5)((({column:e,record:a})=>["action"===e.dataIndex?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.actions,((t,e)=>((0,n.wg)(),(0,n.iD)("b",{class:"mr-10",key:e},(0,i.zw)(t),1)))),128)),a.target?((0,n.wg)(),(0,n.iD)("div",s,[(0,n.Uk)((0,i.zw)(a.target.name)+" : [",1),(0,n._)("b",null,(0,i.zw)(a.target.id),1),(0,n.Uk)("] ")])):(0,n.kq)("",!0)],64)):"data"===e.dataIndex?((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n._)("div",null,[(0,n._)("a",{onClick:t=>u.detailInterface(a.content)},(0,i.zw)(t.$t("Interface")),9,o)]),(0,n._)("div",null,[(0,n._)("a",{onClick:t=>u.detail(a.data)},(0,i.zw)(t.$t("Data")),9,r)])],64)):"updatedAt"===e.dataIndex?((0,n.wg)(),(0,n.iD)("div",l,(0,i.zw)(new Date(a.updatedAt).toLocaleString()),1)):(0,n.kq)("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])])),_:1},8,["title","loading"]),c.visible?((0,n.wg)(),(0,n.j4)(v,{key:0,"get-container":!1,title:t.$t("content"),placement:"bottom",height:"600",closable:!1,visible:c.visible,onClose:u.onClose},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{"is-readonly":!0,value:t.log},null,8,["value"])])),_:1},8,["title","visible","onClose"])):(0,n.kq)("",!0)])}],["__scopeId","data-v-54da7cf8"]])}}]);