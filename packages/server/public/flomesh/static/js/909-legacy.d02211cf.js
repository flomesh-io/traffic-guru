"use strict";(self.webpackChunkflomesh_load_balancer=self.webpackChunkflomesh_load_balancer||[]).push([[909],{71900:function(t,e,a){a.d(e,{Z:function(){return r}});var i=a(66252),n=a(3577),s={class:"head-info"};var l={name:"HeadInfo",props:["title","content"]};var r=(0,a(83744).Z)(l,[["render",function(t,e,a,l,r,c){return(0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("span",null,(0,n.zw)(a.title),1),(0,i._)("p",null,[(0,i.Uk)((0,n.zw)(a.content),1),(0,i.WI)(t.$slots,"body",{},void 0,!0)])])}],["__scopeId","data-v-00006846"]])},70909:function(t,e,a){a.r(e),a.d(e,{default:function(){return D}});a(68309),a(47941);var i=a(66252),n=a(3577),s=function(t){return(0,i.dD)("data-v-7d96160a"),t=t(),(0,i.Cn)(),t},l={key:0,class:"mt-25"},r={class:"mb-3"},c={key:0},d=s((function(){return(0,i._)("svg",{class:"card-avatar icon","aria-hidden":"true"},[(0,i._)("use",{"xlink:href":"#icon-certificate"})],-1)})),o={class:"certificate-meta-content meta-content"},u={class:"mb-3"},p=s((function(){return(0,i._)("svg",{class:"border-square card-avatar icon square-50","aria-hidden":"true"},[(0,i._)("use",{"xlink:href":"#icon-certificate"})],-1)})),f={class:"mb-10"},h={class:"meta-content"};var m=a(95082),b=(a(41539),a(54747),a(57658),a(34553),a(40561),a(92222),a(99684)),g=a(18310),y=a(61103),v=a(71900),w=a(69596),k=a(60459),C=a(76754),_=a(33907),$=a(85263),T=a(27484),S=a.n(T),I={name:"Certificates",components:{HeadInfo:v.Z,PageLayout:y.Z,EnvSelector:k.Z,CardList:w.Z,PlusCircleTwoTone:b.Z,FormItem:C.Z},i18n:a(89234),props:["isBind","col","bindCertificates","certificateSize","mode"],data:function(){return{tlsMap:{api:"API/LB Secret",client:"Client Secret",rfc8998:"RFC8998 Secret",k8s:"K8S Secret"},tlsTypes:[{value:"api",label:"API/LB TLS Secret"},{value:"client",label:"Client Secret"},{value:"rfc8998",label:"RFC8998 Secret"},{value:"k8s",label:"K8S Secret"}],keyDisplay:{},FileProtectOutlined:g.Z,isEdit:!1,bindCertificatesVals:[],certificates:[],visible:!1,visible2:!1,subscribes:[],flb:[],fsm:[],payload:{name:"",id:"",port:0,type:"k8s",namespaceId:null,content:{key:"",cert:""}},bindTarget:{},editorIsCreate:!0,workload:[],projects:[],pageSize:12,pageNo:1,total:0,loading:!0,activities:[],config:{},teams:[],simpleImage:$.Z.PRESENTED_IMAGE_SIMPLE}},computed:(0,m.Z)((0,m.Z)({},(0,_.rn)("rules",["rules"])),{},{calcCertificates:function(){var t=this;if(!this.isBind)return this.certificates;var e=[];return this.certificates.forEach((function(a){var i=!1;t.bindCertificates.forEach((function(t){t.id==a.id&&(i=!0)})),i||e.push(a)})),e},start:function(){return(this.pageNo-1)*this.pageSize}}),watch:{bindCertificatesVals:{deep:!0,handler:function(){this.$emit("update:bindCertificates",this.bindCertificatesVals)}},bindCertificates:{deep:!0,immediate:!0,handler:function(t){null==t&&(this.bindCertificatesVals=[])}}},created:function(){this.loaddata()},methods:{changeType:function(){switch(this.payload.type){case"api":case"k8s":this.payload.content={key:"",cert:""};break;case"rfc8998":this.payload.content={key:"",cert:"",keyEnc:"",certEnc:""};break;case"client":this.payload.content={cert:""}}},envChange:function(t){this.payload.namespaceId=t.namespaceId},getCurrentStyle:function(t){var e={};return 1===t.date()&&(e.border="1px solid #1890ff",e.borderRadius="50%"),e},add:function(){this.isEdit=!1,this.payload={name:"",id:"",type:"api",namespaceId:null,content:{cert:"",key:""}},this.showModal()},getSample:function(){this.custom=this.customSample},showModal:function(){this.visible=!0},valid:function(){var t=this;this.$refs.form.validateFields().then((function(){t.handleOk()})).catch((function(){}))},handleOk:function(){var t=this,e=this.payload.namespaceId;if(this.isEdit){var a=this.payload.id;delete this.payload.id,delete this.payload.namespaceId,delete this.payload.namespace;var i=(0,m.Z)({content:this.payload.content},this.payload);"k8s"==i.type&&e&&(i.namespace=e),this.$gql.mutation("updateCertificate(id:".concat(a,", data: $data){data{id}}"),{data:i},{data:"CertificateInput!"}).then((function(){t.$message.success(t.$t("Save successfully"),3),t.visible=!1,t.loaddata()}))}else{delete this.payload.id,delete this.payload.namespaceId,delete this.payload.namespace;var n=(0,m.Z)({},this.payload);"k8s"==n.type&&e&&(n.namespace=e),this.$gql.mutation("createCertificate(data: $data){data{id}}",{data:n},{data:"CertificateInput!"}).then((function(){t.$message.success(t.$t("Created successfully"),3),t.visible=!1,t.loaddata()}))}},setting:function(t,e,a){var i=this;this.keyDisplay={},this.payload.namespace=a.namespace,this.$gql.query("certificate(id: ".concat(a.id,"){data{id,attributes{\n\t\t\t\t\t\tname,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t}}},\n\t\t\t\t\t\tcontent\n\t\t\t\t\t}}}")).then((function(t){var e;i.payload=t.data,i.payload.content=t.data.content,i.payload.namespaceId=null===(e=t.data.namespace)||void 0===e?void 0:e.id})),this.isEdit=!0,this.showModal()},remove:function(t,e,a){var i=this;this.$gql.mutation("deleteCertificate(id: ".concat(a.id,"){data{id}}")).then((function(){i.$message.success(i.$t("Deleted successfully"),3),i.loaddata()}))},showModal2:function(){this.visible2=!0},getTimeLabel:function(t){return new Date(t[0]).toLocaleDateString()+"~"+new Date(t[1]).toLocaleDateString()},handleOk2:function(){var t=this;if(this.bindTarget.validity[1]){this.bindCertificatesVals=this.bindCertificates;var e=this.bindCertificatesVals.findIndex((function(e){return e.id==t.bindTarget.id})),a={id:this.bindTarget.id,name:this.bindTarget.name,host:this.bindTarget.host,content:this.bindTarget.content,type:this.bindTarget.type,start:""+new Date(this.bindTarget.validity[0]).getTime(),end:""+new Date(this.bindTarget.validity[1]).getTime()};e>-1?this.bindCertificatesVals[e]=a:this.bindCertificatesVals.push(a),this.bindTarget={},this.visible2=!1,this.$message.success(this.$t("Binding succeeded"),3)}else this.$message.error(this.$t("Please select a valid period"),3)},unbind:function(t){this.bindCertificatesVals=this.bindCertificates,this.bindCertificatesVals.splice(t,1)},editBind:function(t){this.bindCertificatesVals=this.bindCertificates,this.bindTarget=this.bindCertificatesVals[t];var e=new Date(1*this.bindTarget.start).toLocaleDateString(),a=new Date(1*this.bindTarget.end).toLocaleDateString();this.bindTarget.validity=[S()(e),S()(a)],this.isEdit=!0,this.showModal2()},bind:function(t,e,a){var i=this.certificateSize||2;this.bindCertificates.length>=i?this.$message.warning(this.$t("At most ".concat(i," certificates can be bound"))):(this.bindTarget=a,this.bindTarget.validity=[],this.showModal2())},edit:function(){},loaddata:function(t,e){var a=this;t&&(this.pageNo=t,this.pageSize=e),this.loading=!0;var i={};"certificates"==this.mode&&(i.type={in:["api","rfc8998"]}),this.$gql.query('certificates(filters: $filters, sort:"name:asc",pagination: {start: '.concat(this.start,", limit: ").concat(this.pageSize,"}){\n\t\t\t\t\t\tdata{id,attributes{\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\tnamespace{data{id,attributes{\n\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\tregistry{data{id,attributes{name}}}\n\t\t\t\t\t\t\t}}},\n\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t}},\n\t\t\t\t\t\tmeta{pagination{total}}\n\t\t\t\t\t}"),{filters:i},{filters:"CertificateFiltersInput",pagination:"PaginationArg"}).then((function(t){a.certificates=t.data,a.total=t.pagination.total,a.loading=!1}))}}};var D=(0,a(83744).Z)(I,[["render",function(t,e,a,s,m,b){var g=(0,i.up)("PlusCircleTwoTone"),y=(0,i.up)("HeadInfo"),v=(0,i.up)("a-tag"),w=(0,i.up)("a-divider"),k=(0,i.up)("a-card-meta"),C=(0,i.up)("CardList"),_=(0,i.up)("a-pagination"),$=(0,i.up)("a-input"),T=(0,i.up)("FormItem"),S=(0,i.up)("a-descriptions-item"),I=(0,i.up)("a-select-option"),D=(0,i.up)("a-select"),z=(0,i.up)("EnvSelector"),W=(0,i.up)("a-alert"),E=(0,i.up)("a-textarea"),q=(0,i.up)("a-descriptions"),U=(0,i.up)("a-form"),O=(0,i.up)("a-modal"),j=(0,i.up)("a-range-picker"),x=(0,i.up)("PageLayout"),L=(0,i.Q2)("permission");return(0,i.wg)(),(0,i.j4)(x,{"hide-head":a.isBind,avatar:m.FileProtectOutlined,"form-state":m.payload,ref:"layout"},{extra:(0,i.w5)((function(){return[(0,i.wy)(((0,i.wg)(),(0,i.j4)(y,{class:"split-right",title:t.$t("Create a certificate")},{body:(0,i.w5)((function(){return[(0,i._)("div",null,[(0,i.Wm)(g,{onClick:b.add,class:"font-primary icon-menu rotate-icon"},null,8,["onClick"])])]})),_:1},8,["title"])),[[L,["certificate:create"]]])]})),default:(0,i.w5)((function(){return[a.isBind?((0,i.wg)(),(0,i.iD)("div",l,[a.bindCertificates.length>0?((0,i.wg)(),(0,i.j4)(w,{key:0,dashed:""},{default:(0,i.w5)((function(){return[(0,i.Wm)(v,null,{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(t.$t("Is binding")),1)]})),_:1})]})),_:1})):(0,i.kq)("",!0),(0,i.Wm)(C,{empty:t.$t("Select a binding in the certificate list"),col:a.col,class:"mb-10","hide-action-title":!0,"data-source":a.bindCertificates,type:"component",loading:m.loading,actions:[{icon:"EditOutlined",text:t.$t("edit"),call:b.editBind,permission:["certificate:update"]},{icon:"DisconnectOutlined",text:t.$t("Unbind"),call:b.unbind,permission:["certificate:update"]}]},{default:(0,i.w5)((function(e){var a=e.item;return[(0,i.Wm)(k,null,{title:(0,i.w5)((function(){return[(0,i._)("div",r,[(0,i._)("span",null,(0,n.zw)(a.name),1),a.host?((0,i.wg)(),(0,i.iD)("span",c," / "+(0,n.zw)(a.host),1)):(0,i.kq)("",!0)])]})),avatar:(0,i.w5)((function(){return[d]})),description:(0,i.w5)((function(){return[(0,i._)("div",o,(0,n.zw)(t.$t("Term of validity"))+"ï¼š"+(0,n.zw)(b.getTimeLabel([1*a.start,1*a.end])),1)]})),_:2},1024)]})),_:1},8,["empty","col","data-source","loading","actions"])])):(0,i.kq)("",!0),(0,i._)("div",null,[a.isBind?((0,i.wg)(),(0,i.j4)(w,{key:0,dashed:""},{default:(0,i.w5)((function(){return[(0,i.Wm)(v,null,{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(t.$t("Certificate list")),1)]})),_:1})]})),_:1})):(0,i.kq)("",!0),(0,i.Wm)(C,{empty:t.$t("No certificate"),col:a.col,"hide-action-title":!0,"data-source":b.calcCertificates,type:"component",loading:m.loading,actions:a.isBind?[{icon:"LinkOutlined",text:t.$t("Bind"),call:b.bind,permission:["certificate:update"]}]:[{icon:"EditOutlined",text:t.$t("edit"),call:b.setting,permission:["certificate:update"]},{icon:"CloseOutlined",hide:!0,text:t.$t("delete"),call:b.remove,permission:["certificate:delete"]}]},{default:(0,i.w5)((function(t){var e=t.item;return[(0,i.Wm)(k,null,{title:(0,i.w5)((function(){return[(0,i._)("div",u,(0,n.zw)(e.name),1)]})),avatar:(0,i.w5)((function(){return[p]})),description:(0,i.w5)((function(){return[(0,i._)("div",f,[e.type?((0,i.wg)(),(0,i.j4)(v,{key:0,color:{k8s:"blue",api:"green",rfc8998:"green",client:"green"}[e.type]},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(m.tlsMap[e.type]),1)]})),_:2},1032,["color"])):(0,i.kq)("",!0),e.namespace?((0,i.wg)(),(0,i.j4)(v,{key:1},{default:(0,i.w5)((function(){var t;return[(0,i.Uk)((0,n.zw)(null===(t=e.namespace.registry)||void 0===t?void 0:t.name)+" / "+(0,n.zw)(e.namespace.name),1)]})),_:2},1024)):(0,i.kq)("",!0)]),(0,i._)("div",h,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Object.keys(e.content||[]),(function(t,e){return(0,i.wg)(),(0,i.iD)("div",{key:e},(0,n.zw)(t)+":******************** ",1)})),128))])]})),_:2},1024)]})),_:1},8,["empty","col","data-source","loading","actions"]),(0,i.Wm)(_,{onChange:b.loaddata,current:m.pageNo,"onUpdate:current":e[0]||(e[0]=function(t){return m.pageNo=t}),total:m.total,"page-size":m.pageSize,"show-less-items":""},null,8,["onChange","current","total","page-size"])]),(0,i.Wm)(O,{visible:m.visible,"onUpdate:visible":e[4]||(e[4]=function(t){return m.visible=t}),title:t.$t("Certificates"),onOk:b.valid,width:"50%","ok-text":m.isEdit?t.$t("Save"):t.$t("create")},{default:(0,i.w5)((function(){return[(0,i.Wm)(U,{model:m.payload,"wrapper-col":{span:24},ref:"form"},{default:(0,i.w5)((function(){return[(0,i.Wm)(q,{bordered:""},{default:(0,i.w5)((function(){return[(0,i.Wm)(S,{label:t.$t("as"),span:3},{default:(0,i.w5)((function(){var a;return[(0,i.Wm)(T,{name:"name",rules:t.rules.uniqueName("certificates",{id:m.payload.id,namespace:null===(a=m.payload.namespace)||void 0===a?void 0:a.id})},{default:(0,i.w5)((function(){return[(0,i.Wm)($,{placeholder:t.$t("unset"),value:m.payload.name,"onUpdate:value":e[1]||(e[1]=function(t){return m.payload.name=t}),class:"width-300"},null,8,["placeholder","value"])]})),_:1},8,["rules"])]})),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Type"),span:"k8s"==m.payload.type?1:3},{default:(0,i.w5)((function(){return[(0,i.Wm)(D,{value:m.payload.type,"onUpdate:value":e[2]||(e[2]=function(t){return m.payload.type=t}),class:"width-180",disabled:m.isEdit,onChange:b.changeType},{default:(0,i.w5)((function(){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(m.tlsTypes,(function(t,e){return(0,i.wg)(),(0,i.j4)(I,{value:t.value,key:e},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(t.label),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value","disabled","onChange"])]})),_:1},8,["label","span"]),"k8s"==m.payload.type?((0,i.wg)(),(0,i.j4)(S,{key:0,label:t.$t("Namespace"),span:2},{default:(0,i.w5)((function(){return[(0,i.Wm)(z,{"no-all":!0,"is-filter":!0,namespace:m.payload.namespace,"onUpdate:namespace":e[3]||(e[3]=function(t){return m.payload.namespace=t}),onEnvChange:b.envChange},null,8,["namespace","onEnvChange"])]})),_:1},8,["label"])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Object.keys(m.payload.content),(function(e,a){return(0,i.wg)(),(0,i.j4)(S,{key:a,label:t.$t("Certificate")+" (".concat(e,")"),span:3},{default:(0,i.w5)((function(){return[m.isEdit&&m.payload.content[e]&&!m.keyDisplay[e]?((0,i.wg)(),(0,i.j4)(W,{key:0,type:"success",message:"********************",banner:"",closable:"",onClose:function(){m.payload.content[e]="",m.keyDisplay[e]=!0}},null,8,["onClose"])):(0,i.kq)("",!0),!m.isEdit||m.keyDisplay[e]||""==m.payload.content[e]?((0,i.wg)(),(0,i.j4)(E,{key:1,value:m.payload.content[e],"onUpdate:value":function(t){return m.payload.content[e]=t},placeholder:e,rows:4},null,8,["value","onUpdate:value","placeholder"])):(0,i.kq)("",!0)]})),_:2},1032,["label"])})),128))]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["visible","title","onOk","ok-text"]),(0,i.Wm)(O,{visible:m.visible2,"onUpdate:visible":e[7]||(e[7]=function(t){return m.visible2=t}),title:t.$t("Binding certificate"),onOk:b.handleOk2,width:"50%","ok-text":t.$t("Bind"),"destroy-on-close":!0},{default:(0,i.w5)((function(){return[(0,i.Wm)(q,{bordered:""},{default:(0,i.w5)((function(){return[m.bindTarget.id?((0,i.wg)(),(0,i.j4)(S,{key:0,label:t.$t("ID"),span:3},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(m.bindTarget.id),1)]})),_:1},8,["label"])):(0,i.kq)("",!0),(0,i.Wm)(S,{label:t.$t("as"),span:3},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,n.zw)(m.bindTarget.name),1)]})),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Host"),span:3},{default:(0,i.w5)((function(){return[(0,i.Wm)($,{value:m.bindTarget.host,"onUpdate:value":e[5]||(e[5]=function(t){return m.bindTarget.host=t}),class:"width-300"},null,8,["value"])]})),_:1},8,["label"]),(0,i.Wm)(S,{label:t.$t("Term of validity"),span:3},{default:(0,i.w5)((function(){return[(0,i.Wm)(j,{value:m.bindTarget.validity,"onUpdate:value":e[6]||(e[6]=function(t){return m.bindTarget.validity=t})},{dateRender:(0,i.w5)((function(t){var e=t.current;return[(0,i._)("div",{class:"ant-calendar-date",style:(0,n.j5)(b.getCurrentStyle(e))},(0,n.zw)(e.date()),5)]})),_:1},8,["value"])]})),_:1},8,["label"])]})),_:1})]})),_:1},8,["visible","title","onOk","ok-text"])]})),_:1},8,["hide-head","avatar","form-state"])}],["__scopeId","data-v-7d96160a"]])}}]);